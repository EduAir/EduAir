define("core/analytics/experiment",["underscore","remote/config","core/analytics/identity","core/utils/cookies"],function(a,b,c,d){"use strict";var e={},f=function(a,b){return b[0]<=a&&a<b[1]};return e._current=null,e.getCurrent=function(){if(e._current)return e._current;var g=b.experiments||{},h=!1,i=0,j=d.read("experiment");return j&&a.has(g,j)?h=!0:(i=c.clientPercent(),j=a.chain(g).keys().find(function(a){var b=this[a];return f(i,b.bucket)?!0:void 0},g).value()),e._current=j?{experiment:j,variant:h||f(i,g[j].active)?"active":"control"}:{experiment:"default",variant:"control"}},e.disable=function(){e._current={experiment:"default",variant:"control"}},e.isActive=function(a){var b=this.getCurrent();return b.experiment===a&&"active"===b.variant},e}),define("core/analytics/jester",["jquery","underscore","backbone","core/analytics/experiment","core/analytics/identity","core/config/urls"],function(a,b,c,d,e,f){"use strict";var g=c.Model.extend({url:f.jester+"/event.js",initialize:function(){this.set(d.getCurrent())},setHostReferrer:function(a){if(a&&-1!==a.indexOf("http")){var b=document.createElement("a");b.href=a,b.hostname&&this.set("page_referrer_domain",b.hostname)}},decoratePayload:function(a){return a=b.extend(this.toJSON(),a),b.extend(a,{event:"activity",imp:e.impression.impId,prev_imp:e.impression.prevImp}),a.section||(a.section="default"),a.area||(a.area="n/a"),a},emit:function(c){return a.ajax({url:b.result(this,"url"),data:this.decoratePayload(c),dataType:"script",cache:!0})}}),h=new g;return{ActivityClient:g,client:h}}),define("lounge/common",["backbone","underscore"],function(a){"use strict";var b,c=function(a){b=a},d=function(){return b},e=a.View.extend({initialize:function(a){this.session=a.session,this.showZero=a.showZero||!1},render:function(){var a=this.session.get("notificationCount")||0;return this.$el.html(a>9?'9<i class="icon icon-plus"></i>':a),a>0||this.showZero?this.$el.show():this.$el.hide(),this}});return{setLounge:c,getLounge:d,NotificationCountView:e}}),define("lounge/menu-handler",["jquery","common/bus"],function(a,b){"use strict";return{init:function(){function c(){a(".dropdown").removeClass("open")}a("html").on("click",c),a("body").delegate("[data-toggle]","click",function(b){b.stopPropagation(),b.preventDefault();var d=a(b.currentTarget),e=d.closest("."+d.attr("data-toggle")),f="disabled"!==e.attr("data-dropdown")&&!e.hasClass("open");e.attr("data-dropdown","enabled"),c(),f&&e.addClass("open")}),b.on("window.click",c)}}}),define("lounge/mixins",["backbone","underscore","jquery","lounge/common","core/api","common/utils","common/urls","common/templates","shared/common/corefuncs"],function(a,b,c,d,e,f,g,h,i){"use strict";var j=f.preventDefaultHandler,k={_getShortUrl:function(a){var c=this,d=this._shareUrl(),f=d,g=b.extend({url:d,source:"disqus_embed_next"},this.model.relatedIds());e.call("shortener/create.json",{method:"POST",data:g,timeout:5e3,success:function(a){var b=a.code,c=a.response;0===b&&(f=c.url)},complete:function(){a.call(c,f)}})},_shareWaitPopup:function(a){return window.open(g.loading,"_blank",a||"width=550,height=520")},share:function(a){this.sharers[a].call(this)},sharers:{twitter:function(){var a="https://twitter.com/intent/tweet",b=this._shareWaitPopup();this._getShortUrl(function(c){b.location=i.serialize(a,{url:c,text:this.model.twitterText(c)})})},facebook:function(){var a="https://www.facebook.com/sharer.php",b=this._shareWaitPopup("width=655,height=352");this._getShortUrl(function(c){b.location=i.serialize(a,{u:c})})}}},l=a.View.extend({className:"alert",events:{"click [data-action=dismiss]":"dismiss"},initialize:function(a){b.extend(this,a)},render:function(){var a=this,b=a.$el;return b.html(h.render("alert",{message:a.message,safe:a.safe})),b.attr("class",a.className),a.type&&b.addClass(a.type),a},dismiss:function(a){a&&a.preventDefault&&a.preventDefault(),this.remove(),this.trigger("dismiss")}}),m={alert:function(a,c){c?b.isString(c)&&(c={type:c}):c={},this.dismissAlert();var d=this._alert=new l(b.extend({message:a},c));return d.render(),this._alertSelector?this.$el.find(this._alertSelector).prepend(d.el):this.el.parentNode.insertBefore(d.el,this.el),d},dismissAlert:function(){this._alert&&this._alert.dismiss()},setAlertSelector:function(a){this._alertSelector=a}},n={toggleFollow:j(function(a){var b=a&&c(a.target).closest("a[data-user]").attr("data-user"),e=this.collection&&b?this.collection.get(b):this.user,f=d.getLounge(),g=f.session;return g.isLoggedOut()?(this.trigger("authenticating"),this.listenToOnce(g,"identify",function(){this.follow(e)}),void f.authenticate("disqusDotcom")):void(e.get("isFollowing")?this.unfollow(e):this.follow(e))}),unfollow:function(a){a.unfollow(),d.getLounge().trigger("uiAction:unfollowUser",a)},follow:function(a){a.follow(),d.getLounge().trigger("uiAction:followUser",a)}},o=function(){function a(){return this.collapseTarget&&this.collapseTarget.length||(this.collapseTarget=this.collapseTargetSelector?this[this.collapseScope].find(this.collapseTargetSelector):this[this.collapseScope]),this.collapseTarget}function b(){var b=this;if(b.isCollapseAllowed){var c=a.call(b);c&&c.length&&(c.height(b.collapsedHeight),e.call(b))}}function c(a){var b=this;if(b.collapseTarget&&b.collapseTarget.length){var c=b.collapseTarget;c.css("height","auto"),c.css("maxHeight","none"),f.call(b),a||(b.isCollapseAllowed=!1)}}function d(){return this.seeMoreButton&&this.seeMoreButton.length||(this.seeMoreButton=a.call(this).siblings("[data-action=see-more]")),this.seeMoreButton}function e(){var a=this;d.call(this).removeClass("hidden").on("click",function(){a.expand()})}function f(){d.call(this).addClass("hidden").off("click")}return function(a){var d=this;d.isCollapseAllowed=!0,d.collapsedHeight=a.collapsedHeight,d.collapseTargetSelector=a.collapseTargetSelector,d.collapseScope=a.collapseScope||"$el",d.collapse=b,d.expand=c}}();return{ShareMixin:k,AlertView:l,AlertMixin:m,FollowButtonMixin:n,asCollapsible:o}}),define("lounge/realtime",["jquery","underscore","backbone","common/utils","common/urls","shared/common/corefuncs","shared/common/logger"],function(a,b,c,d,e,f,g){"use strict";function h(){n.apply(this,arguments),this.reqCounter=0,this.marker=0,this.interval=1,this._boundOnError=b.bind(this.onError,this),this._boundOnLoad=b.bind(this.onLoad,this),this._boundOnProgress=b.bind(this.onProgress,this)}function i(){n.apply(this,arguments),this.handshakeSuccess=null,this.interval=1,this._boundOnOpen=b.bind(this.onOpen,this),this._boundError=b.bind(this.onError,this),this._boundClose=b.bind(this.onClose,this),this._boundMessage=b.compose(b.bind(this.onMessage,this),function(a){return JSON.parse(a.data)})}var j=2,k=120,l=function(){},m=function(){throw new Error("Pipe class cannot be used directly.")},n=function(a,c){this.channel=a,this.since=c,this.connection=null,this.paused=!1,this._msgBuffer=[],this._boundOpen=b.bind(this.open,this)};b.extend(n.prototype,c.Events,{getUrl:function(a){var c={};return this.since&&(c.since=this.since),b.extend(c,a),f.serialize(this.baseUrl+this.channel,c)},onMessage:function(a){var b=a.message_type,c=a.firehose_id;this.lastEventId=c,g.log("RT: new message:",b,c);var d={type:b,data:a.message_body,lastEventId:c};this.trigger(b,d)},_msgToBuffer:function(){this._msgBuffer.push(b.toArray(arguments))},pause:function(a){this.paused||(this.paused=!0,this._trigger=this.trigger,this.trigger=a===!1?l:this._msgToBuffer,g.log("RT: paused, buffered: %s",a!==!1))},resume:function(){if(this.paused){this.paused=!1,this.trigger=this._trigger,g.log("RT: resumed, buffered messages: %s",this._msgBuffer.length);for(var a;a=this._msgBuffer.shift();)this.trigger.apply(this,a)}},open:m,close:function(){var a=this.connection;return a?(this.connection=null,a):!1}}),b.extend(h.prototype,n.prototype,{baseUrl:e.realertime+"/api/2/",onError:function(){this.connection&&(this.connection=null,this.trigger("error",this),this.interval<=k&&(this.interval*=j),d.sendStat("rt_streampipe_error"),g.logError("RT: Connection error, backing off %s secs",this.interval),b.delay(this._boundOpen,1e3*this.interval))},onLoad:function(){this.connection&&(this.connection=null,this.since=null,this.trigger("success",this),d.sendStat("rt_streampipe_close"),b.defer(this._boundOpen))},onProgress:function(){if(this.connection){var a,b=this.connection.responseText,c=0;if(b&&!(this.marker>=b.length)){a=b.slice(this.marker).split("\n");for(var d,e,f,h=a.length,i=0;h>i;i++)if(d=a[i],c+=d.length+1,e=d.replace(/^\s+|\s+$/g,"")){try{f=JSON.parse(e)}catch(j){if(i===h-1){c-=d.length+1;break}g.log("RT: unable to parse: ",e,d);continue}this.onMessage(f)}else g.log("RT: ignoring empty row...");c>0&&(this.marker+=c-1)}}},open:function(){this.close();var a=this.connection=d.CORS.request("GET",this.getUrl({bust:++this.reqCounter}),this._boundOnLoad,this._boundOnError);if(!a)return d.sendStat("rt_streampipe_cors_unavail"),void g.log("RT: Cannot use any cross-domain request tool with StreamPipe. Bailing out.");a.onprogress=this._boundOnProgress,this.connection=a,this.marker=0;try{a.send()}catch(b){this.connection=null,d.sendStat("rt_streampipe_cors_fail"),g.log("RT: Attempt to send a CORS request failed.")}},close:function(){var a=n.prototype.close.apply(this);return a&&a.abort()}}),b.extend(i.prototype,n.prototype,{baseUrl:("https:"===window.location.protocol?"wss:":"ws:")+e.realertime+"/ws/2/",onOpen:function(){g.log("RT: [Socket] Connection established."),this.handshakeSuccess=!0,this.since=null},onError:function(){if(this.connection){if(this.connection=null,!this.handshakeSuccess)return g.log("RT: [Socket] Error before open, bailing out."),d.sendStat("rt_socketpipe_fail"),void this.trigger("fail");this.trigger("error"),this.interval<=k&&(this.interval*=j),d.sendStat("rt_socketpipe_error"),g.logError("RT: Connection error, backing off %s secs",this.interval),b.delay(this._boundOpen,1e3*this.interval)}},onClose:function(a){if(this.connection){if(!a.wasClean)return d.sendStat("rt_socketpipe_unclean_close"),void this.onError();this.connection=null,d.sendStat("rt_socketpipe_clean_close"),g.log("RT: [Socket] Connection closed. Restarting..."),this.trigger("close"),this.open()}},open:function(){this.close();var a=this.connection=new window.WebSocket(this.getUrl());a.onopen=this._boundOnOpen,a.onerror=this._boundError,a.onmessage=this._boundMessage,a.onclose=this._boundClose},close:function(){var a=n.prototype.close.apply(this);return a&&a.close()}});var o={_wsSupported:window.WebSocket&&2===WebSocket.CLOSING,initialize:function(a,c,d,e){this.close(),this._initArgs=[a,c,d,e];var f=this._wsSupported,g=f?i:h,j=this.pipe=new g(a,c);b.chain(d).pairs().each(function(a){j.on(a[0],a[1],e)}),f&&j.on("fail",function(){this._wsSupported=!1,j.off(),this.initialize.apply(this,this._initArgs)},this),j.open()},pause:function(a){this.pipe&&this.pipe.pause(a)},resume:function(){this.pipe&&this.pipe.resume()},close:function(){this.pipe&&(this.pipe.close(),this.pipe=null)}};return a(window).on("unload",b.bind(o.close,o)),{Pipe:n,StreamPipe:h,SocketPipe:i,Manager:o}}),function(a){"use strict";var b=function(a,b,c){this.store=a,this.max=b||10,this.queueKey=c||"__queue",this.getQueue()||this.setQueue([])};b.prototype.setItem=function(a,b){var c=this.getQueue()||this.setQueue([]);c.length===this.max&&this.store.removeItem(c.shift()),this.store.setItem(a,b),c.push(a),this.setQueue(c)},b.prototype.getItem=function(a){return this.store.getItem(a)},b.prototype.removeItem=function(a){this.store.removeItem(a);for(var b=this.getQueue()||[],c=0;c<b.length;c++)if(b[c]===a){b.splice(c,1);break}this.setQueue(b)},b.prototype.clear=function(){this.store.clear(),this.setQueue([])},b.prototype.getQueue=function(){var a=this.store.getItem(this.queueKey);return a?JSON.parse(a):null},b.prototype.setQueue=function(a){return this.store.setItem(this.queueKey,JSON.stringify(a)),a},a.QueuedStorage=b}(this),define("queuedstorage",function(a){return function(){var b;return b||a.QueuedStorage}}(this)),function(a){"use strict";function b(a){return a.replace(g," ")}function c(a,d,e){var f,g,h,j,k="",l=[];for("string"!=typeof e&&(e="\n\n"),j=0;j<a.length;++j)g=a[j],f=g.nodeName.toLowerCase(),1===g.nodeType?(h=d&&d(g),h?k+=h:i.hasOwnProperty(f)?(k&&l.push(k),k=c(g.childNodes,d,e)):k+="br"===f?"\n":c(g.childNodes,d,e)):3===g.nodeType&&(k+=b(g.nodeValue));return l.push(k),l.join(e)}function d(a,b,c){if(a.addEventListener)a.addEventListener(b,c,!1);else{if(!a.attachEvent)throw new Error("No event support.");a.attachEvent("on"+b,c)}}var e=a.document,f="character",g=new RegExp(String.fromCharCode(160),"gi"),h="h1 h2 h3 h4 h5 h6 p pre blockquote address ul ol dir menu li dl div form".split(" "),i={},j=0;for(j=0;j<h.length;j++)i[h[j]]=!0;var k=function(a,b,c){var e=this;if(!a||!a.contentEditable)throw"First argument must be contentEditable";this.elem=a,this.emulateTextarea=a.getAttribute("plaintext-only")||b,this.emulateTextarea&&(this.pasteHandler=function(){var a=e.plainTextReformat,b=function(){a.timeout=null,a.call(e)};a.timeout&&clearTimeout(a.timeout),a.timeout=setTimeout(b,0)},d(a,"paste",this.pasteHandler));for(var f in c)c.hasOwnProperty(f)&&(this[f]=c[f])};k.prototype={insertHTML:function(a){if(e.all){var b=e.selection.createRange();return b.pasteHTML(a),b.collapse(!1),b.select()}return e.execCommand("insertHTML",!1,a)},insertNode:function(b){var c,d,f;a.getSelection?(c=a.getSelection(),c.getRangeAt&&c.rangeCount&&(d=c.getRangeAt(0),d.deleteContents(),d.insertNode(b),d.collapse(!1),c.removeAllRanges(),c.addRange(d))):e.selection&&e.selection.createRange&&(d=e.selection.createRange(),f=3===b.nodeType?b.data:b.outerHTML,d.pasteHTML(f),d.collapse(!1))},getTextNodes:function(a){var b=this.elem;a&&a.nodeType?a=[a]:a||(a=b.childNodes);for(var c,d=[],e=0;e<a.length;++e)if(c=a[e])switch(c.nodeType){case 1:d=d.concat(this.getTextNodes(c.childNodes));break;case 3:/^\n\s+/.test(c.nodeValue)||d.push(c)}return d},text:function(a){var b,d,e,f=this.elem;try{d=Array.prototype.slice.call(f.childNodes)}catch(g){for(d=[],e=0;e<f.childNodes.length;++e)d.push(f.childNodes[e])}return b=c(d,a,this.emulateTextarea&&"\n"),b.replace(/^\s+|\s+$/g,"")},setText:function(b){b=b||"";var c,d,f,g=e.createDocumentFragment(),h=this.emulateTextarea?[b.replace(/(?:\r\n|\r|\n){2,}/g,"\n\n")]:b.split(/(?:\r\n|\r|\n){2,}/),i=h&&h.length;for(c=0;i>c;c++)d=h[c],f=this.createParagraph(d),g.appendChild(f);g.lastChild.appendChild(e.createElement("br")),this.elem.innerHTML="",this.elem.appendChild(g);var j=a.getSelection&&a.getSelection();j&&j.anchorNode===this.elem&&j.modify&&j.modify("move","forward","line")},createParagraph:function(a){var b,c,d,f,g,h,i,j=e.createElement("p");for(d=a.split(/\r\n|\r|\n/),c=0,g=d.length;g>c;c++){for(f=d[c],i=this.getHtmlElements(f),b=0,h=i.length;h>b;b++)j.appendChild(i[b]);j.appendChild(e.createElement("br"))}return j.lastChild&&j.removeChild(j.lastChild),j},getHtmlElements:function(a){return[e.createTextNode(a)]},plainTextReformat:function(){if(!(this.elem.getElementsByTagName("p").length<=1)){this.emulateTextarea=!1;var a=this.text();this.emulateTextarea=!0,this.setText(a)}},removeNode:function(b){var c,d,f;a.getSelection?(c=b.previousSibling,b.parentNode.removeChild(b),d=a.getSelection(),f=e.createRange(),c&&(f.setStart(c,c.length),f.setEnd(c,c.length)),d.addRange(f)):b.parentNode.removeChild(b)},selectedTextNode:function(){var c,d,g=this.elem;if(a.getSelection)return c=a.getSelection(),c.anchorNode;if(e.selection.createRange){for(d=e.selection.createRange().duplicate();-1e3===d.moveStart(f,-1e3);)continue;var h,i,j,k,l,m,n,o=d.text;for(m=0;m<g.childNodes.length;++m)for(h=g.childNodes[m],j=this.getTextNodes(h),n=0;n<j.length;++n)if(i=j[n],l=b(i.nodeValue),o.indexOf(l)>-1)k=i,o=o.replace(l,"");else if(l.indexOf(o)>-1)return i;return k}},selectedTextNodeOffset:function(c){var d,g;if(a.getSelection){var h=a.getSelection();h&&h.anchorOffset&&(g=h.anchorOffset)}else if(c&&e.selection.createRange){d=e.selection.createRange();for(var i=b(c.nodeValue),j=d.duplicate(),k=j.parentElement(),l=0;0!==d.moveStart(f,-1)&&++l&&0!==i.indexOf(b(d.text))&&k===d.parentElement();)j=d.duplicate(),k=j.parentElement();g=l}return isNaN(g)?0:g},selectNodeText:function(c,d,g){var h,i,j=this.elem;if(a.getSelection)return h=a.getSelection(),h.removeAllRanges(),i=e.createRange(),i.setStart(c,d),i.setEnd(c,g),h.addRange(i),h;if(e.selection.createRange){i=e.selection.createRange();var k=b(c.nodeValue);if("body"===i.parentElement().nodeName.toLowerCase()){for(j.focus(),i=e.selection.createRange();-1e3===i.moveStart(f,-1e3);)continue;for(;1e3===i.moveEnd(f,1e3);)continue;var l=b(i.text),m=l.indexOf(k);m>0&&i.moveStart(f,m+2),i.collapse()}for(;-1===i.moveStart(f,-1)&&0!==k.indexOf(b(i.text));)continue;for(;1===i.moveEnd(f,1)&&k!==b(i.text);)continue;return i.moveStart(f,d),i.moveEnd(f,-1*(g-d-i.text.length)),i.select(),i}}},k.normalizeSpace=b,a.Editable=k}(this),define("editable",function(a){return function(){var b;return b||a.Editable}}(this)),define("lounge/views/media",["jquery","underscore","backbone","modernizr","common/utils","common/models","core/strings","common/urls","common/templates","common/views/mixins","shared/common/corefuncs","lounge/common"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";var m=g.get,n=e.preventDefaultHandler,o=300,p=function(a){var b=a.getItem("disqus.collapse-media");return b="true"===b?!0:"false"===b?!1:null,null===b&&(b=e.isMobile(window)?!0:!1),b},q=d.localstorage?window.localStorage:e.hashStorage,r=new c.Model({collapsed:p(q)}).on("change:collapsed",function(a,b){q.setItem("disqus.collapse-media",b)}),s={settings:r},t=function(a){if(!a)return"";a="http://"+a.replace(/^([a-z+.-]+:)?\/+/i,"");var b=document.createElement("a");b.href=a;var c=b.hostname.replace(/^www\d*\./i,"");return c=c.toLowerCase()},u=function(a,b,c,d){a[b.get(c)?"addClass":"removeClass"](d)},v=c.View.extend({tagName:"span",events:{"click [data-action=expand-collapse-media]":"handleToggle"},initialize:function(a){this.media=a.media;var b=a.$link;this.linkText=b.text(),this.linkHref=b.attr("href"),this.linkDomain=t(this.linkHref);var c=this.isUserText(b);this.hasGenericMessage=!1,c?this.mediaLinkText=this.linkText:this.media.get("title")?this.mediaLinkText=e.niceTruncate(this.media.get("title"),60):(this.hasGenericMessage=!0,this.mediaLinkText=this.model.get("providerExpandMessage")),this.listenTo(this.model,"change:deferred",this.render),this.listenTo(this.model,"change:activated",this.onChangeActivated)},isUserText:function(a){if("A"!==a[0].nodeName)return!1;var b=(a.text()||"").toLowerCase();if(!b)return!1;if(0===b.indexOf("http")||0===b.indexOf("www"))return!1;b=b.replace(/\.\.\.$/,"");var c=(a.attr("href")||"").toLowerCase();return-1===c.indexOf(b)},render:function(){var a=this.mediaLinkText;this.hasGenericMessage&&this.model.get("activated")&&(a=this.model.get("providerCollapseMessage")),this.$el.html(i.render("postMediaInlineLink",{model:this.model.toJSON(),text:this.linkText,href:this.linkHref,mediaLinkText:a,domain:this.linkDomain}))},onChangeActivated:function(){this.hasGenericMessage&&this.render()},handleToggle:function(a){this.model.get("deferred")||(this.model.set("activated",!this.model.get("activated")),a&&a.preventDefault&&a.preventDefault())}}),w=c.Model.extend({defaults:{deferred:!0,showButtons:!0,activated:!1,kind:"image",postId:"",deferredHeight:0,providerExpandMessage:"",providerCollapseMessage:"",providerIcon:"icon-proceed",respectSettings:!0}}),x=c.View.extend(b.defaults({events:{"click [data-action=expand]":"handleExpand","click [data-action=contract]":"handleContract","click [data-action=force-load]":"handleForceLoad"},template:"postMedia",initialize:function(a){this.options=a,this.media=a.media,this.template=a.template||this.template,this.$linkEl=null,this.setupMode(),this.listenTo(this.model,"change:activated",this.applyState),this.listenTo(this.model,"change:deferredHeight",this.onChangeDeferredHeight),this.listenTo(this.model,"change:showButtons",this.updateElementClass),this.listenTo(this.model,"change:deferred",this.render),this.listenTo(s.settings,"change:collapsed",this.setupMode)},topEdgeOffset:function(){return-l.getLounge().getPosition().height},getMediaDimensions:function(){return{width:null,height:null}},getAvailableWidth:function(){return this.$el.parent().width()||l.getLounge().loadedThumbnailWidth},updateDeferredHeight:function(){this.model.set("deferredHeight",this.calculateDeferredHeight())},calculateDeferredHeight:function(){var a=this.getMediaDimensions(),b=a.width,c=a.height;if(!b||!c)return c;var d=this.getAvailableWidth(),e=d*c/b;return e},convertToButton:function(a){this.model.set("showButtons",!1),this.linkSubview&&this.linkSubview.remove(),this.linkSubview=new v({model:this.model,media:this.media,$link:a}),a.replaceWith(this.linkSubview.$el),this.linkSubview.render()},applyContentNodeHeight:function(a){this.contentNode.height(a||"auto")},shouldAutoplay:function(){return!this.model.get("deferred")},generateContentHtml:function(){return this.media.get("html")},createContentNode:function(b){return a(b)},insertContentNode:function(a){this.contentNode.html(a)},prepareElementEvents:function(){},displayContent:function(){this.updateDeferredHeight();var a=this.generateContentHtml(),b=this.createContentNode(a);this.prepareElementEvents(b),this.insertContentNode(b),this.applyContentNodeHeight(null)},configureDeferred:function(){this.model.get("deferred")&&!this.model.get("activated")&&(this.once("viewport:enter",this.enterViewport),l.getLounge().trackDeferredView(this)),this.listenToOnce(l.getLounge().postsView,"render:end",this.updateDeferredHeight)},configureContentFromActivated:function(){this.model.get("activated")?this.displayContent():this.displayPlaceholder()},displayPlaceholder:function(){this.contentNode.html(i.render("postMediaPlaceholder",{model:this.model.toJSON()}))},updateElementClass:function(){var a=this.$el,b=this.model;u(a,b,"deferred","media-mode-deferred"),u(a,b,"activated","media-activated"),u(a,b,"showButtons","media-show-buttons")},applyState:function(){this.configureDeferred(),this.configureContentFromActivated(),this.updateElementClass()},render:function(){this.$el.html(i.render(this.template,{model:this.model.toJSON(),media:this.media.toJSON()})),this.contentNode=this.$el.find("[data-role=content-placeholder]"),this.applyState()},remove:function(){this.linkSubview&&this.linkSubview.remove(),c.View.prototype.remove.apply(this,arguments)},enterViewport:function(){this.model.get("deferred")&&this.activate()},activate:function(){this.model.set("activated",!0)},setupMode:function(){if(this.model.get("respectSettings")){this.model.set("activated",!1);var a=s.settings.get("collapsed");a?this.model.set("deferred",!1):this.model.set("deferred",!0)}},onChangeDeferredHeight:function(){this.model.get("deferred")&&!this.model.get("activated")&&this.applyContentNodeHeight(this.model.get("deferredHeight"))},handleExpand:n(function(){this.model.set("activated",!0)}),handleContract:n(function(){this.model.set("activated",!1)}),handleForceLoad:n(function(){this.model.get("deferred")&&this.model.set("activated",!0)})},j.IsVisibleViewMixin)),y=x.extend({getMediaDimensions:function(){return{width:this.media.get("htmlWidth"),height:this.media.get("htmlHeight")}},_findIframe:function(a){return a.is("iframe")?a:a.find("iframe")},configureContentFromActivated:function(){x.prototype.configureContentFromActivated.apply(this,arguments),this.model.get("activated")||this.$el.removeClass("media-loading")},createContentNode:function(){var a=x.prototype.createContentNode.apply(this,arguments);return a.attr({width:"100%",height:this.model.get("deferredHeight"),"data-post":this.model.get("postId")}),a},insertContentNode:function(a){this.loaderNode=this.$el.find("[data-role=content-loader]"),this.loaderHeight=this.model.get("deferredHeight")||o,this.loaderNode.height(this.loaderHeight),this.$el.addClass("media-loading"),x.prototype.insertContentNode.call(this,a)},prepareElementEvents:function(a){var c=this._findIframe(a);c.one("load",b.bind(this.finishLoad,this,c))},finishLoad:function(a){this.$el.removeClass("media-loading"),a.height(this.loaderHeight),this.trigger("load")}}),z=y.extend({generateContentHtml:function(){return i.render("unknownMediaIframe",{url:this.media.get("url")})}}),A=y.extend({getMediaDimensions:function(){return{width:null,height:this.media.get("htmlHeight")}},createContentNode:function(){var a=y.prototype.createContentNode.apply(this,arguments),b=a.attr("src");return this.shouldAutoplay()&&b&&(b=k.serialize(b,{auto_play:!0}),a.attr("src",b)),a}}),B=y.extend({createContentNode:function(){var a=y.prototype.createContentNode.apply(this,arguments),b=a.attr("src");return this.shouldAutoplay()&&b&&(b=k.serialize(b,{autoplay:1}),a.attr("src",b)),a}}),C=x.extend({createContentNode:function(b){return a("<iframe>").attr({frameBorder:0,scrolling:"no",width:"100%",height:this.model.get("deferredHeight"),"data-post":this.model.get("postId"),"data-src":b,src:'javascript:window.frameElement.getAttribute("data-src");'})},insertContentNode:function(a){x.prototype.insertContentNode.apply(this,arguments);var b=this.model.get("deferredHeight")||o;a.height(b)}}),D=x.extend({insertContentNode:function(){x.prototype.insertContentNode.apply(this,arguments),this.finishLoad()},finishLoad:function(){var a=this,c=0,d=150,e=20,f=function(){++c,e>c?b.delay(f,d):a.trigger("load")};f()}}),E=D.extend({generateContentHtml:function(){var a=l.getLounge(),b=document.documentElement.lang;b=b&&b.substring(0,2);var c=this.media.get("url");return-1!==this.media.get("resolvedUrl").indexOf("/status")&&(c=this.media.get("resolvedUrl")),i.render("postMediaTwitterContent",{url:c,theme:a.config.colorScheme,linkColor:e.escapeColor(a.config.anchorColor),language:b})}}),F=x.extend({getMediaDimensions:function(){return{width:this.media.get("thumbnailWidth"),height:this.media.get("thumbnailHeight")}},getImageUrl:function(){return this.media.get("resolvedUrl")||this.media.get("url")||this.media.get("thumbnailUrl")},getImageThumbnailUrl:function(){var a=this.media.get("thumbnailUrl");return t(a)===t(h.media)&&(a=k.serialize(a,{w:l.getLounge().loadedThumbnailWidth,h:this.model.get("deferredHeight")})),a},generateContentHtml:function(){return i.render("postMediaImage",{model:this.model.toJSON(),media:this.media.toJSON(),thumbnailUrl:this.getImageThumbnailUrl(),imageUrl:this.getImageUrl(),postId:this.model.get("postId")})},prepareElementEvents:function(a){var b=this,c=a.find("img"),d=function(a){return function(){b.trigger(a),c.off(".richMediaView")}};c.on("load.richMediaView",d("load")),c.on("error.richMediaView",d("error"))},calculateDeferredHeight:function(){var a=x.prototype.calculateDeferredHeight.apply(this,arguments),b=this.getMediaDimensions().height;return Math.min(b,a)||null}}),G=F.extend({getImageThumbnailUrl:function(){return this.media.get("metadata").imageUrl||F.prototype.getImageThumbnailUrl.call(this)}}),H=y.extend({topEdgeOffset:function(){return 0},createContentNode:function(){var a=y.prototype.createContentNode.apply(this,arguments),b=a.attr("src");return this.shouldAutoplay()&&b&&(b=k.serialize(b,{audio:1}),a.attr("src",b)),a}}),I=function(a,c){var d={PLAY_HIDE:{kind:"html",providerExpandMessage:m("Play"),providerCollapseMessage:m("Hide")},VIEW_HIDE:{kind:"html",providerExpandMessage:m("View"),providerCollapseMessage:m("Hide")},VIEW_IMAGE:{kind:"image",providerIcon:"icon-images",providerExpandMessage:m("View"),providerCollapseMessage:m("Hide")}},e=function(a,c){return b.extend(d[a],{providerIcon:c})},g=null,h=null,i=f.Media.MEDIA_TYPES;switch(a.get("mediaType")){case i.IMAGE:case i.IMAGE_UPLOAD:g=d.VIEW_IMAGE;break;case i.FACEBOOK_PHOTO:h=G,g=d.VIEW_IMAGE;break;case i.VIMEO_VIDEO:case i.YOUTUBE_VIDEO:h=B,g=e("PLAY_HIDE","icon-video");break;case i.TWITTER_STATUS:h=E,g=e("VIEW_HIDE","icon-twitter");break;case i.VINE_VIDEO:h=H,g=e("PLAY_HIDE","icon-video");break;case i.FACEBOOK_VIDEO:g=e("VIEW_HIDE","icon-video");break;case i.SOUNDCLOUD_SOUND:h=A,g=e("PLAY_HIDE","icon-music");break;case i.GOOGLE_MAP:g=e("VIEW_HIDE","icon-map");break;case i.UNKNOWN:h=z,g=e("VIEW_HIDE");break;default:return null}if(null===h)switch(g.kind){case"webpage":return null;case"html":h=y;break;case"image":h=F}var j=new w(b.extend(g,{postId:c}));return{Cls:h,mediaViewModel:j}},J=function(a,b){var c=I(a,b);if(!c)return null;var d=new c.Cls({model:c.mediaViewModel,media:a});return d.relatedPost=b,d};return b.extend(s,{getCollapseDefault:p,getDomain:t,RichMediaLinkView:v,RichMediaViewModel:w,RichMediaView:x,IframeRichMediaView:y,UnknownRichMediaView:z,SoundCloudRichMediaView:A,AutoplayVideoRichMediaView:B,SourcelessIframeRichMediaView:C,DynamicHeightRichMediaView:D,TwitterRichMediaView:E,ImageRichMediaView:F,FacebookPhotoRichMediaView:G,VineRichMediaView:H,instantiateRichMediaView:J,getRichMediaViewConfig:I})}),define("lounge/mixins/post-reply",["underscore","common/models","lounge/common"],function(a,b,c){"use strict";var d={initialize:function(){this.canBindTypingHandlers()&&this.bindTypingHandlers()},canBindTypingHandlers:function(){return this.parent&&c.getLounge().isRealtimeEnabled()&&this.session&&this.thread&&this.thread.forum},bindTypingHandlers:function(){return a.map([[this,"show",this.typingStart],[this,"hide",this.typingStop]],function(a){return this.listenTo.apply(this,a),a},this)},syncTyping:function(a){this.typingUser&&(void 0!==a&&this.typingUser.set("typing",a),this.typingUser.sync())},typingStart:function(){var a=this.parent;this.typingUser||(this.typingUser=b.TypingUser.make({user:this.session.user.id,post:a.id,thread:this.thread.id,forum:this.thread.forum.id}),a.usersTyping.add(this.typingUser)),this.syncTyping(!0)},typingStop:function(){this.syncTyping(!1)}},e=function(b){var c=b.initialize;a.extend(b,d),b.initialize=function(){c.apply(this,arguments),d.initialize.call(this)}};return{asRealtimeTyping:e}}),define("lounge/views/uploads",["jquery","underscore","backbone","modernizr","core/api","common/utils","common/models","core/strings","common/templates","shared/common/corefuncs"],function(a,b,c,d,e,f,g,h,i,j){"use strict";var k=h.get,l=function(a){if(!a)throw new Error("Cannot instantinate MediaStore without a valid storageKey!");this._storageKey=a,this._store=d.localstorage?window.localStorage:f.hashStorage};b.extend(l.prototype,{getItems:function(){var a=this._store.getItem(this._storageKey);return a&&JSON.parse(a)||{}},clear:function(){this._store.removeItem(this._storageKey)},getItem:function(a){return this.getItems()[a]},setItem:function(a,b){var c=this.getItems();return c[a]=b,this._store.setItem(this._storageKey,JSON.stringify(c)),b},removeItem:function(a){var b=this.getItems();return a in b?(delete b[a],this._store.setItem(this._storageKey,JSON.stringify(b)),!0):!1}});var m=c.View.extend({events:function(){var a={"click [data-action=attach]":"_attachMedia"};return window.FormData&&b.extend(a,{dragover:"_dragOn",dragenter:"_dragOn",dragleave:"_dragOff",dragexit:"_dragOff",drop:"_drop"}),a},initialize:function(a){this.parent=a.parent,this.urls=a.urls},setElement:function(){var a=c.View.prototype.setElement.apply(this,arguments);return this.$dragPlaceholder=this.$el.find("[data-role=drag-drop-placeholder]"),this.$mediaSelector&&this.$mediaSelector.off(),this.$mediaSelector=this.$el.find("input[type=file][data-role=media-upload]"),this.$mediaSelector.on("change",b.bind(this._selectorChange,this)),a},_toggleDragPlaceholder:b.throttle(function(a){a?this.$dragPlaceholder.show():this.$dragPlaceholder.hide()},50),_selectorChange:function(a){this.uploadMedia(a.target.files),a.target.files&&d.localstorage&&!window.localStorage.getItem("usedDragDrop")&&this.trigger("uploader:alert",k("Did you know you can drag and drop images too? Try it now: drag images below."),{},function(){window.localStorage.setItem("usedDragDrop","1")})},_dragOn:function(a){a.stop(),this._toggleDragPlaceholder(!0),this.trigger("uploader:dragEnter")},_dragOff:function(a){a.stop(),this._toggleDragPlaceholder(!1)
},_drop:function(a){a.stop(),window.localStorage.setItem("usedDragDrop","1"),this._toggleDragPlaceholder(!1),this.uploadMedia(a.originalEvent.dataTransfer.files)},_attachMedia:function(a){a.stop(),this.$mediaSelector.click()},_uploadMediaModern:function(a){for(var b=this,c=new FormData,d=0,e=a[d];e;e=a[++d])e.type.match(/^image\//)&&c.append("attachment",e);c.append("json","true"),this.parent&&c.append("id",this.parent.id);var g=f.CORS.request("POST",this.urls.add,function(){if(void 0===g.readyState||4===g.readyState&&200===g.status){var a=JSON.parse(g.responseText);a.success?b.trigger("uploader:addMedia",a.media):b.trigger("uploader:alert",a.message,"error")}},function(){var a=k("Unfortunately your image upload failed. Please verify that your image is under 2MB. If you continue seeing this error, please try again later.");413===g.status&&(a=k("Sorry, but the file you submitted is larger than 2 MB. Please make it smaller and try again.")),b.trigger("uploader:alert",a,"error")});g.withCredentials=!0,g.send(c)},_uploadMediaLegacy:function(){var c=this,d=document.createElement("iframe"),e=document.createElement("form"),f=this.$mediaSelector[0];a(f).off();var g=a(f.cloneNode(!0));if(f.parentNode.replaceChild(g[0],f),g.on("change",b.bind(this._selectorChange,this)),this.$mediaSelector=g,d.style.display="none",d.name="uploadFrame"+ +new Date,e.style.display="none",e.target=d.name,e.action=this.urls.add,e.method="post",e.appendChild(d),e.appendChild(f),this.parent){var h=document.createElement("input");h.type="hidden",h.name="id",h.value=this.parent.id,e.appendChild(h)}e.enctype="multipart/form-data",e.encoding="multipart/form-data";var i=function(b){var d=b.originalEvent,f=JSON.parse(d.data);"upload"===f.name&&(a(e).remove(),a(window).off("message",i),f.data.success?c.trigger("uploader:addMedia",f.data.media):c.trigger("uploader:alert",f.data.message,"error"))};a(window).on("message",i),this.$el.append(e),e.submit()},uploadMedia:function(a){var b=window.FormData?"Modern":"Legacy";return this.uploadMedia=this["_uploadMedia"+b],this.uploadMedia(a)}}),n=c.View.extend({events:{"click [data-action=detach]":"onDetach"},initialize:function(a){this.urls=a.urls;var d=a.mediaStorageKey;this.mediaStore=d&&new l(d),this.collection=new c.Collection,this.mediaStore&&this.collection.reset(b.values(this.mediaStore.getItems())),this.listenTo(this.collection,{add:this.onAdd,remove:this.onRemove,reset:this.onReset})},setElement:function(){var a=c.View.prototype.setElement.apply(this,arguments);return this.collection&&this.collection.each(this._addElement,this),a},hasVisible:function(){return!!this.collection.length},onDetach:function(b){b.stop();var c=a(b.target).closest("li"),d=c.attr("data-media-id"),e=this.collection.where({location:d});this.collection.remove(e,{$el:c})},_addElement:function(b){var c=a(i.render("legacyMediaUpload",b.toJSON()));c.attr("data-media-id",b.get("location")),this.$el.append(c)},onAdd:function(a){this.mediaStore&&this.mediaStore.setItem(a.get("location"),a),this._addElement(a)},onRemove:function(a,b,c){c.$el&&c.$el.remove();var d=this.mediaStore&&this.mediaStore.getItem(a.get("location"));if(d){var e={media:JSON.stringify(d)};this.parent&&(e.id=this.parent.id);var f=new Image;f.src=j.serialize(this.urls.remove,e,!0),this.mediaStore.removeItem(d.location)}},onReset:function(){this.$el.empty(),this.mediaStore&&this.mediaStore.clear()}}),o=c.View.extend({initialize:function(){this._urlsCache={},this.collection=new c.Collection([],{model:g.RichMedia,comparator:function(a){return a.get("index")}}),this.listenTo(this.collection,{add:this.onAdd,"change:id change:beingEdited":this.onAdd,remove:this.onRemove,reset:this.onReset,sort:this.onSort})},hasVisible:function(){return this.collection.any(function(a){return a.$el})},onAdd:function(c,d,e){if(!c.get("thumbnailUrl"))return!1;if(b.contains(g.Media.WEBPAGE_TYPES,c.get("mediaType")))return!1;if(!e.force){if(c.$el)return;if(c.get("beingEdited")&&!e.isPasteEvent)return}var f=a(i.render("mediaUpload",{media:c.toJSON(),backupUrl:e.backupUrl}));c.$el=f,this.$el.append(f)},onRemove:function(a){a.$el&&(a.$el.remove(),a.$el=null)},onReset:function(a,c){b.each(c.previousModels,this.onRemove,this),a.each(function(d){this.onAdd(d,a,b.extend(c,{force:!0}))},this)},onSort:function(a){var b=a.chain().filter(function(a){return!!a.$el}).pluck("$el").value();this.$el.empty(),this.$el.append(b)},addMedia:function(a,c){var d=this,f=a.url,h=d._urlsCache[f];return h?(h.set(a,c),c=b.extend({merge:!0,sort:!1,backupUrl:f},c),d.collection.add(h,c),void d.collection.sort()):void((!a.beingEdited||c.isPasteEvent)&&(h=new g.RichMedia(a),d.collection.add(h,b.extend({merge:!0,backupUrl:f},c)),d._urlsCache[f]=h,(!h.get("beingEdited")||c.isPasteEvent)&&e.call("media/details.json",{method:"POST",data:{url:f},success:function(a){d._urlsCache[f].set(a.response,b.extend({backupUrl:f,sort:!1},c)),d.collection.sort()}})))},updateFromText:function(a,c,d){if(!a)return void this.collection.reset();var e=f.bleachFindUrls(a);e=b.uniq(e,!1,function(a){return a.url});var g={};b.each(e,function(e){g[e.url]=!0,e.beingEdited=e.index<c&&c<=e.endIndex||"."===a[e.endIndex],this.addMedia(e,b.extend({backupUrl:e.url},d))},this);var h=this.collection.pluck("url");g=b.keys(g);var i=b.difference(h,g);this.collection.remove(this.collection.filter(function(a){return b.contains(i,a.get("url"))}))}}),p=c.View.extend({initialize:function(a){this.parent=a.parent,this.legacyView=new n({mediaStorageKey:a.mediaStorageKey,urls:a.urls,parent:this.parent}),this.legacy=this.legacyView.collection,this.richView=new o({}),this.rich=this.richView.collection,this.listenTo(this.legacy,"all",this._updateEmpty),this.listenTo(this.rich,"all",this._updateEmpty)},setElement:function(){var a=c.View.prototype.setElement.apply(this,arguments);return this.legacyView&&(this.legacyView.setElement(this.$el.find("[data-role=media-legacy-list]")[0]),this.richView.setElement(this.$el.find("[data-role=media-rich-list]")[0]),this.rich.reset()),a},clear:function(){this.legacy.reset(),this.rich.reset()},_updateEmpty:function(){this.legacyView.hasVisible()||this.richView.hasVisible()?this.$el.removeClass("empty"):this.$el.addClass("empty")}});return{MediaStore:l,MediaUploaderView:m,MediaUploadsLegacySubView:n,MediaUploadsRichSubView:o,MediaUploadsView:p}}),define("lounge/views/cards",["jquery","underscore","backbone","lounge/common","lounge/mixins","common/utils","common/collections","common/models","common/templates","common/bus","common/urls","common/views/mixins"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";var m=f.preventDefaultHandler,n=c.View.extend({events:{mouseenter:"enter",mouseleave:"leave"},initialize:function(){this._id=b.uniqueId(),this._rendered=!1,this._hoverState="out",this._visible=!1,this._enterTimeout=null,this._leaveTimeout=null,n.open={},this.events=this.events||{},this.events["click [data-action=profile]"]="handleShowProfile",this.listenTo(this,"authenticating",this.keepOpen)},render:function(){this.hide(),a("body").append(this.el)},target:function(a){a.on("mouseenter",b.bind(this.enter,this,a)),a.on("mouseleave",b.bind(this.leave,this))},enter:function(a){var c=this;a&&(c.$target=a),c._leaveTimeout&&clearTimeout(c._leaveTimeout),"in"!==c._hoverState&&(c._hoverState="in",c._enterTimeout=b.delay(function(){"in"===c._hoverState&&c.show(),c._enterTimeout=null},n.DELAY_ENTER),n.open[this.uid]=this)},leave:function(){var a=this;a._enterTimeout&&clearTimeout(a._enterTimeout),"out"!==a._hoverState&&(a._hoverState="out",a._leaveTimeout=b.delay(function(){"out"===a._hoverState&&a.hide(),a._leaveTimeout=null},n.DELAY_LEAVE),n.open[this.uid]&&delete n.open[this.uid])},show:function(){var a=this;a._rendered||(a._rendered=!0,a.render()),a.moveTo(a.$target),a.$el.show(),a._visible=!0},moveTo:function(a){if(a){var b=n.POSITION_OFFSET,c=a.offset(),e=this.$el,f=e.dim(),g=d.getLounge().getPosition();c.top-=b,c.top+f.height+g.frameOffset.top<=g.pageOffset+g.height?e.css("top",c.top):e.css("top",c.top-f.height+2*b),e.css("left",c.left+b)}},hide:function(){this._keepOpen||(this.$el.hide(),this._visible=!1)},keepOpen:function(){this._keepOpen=!0,this.setupKeepOpenCanceler()},setupKeepOpenCanceler:function(){var c=this,d=function(){"out"===c._hoverState&&(c.stopListening(j,"window.click",d),a("body").off("click",d),c._keepOpen=!1,c.hide())};b.delay(function(){c.listenTo(j,"window.click",d),a("body").on("click",d)},100)},isVisible:function(){return this._visible},handleShowProfile:m(function(b){var c=a(b.currentTarget).attr("data-user");d.getLounge().showProfile(c),this.hide()})},{open:{},instances:{},DELAY_ENTER:350,DELAY_LEAVE:175,POSITION_OFFSET:20,exitAll:function(){b.invoke(n.open,"leave")},create:function(a,b,c,d){var e=n.instances[c];e||(n.instances[c]=e={});var f=e[a];return f||(f=new d(b),e[a]=f),b.targetElement&&f.target(b.targetElement),f}});!function(){a(document).on("mouseout",b.debounce(function(a){var b=a.relatedTarget||a.toElement;b&&"HTML"!==b.nodeName||n.exitAll()},10))}();var o=n.extend({className:"tooltip-outer",events:b.defaults({"click [data-action=toggleFollow]":"toggleFollow"},n.prototype.events),initialize:function(a){var b=this;n.prototype.initialize.call(b,a),b.session=a.session,b.user=a.user,b._fetched=!1,b.listenTo(b.session,"change:id",function(){this._rendered&&this.render()})},onFetch:function(a){var c=this;this.user=new h.SyncedUser(a),this.updateCounters(),this.updateActions(),this.listenTo(this.user,{"change:numPosts change:numLikesReceived":b.debounce(function(){c.updateCounters()}),"change:isFollowing":c.updateActions})},serialize:function(){var a=this.user.toJSON({session:this.session});return a.numLikesReceived=a.numLikesReceived||this.user.get("numVotes")||0,{user:a,showFollowButton:this.user.has("isFollowing")||this.session.isLoggedOut()}},render:function(){this.$el.html(i.render("hovercard",this.serialize())),n.prototype.render.call(this)},updateCounters:function(){this.$el.find("[data-role=counters]").html(i.render("hovercardCounters",this.serialize()))},updateActions:function(){this.$el.find("[data-role=actions]").html(i.render("hovercardActions",this.serialize()))},show:function(){this._fetched||(this._fetched=!0,this.user.fetch({success:b.bind(this.onFetch,this)})),n.prototype.show.call(this)}},{create:function(a){var b=a.user;return n.create(b.id,a,"ProfileCard",o)}});b.extend(o.prototype,e.FollowButtonMixin);var p=n.extend({className:"context-card tooltip-outer",initialize:function(a){var b=this;n.prototype.initialize.call(b,a),b.post=a.post},render:function(){var a=this.post.toJSON();a.excerpt=b.truncate(b.escape(b.strip(a.message),40,"...")),this.$el.html(i.render("contextCard",{post:a})),n.prototype.render.call(this)}},{create:function(a){var b=a.post;return n.create(b.id,a,"ContextCard",p)}}),q=n.extend({className:"tooltip-outer upvoters-outer",initialize:function(a){var b=this;n.prototype.initialize.call(b,a),b._fetched=!1,b._loading=!1,b._rendered=!1;var c=a.model;b.model=c,b.session=a.session,b.likes=c.get("likes"),b.hadLikes=!!b.likes,b.users=c.getUpvotersUserCollection(),b.listenTo(b.model,"change:userScore",b.updateUserSet),b.listenTo(b.model,"change:likes",b.updateGuestVotes),b.listenTo(b.users,"add",b.addUser),b.listenTo(b.users,"remove",b.removeUser)},updateUserSet:function(){var a=this.session.user,b=this.likes,c=!1;if(this.likes=this.model.get("likes"),this.model.get("userScore")>0)if(this.session.isLoggedIn()&&this.users.add(a),this.likes&&!b)this._rendered=!1,this.show();else{var d=this.likes-1-this.users.length;c=this.session.isLoggedOut()?!!d:!0}else this.users.remove(a),this.likes||this.hide();this.updateGuestVotes(),this.moveTo(this.$target,c)},addUser:function(a){var c=this;a.get("isAnonymous")?c.updateGuestVotes():c.$listEl&&c.$listEl.length&&(c.$listEl.prepend(i.render("upvoter",b.extend({highlight:!0},a.toJSON()))),c.stopHighlightUsername())},removeUser:function(a){var b=this;if(a.get("isAnonymous"))b.updateGuestVotes();else{var c=b.$el.find("[data-user="+a.get("id")+"]");c.length&&c.remove()}},stopHighlightUsername:b.debounce(function(){var a=this.$el.find(".highlight");a.removeClass("highlight")},1100),getGuestVoteCount:function(){return Math.max(this.model.get("likes")-this.users.length,0)},updateGuestVotes:function(){var a=this,b=a.$el.find("[data-role=guest]"),c={guestCount:this.getGuestVoteCount(),guestAvatarUrl:k.avatar.generic,highlight:b.length},d=i.render("guestUpvoter",c);b.length?(b.replaceWith(d),a.stopHighlightUsername()):a.$listEl&&a.$listEl.length&&a.$listEl.append(d)},render:function(){delete this.pointEl,this.$el.html(i.render("upvoters",{users:this.users.toJSON(),guestCount:this.getGuestVoteCount(),guestAvatarUrl:k.avatar.generic,isLoading:this._loading,highlight:!1})),n.prototype.render.call(this),this.$listEl=this.$el.find(".upvoters ul")},show:function(){var a=d.getLounge(),c=this;if(c.likes&&!c.isVisible()&&(c.hadLikes||(c._fetched=!0,c._loading=!1),c._fetched?c._loading&&(c._rendered=!1,c._loading=!1,c.hide()):(c.users.fetch().done(b.bind(this.show,this)),c._fetched=!0,c._loading=!0),c._fetched&&!c._loading)){var e=this.session.user;this.model.get("userScore")>0&&this.session.isLoggedIn()&&!this.users.contains(e)&&this.users.add(e),n.prototype.show.call(this),this.scrollMeasure&&this.scrollMeasure.dim().height>this.$el.dim().height&&this.$el.addClass("has-scroll"),a.trigger("uiAction:upvotersCardShow")}},showPoint:function(a){var c=["tl","bl"];this.pointEl||(this.pointEl=this.$el.find(".tooltip-point"),this.pointEl.removeClass("hidden")),b.each(c,function(a){this.pointEl.removeClass("point-position-"+a)},this),this.pointEl.addClass("point-position-"+a)},moveTo:function(a,b){if(a){var c=n.POSITION_OFFSET,e=a.offset(),f=this.$el,g=f.dim(),h=d.getLounge().getPosition(),i=h.frameOffset.height;b&&(g.height+=f.find("li.user").dim().height+10),e.top-g.height-c>=0&&e.top-g.height+h.frameOffset.top>=h.pageOffset?(f.css({bottom:i-e.top+c,top:"inherit"}),this.showPoint("bl")):(f.css({bottom:"inherit",top:e.top+2*c}),this.showPoint("tl")),f.css("left",e.left-c)}},handleShowProfile:m(function(a){n.prototype.handleShowProfile.call(this,a),d.getLounge().trigger("uiAction:showProfileFromUpvotes")})},{create:function(a){return n.create(a.postId,a,"UpvotersCard",q)}});return f.mixin(q,l.LocalScroll,{scrollMeasureSelector:"[data-role=content]"}),{HoverCard:n,ProfileCard:o,ContextCard:p,UpvotersCard:q}}),define("core/extensions/jquery.autoresize",["jquery","underscore"],function(a,b){"use strict";return a.fn.autoresize=function(c){var d=b.extend({extraSpace:0,maxHeight:1e3},c);return this.each(function(){var c=a(this).css({resize:"none",overflow:"hidden"}),e="true"===String(c[0].contentEditable)?"html":"val",f="html"===e?"<br>":"\n",g=c.height(),h=function(){var d={};b.each(d,function(a,b){d[b]=c.css(b)});var e=a(c[0].cloneNode(!0));return e.removeAttr("id").removeAttr("name").css({visibility:"hidden",position:"absolute",top:"-9999px",left:"-9999px",contentEditable:!1}).css(d).attr("tabIndex","-1"),e.insertAfter(c[0]),e}(),i=null,j=function(){h[0].style.height=0,h[e](c[e]()+f),h.scrollTop(h[0].scrollHeight);var a=Math.max(h[0].scrollHeight,g)+parseInt(d.extraSpace,10);d.maxHeight&&(a>=d.maxHeight?(c.css("overflow",""),a=d.maxHeight):c.css("overflow","hidden")),i!==a&&(i=a,c.height(a),c.trigger&&c.trigger("resize"))},k=b.throttle(j,500),l=function(a){13===a.keyCode?j():k()};c.bind("keyup",l).bind("paste",j).css("overflow","hidden"),j()})},a}),define("lounge/views/posts",["require","jquery","underscore","backbone","queuedstorage","editable","modernizr","core/api","common/defines","common/models","common/collections","common/utils","core/strings","common/bus","common/urls","common/templates","common/views/mixins","common/keys","common/collections/profile","lounge/views/media","lounge/mixins","lounge/mixins/post-reply","lounge/views/uploads","lounge/views/cards","lounge/common","core/extensions/jquery.autoresize"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){"use strict";var z=m.get,A=l.preventDefaultHandler,B=350,C=function(){var a=5,b=g.localstorage?window.localStorage:l.hashStorage;return new e(b,a,"drafts.queue")}(),D=d.View.extend({tagName:"form",className:"reply",events:{"click [data-action=cancel]":"hide",submit:"submitForm"},initialize:function(a){if(this.session=a.session,this.parent=a.parent,this.thread=a.thread,this.loginFormView=new E({thread:this.thread,session:this.session,alert:c.bind(this.alert,this)}),this.userSuggestions=a.userSuggestions,this.postboxAlertSelector="[role=postbox-alert]",this.parentView=a.parentView,this.listenTo(this.session,{"change:id change:audienceSyncVerified":this.redraw}),this._isHidden=!1,this.parent&&(D.open[this.parent.cid]=this),this.thread.forum.get("settings").allowMedia){var b=this.storageKey("media"),d={add:this.thread.get("uploadAdd"),remove:this.thread.get("uploadRemove")};this.mediaUploads=new w.MediaUploadsView({mediaStorageKey:b,parent:this.parent,urls:d}),this.mediaUploader=new w.MediaUploaderView({parent:this.parent,urls:d}),this.listenTo(this.mediaUploader,{"uploader:alert":function(a,b,d){var e=this.alert(a,b);c.isFunction(d)&&this.listenToOnce(e,"dismiss",d)},"uploader:dragEnter":function(){this.$el.addClass("expanded")},"uploader:addMedia":this.handleAttachMedia})}var e=c.throttle(this.updateLiveMedia,500),f=c.debounce(this.updateLiveMedia,1e3);this.updateLiveMediaRateLimited=this.canUseContentEditable?function(){e.apply(this,arguments),f.call(this,!0)}:function(){f.call(this,!0)}},handleAttachMedia:function(a){if(this.mediaUploads){var b=y.getLounge();b.switches.enabled("rich_media_only")?(this.textarea.handleFocusIn(),this.textarea.set(this.textarea.get()+" "+a.location)):this.mediaUploads.legacy.add(a)}},storageKey:function(a){return this.thread.id?[a||"drafts","thread",this.thread.id,"parent",this.parent?this.parent.id:0].join(":"):null},updateLiveMedia:function(a){function b(){var b=d.textarea.get(),c=d.textarea.content&&d.textarea.content.selectedTextNodeOffset()||b.length;d.mediaUploads.richView.updateFromText(b,c,{isPasteEvent:a})}var d=this;d.mediaUploads&&(a?c.defer(b):b())},saveDraft:function(){null!==this.storageKey()&&C.setItem(this.storageKey(),JSON.stringify([this.textarea.get(),(new Date).getTime(),this.textarea.mentionsCache&&this.textarea.mentionsCache.models]))},getDraft:function(){if(null===this.storageKey())return null;var a=C.getItem(this.storageKey());if(!a)return null;var b=JSON.parse(a);if(b[1]+86400>(new Date).getTime()){var d=b[2];return d&&!c.isEmpty(d)&&this.userSuggestions.addRemote(new k.UserCollection(d)),b[0]}return C.removeItem(this.storageKey()),null},restoreDraft:function(){var a=this.getDraft();a&&this.textarea.set(a)},updateAvatar:function(){this.$el.find("[data-role=user-avatar]").attr("src",this.session.user.get("avatar").cache)},redraw:function(){var a=this.$el.hasClass("expanded"),c=this.el,d=this.$el.find("textarea").val();this.render(),this.$el.find("textarea").val(d),a&&this.$el.addClass("expanded"),0!==b(c).parent().length&&c.parentNode.replaceChild(this.el,c)},getPlaceholderText:function(){return z(this.thread.get("posts")?"Join the discussion…":"Start the discussion…")},render:function(){var a=this,b=a.$el;return this.loginFormView.$el.detach(),a.$el.html(p.render("form",{user:a.session.toJSON(),audienceSyncRequired:this.session.needsAudienceSyncAuth(this.thread.forum),allowMedia:a.thread.forum.get("settings").allowMedia})),this.loginFormView.render(),this.loginFormView.$el.appendTo(a.$("[data-role=login-form]")),a.parent?b.addClass("expanded"):b.removeClass("expanded"),a.session.user.id?b.addClass("authenticated"):b.removeClass("authenticated"),a.initTextarea(),a.mediaUploads&&(a.mediaUploads.setElement(b.find("[data-role=media-preview]")[0]),a.mediaUploader.setElement(b.find("[data-role=textarea]")[0])),a.session.get("mustVerifyEmail")&&a._alertMustVerify(),a._isHidden&&b.addClass("hidden"),this},canUseContentEditable:function(){return g.contenteditable&&!i.browser.mobile&&!(window.opera&&window.opera.version)}(),initTextarea:function(){var a=this.getDraft()||"",b=this.canUseContentEditable?J:I,d=this.textarea=new b({value:a,placeholder:this.getPlaceholderText(),userSuggestions:this.userSuggestions});this.$("[data-role=textarea]").prepend(d.render().el),this.listenTo(d,{keychange:c.debounce(this.saveDraft,500),focus:function(){this.$el.hasClass("expanded")||this.$el.addClass("expanded")}}),this.listenTo(d,{keychange:this.updateLiveMediaRateLimited,paste:function(a,b){b&&b.fake||this.updateLiveMedia(!0)}})},resize:function(){this.textarea.resize()},focus:function(){this.textarea.focus()},clear:function(){var a=this;a.textarea.clear(),a.$el.removeClass("expanded"),a.mediaUploads&&a.mediaUploads.clear(),c.delay(function(){a.resize()},200),a.parent?a.hide():a.setInactive()},setInactive:function(){this.$el.removeClass("expanded")},restore:function(a){var b=this;b.textarea.set(a.get("raw_message")),b.textarea.handleFocusIn(),c.delay(function(){b.resize()},200),b.parent&&b.show()},_alertMustVerify:function(a){var b=m.interpolate(z("%(forumName)s requires you to %(verifyEmail)s before posting"),{forumName:this.thread.forum.get("name"),verifyEmail:'<a href="#" data-action="verify-email">'+z("verify your email address")+"</a>"});this.alert(b,{safe:!0,type:a?"error":"warn"})},submitForm:A(function(){return this.dismissAlert(),this.loginFormView.shouldRegisterUser()?void this.loginFormView.registerUser():this.initiatePost()}),initiatePost:function(){var a=this,b={thread:a.thread.id,depth:a.parent?a.parent.get("depth")+1:0,parent:a.parent?a.parent.id:null,raw_message:a.textarea.get()};a.session.isLoggedIn()?b.author_id=a.session.user.id:c.extend(b,{author_name:a.$el.find("input[name=display_name]").val(),author_email:a.$el.find("input[name=email]").val()});var d=y.getLounge();d&&d.switches.enabled("before_comment_callback")?(n.sendHostMessage("posts.beforeCreate",{raw_message:b.raw_message}),this.listenToOnce(n,"posts.beforeCreate.response",function(a){a&&(b.raw_message=a),this.createPost(b)})):this.createPost(b)},displayPostboxAlert:function(a,b){var c=p.render("postboxAlert",{message:a,safe:b});this.$el.find(this.postboxAlertSelector).html(c)},clearPostboxAlert:function(){this.$el.find(this.postboxAlertSelector).empty()},createPost:function(a){var d=this,e=y.getLounge();d.clearPostboxAlert();var f=b.now(),g=new j.UniqueModel(j.Post),h=g.set(a,{validate:!0});if(!h)return void d.displayPostboxAlert(g.validationError);var i=function(a,b){if(12===b.code&&/not have permission to post on this thread/.test(b.response)){var e=p.render("blacklistErrorMessage",{forumName:d.thread.forum.get("name")});d.displayPostboxAlert(e,!0)}else 12===b.code&&/verify/.test(b.response)?d._alertMustVerify(!0):d.displayPostboxAlert(c.isString(b.response)?b.response:z("Oops! We're having trouble posting your comment. Check your internet connection and try again."));d.thread.posts.remove(g),d.restore(g),d.thread.incrementPostCount(-1)},k=function l(){d.storageKey()&&C.removeItem(d.storageKey()),d.thread.trigger("create",g),e.trigger("uiCallback:postCreated",g,{duration:b.now()-f}),d.thread.posts.saveToCache(g),d.parentView&&d.parentView.toggleReplyLink(!1),d.stopListening(g,"error",i),d.stopListening(g,"sync",l),e.trigger("domReflow")};return d.listenTo(g,{error:i,sync:k}),g.save(a),g.author=d.session.isLoggedIn()?d.session.user:new j.UniqueModel(j.User,{name:a.author_name,email:a.author_email}),d.thread.incrementPostCount(1),g.created=!0,d.thread.posts.add(g),d.clear(),e.trigger("uiAction:createPost",g),g},prependTo:function(a){a=a[0],a.insertBefore(this.el,a.firstChild)},remove:function(){this.parent&&(delete D.open[this.parent.cid],this.typingStop()),this.loginForm&&(this.loginForm.remove(),this.loginForm=null),d.View.prototype.remove.call(this)},toggle:function(){this.isOpen()?this.hide():this.show()},show:function(){var a=this;a._isHidden=!1,a.$el.removeClass("hidden"),a.trigger("show")},hide:function(){var a=this;a._isHidden=!0,a.dismissAlert(),a.$el.addClass("hidden"),a.trigger("hide")},isOpen:function(){return!this._isHidden}});c.extend(D.prototype,u.AlertMixin),v.asRealtimeTyping(D.prototype),D.open=D.open||{};var E=d.View.extend({events:{"click input[name=author-guest]":"managePassword","focusin input[name=display_name]":"expandGuestForm"},initialize:function(a){this.thread=a.thread,this.session=a.session,this.alert=a.alert},expandGuestForm:function(){this.$("[data-role=guest-details]").addClass("expanded")},shouldRegisterUser:function(){return this.session.isLoggedOut()&&!this.$("input[name=author-guest]").is(":checked")},render:function(){var a=y.getLounge();return this.$el.html(p.render("loginForm",{user:this.session.toJSON(),forumName:this.thread.forum.get("name"),audienceSyncRequired:this.session.needsAudienceSyncAuth(this.thread.forum),allowAnonPost:this.thread.forum.get("settings").allowAnonPost,apiKey:a.config&&a.config.apiKey||"",sso:this.session.get("sso")})),this},parseRegistrationErrorResponse:function(a){if(a.responseJSON){var b=a.responseJSON.response;return/Unable to create user/i.test(b)?{email:[z("That email address is already registered with a Disqus account. Log in or enter another email.")]}:/The e-mail address you specified is already in use./i.test(b)?{email:[z("The e-mail address you specified is already in use.")+'<br><a class="link" href="#" data-action="auth:disqus">'+z("Try logging in.")+"</a>"]}:{all:[b]}}},handleRegistrationError:function(a){c.isString(a)&&(a={all:[a]});var b=this;b.$(".input-wrapper.has-error").removeClass("has-error").find(".input-label").remove(),c.each(a,function(a,c){"all"!==c?b.$("input[name="+c+"]").after('<label class="input-label">'+a[0]+"</label>").parent(".input-wrapper").addClass("has-error"):b.alert&&b.alert(a[0],"error")})},managePassword:function(){var a=this.$el,b=a.find("input[name=author-guest]"),c=a.find("input[name=password]");c&&(c[b.is(":checked")?"hide":"show"](),c.val(""))},getPassword:function(){var a=this.$el.find("input[name=password]");return a.length?a.val():null},registerUser:function(){var a=this,b=new j.User({display_name:a.$el.find("input[name=display_name]").val(),email:a.$el.find("input[name=email]").val(),password:a.getPassword()});return b.isValid()?void b.register({error:function(b){a.handleRegistrationError(a.parseRegistrationErrorResponse(b))},success:function(){a.session.setUser(b),n.trigger("onboardAlert.show"),y.getLounge().trigger("uiAction:finishRegistrationEmbed")}}):void a.handleRegistrationError(b.validationError)}}),F=d.View.extend({tagName:"form",className:"edit",events:{submit:"submitForm","click [data-action=cancel]":"cancel"},initialize:function(a){this.post=a.post,this.session=a.session},show:function(){},hide:function(){},cancel:function(){this.trigger("cancel")},render:function(){var a=this.post.toJSON();this.$el.html(p.render("edit",{post:a,user:this.session.toJSON()}));var b=this.textarea=new I({value:a.raw_message});this.$("[data-role=textarea]").prepend(b.render().el)},prependTo:function(a){a=a[0],a.insertBefore(this.el,a.firstChild)},resize:function(){this.textarea.resize()},submitForm:function(a){a&&a.preventDefault()&&a.preventDefault();var b=this,c={raw_message:this.textarea.get()},d=b.post.validate(c);return void 0!==d?alert(d):(b.trigger("submitted"),void b.post.save(c,{success:function(){}}))},remove:function(){this.$el.remove()}}),G=d.View.extend({initialize:function(a){this.options=a},render:function(){var a,b=this.options.parentView.reply,c=b&&b.typingUser,d=this.model.usersTyping.count(c&&c.id);return 0>=d?void this.$el.hide():(1===d?a=z("One other person is typing…"):(a=z("%(num)s other people are typing…"),a=m.interpolate(a,{num:d})),this.$el.text(a),void this.$el.show())}}),H=d.View.extend({tagName:"form",className:"moderate",events:{submit:function(a){a&&a.preventDefault()&&a.preventDefault(),this.submit()},"click [data-action=cancel]":"cancel"},initialize:function(){var a=this;a.loading=!1,a.model.get("ipAddress")||(a.loading=!0,a.listenToOnce(a.model,"change:ipAddress",function(){a.loading=!1,a.render()}),a.model.fetch())},render:function(){var a=this,b=a.$el;return b.html(p.render("blacklist",{post:a.model.toJSON()})),a.loading?b.addClass("loading"):b.removeClass("loading"),a},cancel:function(a){a&&a.preventDefault()&&a.preventDefault(),this.trigger("cancel")},submit:function(){var a={},b=this;b.$el.find("input").each(function(){this.checked&&(a[this.name]=this.value)}),c.isEmpty(a)||(a.forum=b.model.get("forum"),h.call("blacklists/add.json",{method:"POST",data:a,success:function(){b.trigger("success")}}))}}),I=d.View.extend({events:{"keyup    [data-role=editable]":"handleKeyUp","paste    [data-role=editable]":"handlePaste","focusin  [data-role=editable]":"handleFocusIn"},initialize:function(a){a=a||{},this.value=a.value,this.placeholder=a.placeholder},render:function(){var a=this.$input=b("<textarea>").attr({"class":"textarea",placeholder:this.placeholder,"data-role":"editable"}).val(this.value).appendTo(this.el);return a.autoresize({maxHeight:B}),this},resize:function(){this.$input.trigger("paste",{fake:!0})},get:function(){return this.$input.val()},set:function(a){this.$input.val(a)},clear:function(){this.set("")},focus:function(){this.$input[0].focus()},handleKeyUp:function(){this.trigger("keychange")},handlePaste:function(){this.trigger("paste keychange"),this.$input.trigger("resize")},handleFocusIn:function(){this.trigger("focus")}}),J=I.extend({events:function(){return c.extend({},I.prototype.events,{"keydown  [data-role=editable]":"handleKeyDown","focusout [data-role=editable]":"handleFocusOut","click .placeholder":"handlePlaceholderClick"})},initialize:function(a){I.prototype.initialize.call(this,a),a=a||{},this.userSuggestions=a.userSuggestions,this.mentionsCache=new k.UserCollection,this.suggestions=new K({userSuggestions:this.userSuggestions,mentions:this.mentionsCache}),this.listenTo(this.suggestions,"select",this.insertMention),this.reset(),this.$input=null},reset:function(){this.anchorNode=null,this.anchorOffset=null,this.anchorLength=0,this.suggestions.clear()},render:function(){var a=this.$input=b("<div>").attr({"class":"textarea",tabIndex:this.el.tabIndex,role:"textbox","aria-multiline":"true",contenteditable:"true","data-role":"editable"}).css({overflow:"auto","max-height":B+"px"}).appendTo(this.$el);this.$el.append(this.suggestions.el),this.content=new f(a[0],!0,{getHtmlElements:c.bind(this.getHtmlElements,this)}),this.set(this.value),this.suggestions.render();var d=this.placeholder;return d&&(a.attr("aria-label",d),this.$placeholder=b('<span class="placeholder">'+d+"</span>"),this.content.text()||this.setPlaceholder()),this},getHtmlElements:function(a){if(!a)return a;var b=[a],d=this.getMentionNodes(a);return c.each(d,function(a,d){for(var e=0;e<b.length;e++){var f,g=b[e],h=e;if(c.isString(g)){for(;(f=g.indexOf(d))>-1;)f>0&&b.splice(e++,0,g.substring(0,f)),b.splice(e++,0,a.cloneNode(!0)),g=g.substring(f+d.length);g&&g!==b[h]&&b.splice(e++,0,g),h!==e&&b.splice(e,1)}}}),b=c.map(b,function(a){return c.isString(a)?document.createTextNode(a):a})},getMentionNodes:function(a){var b=J.MENTIONS_RE_GROUPED,c={};b.lastIndex=0;for(var d=b.exec(a);d;){var e=d[1],f=this.userSuggestions.all().find(function(a){return a.get("username")===e});if(f){var g=J.getMentionDom(f),h=d[0];c[h]=g,this.updateCache(f,f.cid)}d=b.exec(a)}return c},setPlaceholder:function(){this.$el.prepend(this.$placeholder)},handleKeyDown:function(a){switch(a.keyCode){case 9:this.suggestions.active&&(this.suggestions.select(),a.preventDefault(),a.stopPropagation());break;case 10:case 13:case 38:case 40:this.suggestions.active&&(a.preventDefault(),a.stopPropagation())}},handleKeyUp:function(a){switch(I.prototype.handleKeyUp.call(this),a.preventDefault(),a.stopPropagation(),this.checkExistingMentions(),j.Session.get().isLoggedIn()&&this.userSuggestions.fetch(),a.keyCode){case 50:if(!a.shiftKey)return;this.start(a);break;case 10:case 13:this.suggestions.select();break;
case 27:this.reset(a);break;case 38:this.suggestions.move("up");break;case 40:this.suggestions.move("down");break;default:this.throttledSuggest(a)}},handlePlaceholderClick:function(){this.$input.focus()},handleFocusIn:function(){I.prototype.handleFocusIn.call(this),this.$placeholder.remove()},handleFocusOut:function(){""===this.content.text()&&this.setPlaceholder()},start:function(){this.reset(),this.suggest()},suggest:function(){var a=this.parseSearchTerms();this.suggestions.suggest(a)},throttledSuggest:c.throttle(function(){this.suggest()},250),insertMention:function(a){var b=this.userSuggestions.get(a);this.selectSearchString(b),this.updateCache(b,a);var d=J.getMentionDom(b);this.content.insertNode(d);var e=this.$el.find("span[data-cid]");c.each(e,function(a){a.contentEditable!==!1&&(a.contentEditable=!1)})},updateCache:function(a,b){this.mentionsCache.get(b)||this.mentionsCache.add(a)},selectSearchString:function(){this.content.selectNodeText(this.anchorNode,this.anchorOffset-1,this.anchorOffset+this.anchorLength)},get:function(){function a(a){return c(a,!0)?b.mentionToText(a):null}var b=this,c=J.isMention;return this.content.text(a)},set:function(a){this.content.setText(a),this.resize()},clear:function(){I.prototype.clear.call(this),this.setPlaceholder(),c.defer(function(a){a.$input.blur()},this)},parseSearchTerms:function(){var a=this.content.selectedTextNode(),b=a?a.nodeValue:"",c=f.normalizeSpace;if(b){var d=this.content.selectedTextNodeOffset(a),e=f.normalizeSpace(b.slice(0,d).split("").reverse().join("")),g=e.indexOf("@");if(-1===g)return null;this.anchorNode=a,this.anchorOffset=d-g,this.anchorLength=g;var h=c(b.slice(this.anchorOffset-1,d)).match(J.MENTIONS_RE);return h?h[0].slice(1).split(" "):0===g?[""]:void 0}},checkExistingMentions:function(){var a=f.normalizeSpace,d=this.$el.find("span"),e=c.filter(d,J.isMention),g=this.mentionsCache,h={};c.each(e,function(d){var e=b(d).attr("data-cid"),f=c.reduce(this.content.getTextNodes(d),function(b,c){return b+a(c.nodeValue)},""),i=g.get(e);i&&i.get("name")!==f?(this.mentionsCache.remove(i),this.content.removeNode(d),this.content.insertHTML(" "),this.reset()):h[e]=d},this),g.each(function(a){h[a.cid]||g.remove(a)})},mentionToText:function(a){var c=b(a).attr("data-cid"),d=this.mentionsCache.get(c),e=a.innerText||a.textContent;return d&&d.get("username")&&(e=d.get("username")),["@",e,":","disqus"].join("")}},{MENTIONS_RE:new RegExp("@\\w+\\s?(?:\\w+\\s?){0,5}(?:\\w+)?$"),MENTIONS_RE_GROUPED:/@([\d\w]+)\s?(\:\s?(\w+))?/gi,isMention:function(a,c){var d;do{if(d=b(a),d.hasClass("mention")&&d.attr("data-cid"))return!0;a=a.parentElement}while(c&&a);return!1},getMentionDom:function(a){var b=document.createDocumentFragment(),c=document.createElement("span"),d=document.createElement("span"),e=document.createTextNode(a.get("name")||a.get("username"));return c.setAttribute("contenteditable",!0),d.setAttribute("contenteditable",!1),d.setAttribute("data-cid",a.cid),d.className="mention",d.appendChild(e),c.appendChild(d),b.appendChild(c),b.appendChild(document.createTextNode(" ")),b}}),K=d.View.extend({events:{"click li":"handleClick"},initialize:function(a){this.active=!1,this.mentionsCache=a.mentions,this.userSuggestions=a.userSuggestions,this.userHtmlCache={}},suggest:function(a){var b=this.userSuggestions.find(a,this.mentionsCache);return b&&b.length?(this.renderUsers(b),this.active=!0,void this.$el.show()):void this.clear()},render:function(){this.$el.html(p.render("suggestions")),this.active||this.$el.hide()},renderUsers:function(a){var d=c.reduce(a,function(a,c){var d=this.userHtmlCache[c.cid];return void 0===d&&(this.userHtmlCache[c.cid]=d=b(this.renderSingleUser(c))),a.appendChild(d[0]),a},document.createDocumentFragment(),this);this.$(".header").siblings().remove().end().after(d).siblings().removeClass("active").first().addClass("active")},renderSingleUser:function(a){var b=a.toJSON();return b.cid=a.cid,p.render("suggestedUser",b)},clear:function(){this.active=!1,this.$el.hide()},handleClick:function(a){var c=b(a.currentTarget);this.select(c.attr("data-cid"))},select:function(a){this.active&&(a||(a=this.$el.find(".active").attr("data-cid")),this.trigger("select",a),this.clear())},move:function(a){if(this.active){var b=this.$el.find(".active"),c="up"===a?"prev":"next",d=b[c]();d.length&&d.attr("data-cid")&&(b.removeClass("active"),d.addClass("active"))}}},{MAX_SUGGESTIONS:5});return{PostReplyView:D,PostEditView:F,TypingUserView:G,BlacklistView:H,TextareaView:I,ContentEditableView:J,SuggestionView:K,LoginFormView:E}}),define("lounge/views/post",["jquery","underscore","backbone","core/strings","common/templates","common/urls","common/utils","lounge/common","lounge/mixins","lounge/views/cards","lounge/views/media"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";var l=g.preventDefaultHandler,m=d.get,n=c.View.extend({tagName:"li",className:"post",actions:{upvote:l(function(a){this.handleVote(a,1)}),downvote:l(function(a){this.handleVote(a,-1)}),reply:"handleReply",flag:"handleFlag",edit:"handleEdit","delete":"handleDelete",spam:"handleSpam",blacklist:"handleBlacklist",highlight:"handleHighlight",unhighlight:"handleUnhighlight",collapse:"handleCollapse",reveal:"handleReveal","share:twitter":"_onShare","share:facebook":"_onShare","downvote-tooltip-link":"handleDownvoteTooltipLink"},events:{"click > [data-role=post-content] [data-action]":function(c){var d=this,e=a(c.currentTarget).attr("data-action"),f=d.actions[e];return f?(b.isFunction(f)?f:d[f]).call(d,c):void 0},"mouseout [data-action=downvote]":"handleDownvoteMouseout"},initialize:function(a){this.thread=a.thread,this.session=a.session,this.created=!!a.created,this.options=a,this.userSuggestions=a.userSuggestions,this.setAlertSelector("> [role=alert]"),this.listenTo(this.model,{"change:isDeleted spam":this.removeAsDeleted,"change:message":this.stopLoading,"change:points":this.updateVotePoints,"change:userScore":this.updateActiveUserVote,"change:isFlaggedByUser":this.updateUserFlagged,"change:isHighlighted":function(){this.redraw()},change:function(){var a=this.model.changedAttributes();(a.id||a.message)&&this.redraw()}}),this.listenTo(this.model.usersTyping,"add remove reset change",this.updateTypingCount),this.listenTo(this.session,"change:id",function(){this.updateFooter(),this.updateMenu(),this.updateSessionClass()}),this.reply=null,this.edit=null,this.parent=a.parent,this.trackPosition=!1,this.offset={top:-1,height:-1},this.dim={height:-1,width:-1},this.listenTo(h.getLounge(),"domReflow",function(){if(!this.trackPosition||!this.visible)return this.offset={top:-1,height:-1},void(this.dim={height:-1,width:-1});var a=this.contentNode;this.offset=a.offset(),this.dim=a.dim()}),this.isCollapseAllowed=!0,this.haveSubscribedToRichMediaEvents=!1},createTypingUserView:function(){var a=this.$el.find("[data-role=realtime-notification\\:"+this.model.id+"] .realtime-replies");this.typingUserView=new(require("lounge/views/posts").TypingUserView)({parentView:this,model:this.model,el:a})},updateTypingCount:function(){this.typingUserView||this.createTypingUserView(),this.typingUserView.render()},stopLoading:function(){this.contentNode.find(".loading").removeClass("loading")},updateRelativeTime:function(){this.contentNode.find("[data-role=relative-time]").text(this.model.getRelativeCreatedAt())},handleDownvoteMouseout:function(){var a=h.getLounge();a.switches.enabled("hide_downvote_number")&&-1===this.model.get("userScore")&&this.contentNode.find("[data-role=downvote-tooltip]").removeClass("tooltip-disabled")},updateSessionClass:function(){var a="authored-by-session-user";this.model.isAuthorSessionUser(this.session)?this.contentNode.addClass(a):this.contentNode.removeClass(a)},updateActiveUserVote:function(){var a=this.model,b=this.contentNode.find("[data-action=upvote]"),c=this.contentNode.find("[data-action=downvote]");c.removeClass("downvoted"),b.removeClass("upvoted"),a.get("userScore")>0?b.addClass("upvoted"):a.get("userScore")<0&&c.addClass("downvoted")},updateVotePoints:function(){var c=this.model,d=this.contentNode.find("[data-role=likes], [data-role=dislikes]"),e=this.contentNode.find("[data-action=upvote], [data-action=downvote]"),f=function(a){b.delay(function(){a.addClass("update"),b.delay(function(){a.removeClass("update")},1e3)},500)};b.each(d,function(b,d){b=a(b);var g=b.html(),h=c.get(b.attr("data-role")).toString(),i=a(e[d]);h=Math.max(h,0),g!==h&&(i.addClass("count-"+h),i.removeClass("count-"+g),b.html(h),f(b))})},updateFooter:function(){var a=this.contentNode.find("footer"),b=h.getLounge(),c=e.render("postFooter",{post:this.getPostAttributes(),session:this.session.toJSON(),hideDownvoteNumber:b.switches.enabled("hide_downvote_number")}),d=require("lounge/views/posts").PostReplyView;d.open[this.model.cid]&&this.toggleReplyLink(!0),a.html(c),this.initUpvotersCard()},updateMenu:function(){var a=this.contentNode.find("[data-role=menu]"),b=e.render("postMenu",{session:this.session.toJSON(),post:this.getPostAttributes()});a.replaceWith(b)},updatePostStateClasses:function(){var a=this.model,b=a.get("isHighlighted")||a.get("isSponsored");this.$el.toggleClass("highlighted",!!b),this.contentNode.toggleClass("disabled",!a.id)},updateUserFlagged:function(){this.model.get("isFlaggedByUser")?this.contentNode.addClass("user-reported"):this.contentNode.removeClass("user-reported")},getMessageContent:function(){return this.messageContent&&this.messageContent.length||(this.messageContent=this.contentNode.find("[data-role=message-content]")),this.messageContent},manageMessageHeight:function(a){var b=this,c=b.getMessageContent(),d=1.5*b.collapsedHeight,e=c&&c.length&&c.height()||0;e+=a||0,e>d&&!b.$el.hasClass("collapsed")?b.collapse():b.expand(!0)},preventCollapsing:function(a){a.get("deferred")||(this.expand(),this.isCollapseAllowed=!1)},markSeen:function(){function a(e){var f,g;return e?c.dim.height<=0||c.dim.width<=0?!1:(f=c.offset.top+e.frameOffset.top,g=f>e.pageOffset,(g=g&&f+c.dim.height<=e.pageOffset+e.height)?(c.contentNode.addClass("seen"),b.delay(function(){c.contentNode.removeClass("seen"),c.contentNode.removeClass("new")},1e4),c.trackPosition=!1,c.stopListening(d,"scroll",a),!0):!1):!1}var c=this,d=h.getLounge();a(d.position)||c.listenTo(d,"scroll",a)},renderRichMedia:function(c,d){var e=this.$el.find("[data-role=message]"),f={};e.find("a").each(function(b,c){var d=c.href;f[d]||(f[d]=a(c))});var h=this.model.cid;this.richMediaViews=c.chain().map(function(a){return k.instantiateRichMediaView(a,h)}).without(null).map(function(b){this.listenTo(b.model,"change:activated",this.preventCollapsing),b.render();var c=b.media.get("url"),e=g.bleachFindUrls(c);e.length&&(c=e[0].url);var h=f[c];if(h){var i=n.getHighestAncestor(h);i.after(b.$el),b.convertToButton(h)}else a("<li>").append(b.$el).appendTo(d);return b},this).value(),!this.haveSubscribedToRichMediaEvents&&this.richMediaViews.length&&(this.listenTo(k.settings,"change:collapsed",function(a,c){if(c)this.manageMessageHeight();else{var d=b.reduce(this.richMediaViews,function(a,b){return a+(b.model.get("deferredHeight")||0)},0);this.manageMessageHeight(d)}}),this.haveSubscribedToRichMediaEvents=!0)},renderMedia:function(){var a=this.model.media;if(a&&a.length){var b=this.$el.find("[data-role=post-media-list]");this.renderRichMedia(a,b)}},getStateByline:function(){var a,b=this.model;return b.get("isHighlighted")?a={icon:"trophy",text:m("Featured by %(forum)s"),style:"default"}:b.get("isSponsored")?a={icon:"trophy",text:m("Sponsored on Disqus"),style:"sponsored"}:b.isAuthorSessionUser(this.session)&&(b.get("isApproved")||(a={icon:"clock",text:m("Hold on, this is waiting to be approved by %(forum)s."),style:"default"})),a&&(a.text=d.interpolate(a.text,{forum:this.thread.forum.get("name")})),a},getTemplate:function(a){return a.isDeleted?"postDeleted":this.model.isAuthorSessionUser(this.session)&&!a.isApproved?"post":a.isMinimized?"postMinimized":"post"},getPostAttributes:function(){var a=this.model.toJSON({session:this.session,thread:this.thread}),b=this.model.getParent();return b&&b.get("isSponsored")&&(a.canBeRepliedTo=!1),a},render:function(){var a=this,b=a.$el,c=a.getPostAttributes(),d=h.getLounge(),i=a.thread.forum.get("avatar"),j=a.model.getParent(),k=this.getTemplate(c);return!c.message&&c.raw_message&&g.isPlainText(c.raw_message)&&(c.message=a.model.constructor.formatMessage(c.raw_message)),b.html(e.render(k,{post:c,forumName:a.thread.forum.get("name"),session:a.session.toJSON(),thread:a.thread.toJSON(),created:a.created,parentPost:j&&j.toJSON(),thumbnailWidth:d.loadedThumbnailWidth,thumbnailHeight:d.MAX_MEDIA_HEIGHT,defaultAvatarUrl:i?i.large.cache:f.avatar.generic,hideDownvoteNumber:d.switches.enabled("hide_downvote_number"),stateByline:a.getStateByline()})),"postMinimized"===k||"postDeleted"===k?b.addClass("minimized"):b.removeClass("minimized"),!a.options.excludeAnchor&&a.model.id&&b.attr("id","post-"+a.model.id),a.contentNode=b.find("[data-role=post-content]"),a.childrenNode=b.find("[data-role=children]"),a.messageNode=a.contentNode.find("[data-role=message]"),a.highlightSyntax(),a.processMentions(),a.initCards(),a.updatePostStateClasses(),a.renderMedia(),a.model.get("isRealtime")&&(a.trackPosition=!0,a.listenToOnce(d.postsView,"render:end",a.markSeen)),a.listenToOnce(d.postsView,"render:end",function(){a.markSeen(),a.manageMessageHeight()}),a},highlightSyntax:function(){var a=this.contentNode.find("pre code");a.length&&a.each(function(){g.syntaxHighlighter.highlight(this)})},redraw:function(){var a=document.createDocumentFragment();this.childrenNode.children().appendTo(a),this.render(),this.childrenNode.append(a),h.getLounge().postsView.trigger("render:end")},processMentions:function(){this.contentNode.find("[data-dsq-mention]").each(function(){a(this).addClass("mention")})},attachChild:function(a){var b=a.model;b.created||!b.id||b.get("isImmediateReply")?this.childrenNode.prepend(a.el):this.childrenNode.append(a.el)},toggleReply:function(){this.reply&&this.reply.isOpen()?this.hideReply():this.showReply()},toggleReplyLink:function(a){this.contentNode.find("[data-role=reply-link]").toggleClass("active",a)},showReply:function(){this.reply?(this.reply.prependTo(this.$el.find("[data-role=reply-form]")),this.reply.show(),this.reply.focus()):this.getReplyView(),this.toggleReplyLink(!0)},hideReply:function(){this.reply&&(this.reply.hide(),this.toggleReplyLink(!1))},toggleEdit:function(){return this.contentNode.find("[data-role=edit-link]").toggleClass("active"),this.edit?(this.edit.hide(),this.edit.remove(),this.edit=null,void this.messageNode.show()):void this.showEdit()},showEdit:function(){if(this.session.isLoggedOut())return void this.session.once("change:id",this.toggleEdit,this);if(this.model.canBeEdited(this.session,this.thread)&&!this.edit){this.edit=new(require("lounge/views/posts").PostEditView)({post:this.model,session:this.session}),this.edit.render(),this.listenTo(this.edit,"submitted cancel",this.toggleEdit),this.expand(!0),this.edit.show();var a=this.messageNode;this.edit.prependTo(a.parent()),a.hide(),this.edit.resize();var b=h.getLounge();b&&b.scrollToPost(this.model.id)}},removeAsDeleted:function(){this.redraw()},initCards:function(){var a=this;a.initProfileCard(),a.initContextCard(),a.initUpvotersCard()},initProfileCard:function(){if(!g.isPhone(window)){var a=this.$el.find(".hovercard");a.length&&(this.profileCard=j.ProfileCard.create({session:this.session,user:this.model.author,targetElement:a}))}},initContextCard:function(){if(!g.isPhone(window)){var a=this.parent&&this.parent.model;a&&!a.get("isDeleted")&&(this.contextCard=j.ContextCard.create({post:a,targetElement:this.$el.find("[data-role=parent-link]")}))}},initUpvotersCard:function(){if(!g.isPhone(window)){var a=this.$el.find("[data-action=upvote]");a.length&&(this.upvotersCard=j.UpvotersCard.create({session:this.session,model:this.model,postId:this.model.get("id"),targetElement:a}))}},_onShare:l(function(a){var b=g.extractService(a.target,"share");b&&(h.getLounge().trigger("uiAction:postShare",this.model,b),this.share(b))}),_shareUrl:function(){return this.thread.url()+"#comment-"+this.model.id},handleBlacklist:l(function(){if(!this.blacklist){var a=this.blacklist=new(require("lounge/views/posts").BlacklistView)({model:this.model});a.render(),this.listenTo(a,"success cancel",function(){this.blacklist.remove(),this.blacklist=null}),this.contentNode.find("[data-role=blacklist-form]").first().append(a.el)}}),toggleCollapse:function(a){this.$el.toggleClass("collapsed",a)},handleCollapse:l(function(){this.toggleCollapse()}),handleHighlight:l(function(){this.model.highlight(),this.alert(e.render("highlightedSuccessMessage"),{safe:!0,type:"success"}),this.thread.set("highlightedPost",this.model);var a=h.getLounge();a&&a.scrollToPost(this.model.id)}),handleUnhighlight:l(function(){this.model.unhighlight(),this.dismissAlert(),this.thread.unset("highlightedPost")}),handleVote:function(a,b){var c=h.getLounge(),d=this.model.get("userScore")===b;d?c.trigger("uiAction:postUnvote",this.model,a):1===b?c.trigger("uiAction:postUpvote",this.model,a):-1===b&&c.trigger("uiAction:postDownvote",this.model,a),this.model.vote(d?0:b)},remove:function(){this.model.off(null,null,this),this.session.off(null,null,this),c.View.prototype.remove.call(this)},getReplyView:function(){return this.reply?this.reply:(this.reply=new(require("lounge/views/posts").PostReplyView)({parentView:this,parent:this.model,thread:this.thread,session:this.options.session,userSuggestions:this.userSuggestions}),this.reply.render(),this.showReply(),this.reply)},handleDownvoteTooltipLink:function(a){a.stopPropagation()},handleReply:l(function(){this.toggleReply()}),handleFlag:l(function(){if(!this.model.get("isFlaggedByUser")){var a=m("Are you sure you want to flag this comment?");window.confirm(a)&&(this.model.report(),this.model.set("isFlaggedByUser",!0))}}),handleEdit:l(function(){this.toggleEdit()}),handleDelete:l(function(){this.model.get("isHighlighted")&&(this.model.set("isHighlighted",!1),this.thread.unset("highlightedPost")),this.model._delete()}),handleSpam:l(function(){this.model.spam()}),handleReveal:l(function(){this.model.set("isMinimized",!1),this.redraw()}),handleExpandMessage:l(function(){return this.expand()})},{getHighestAncestor:function(a){return a.closest("[data-role=message] > *")}});return b.extend(n.prototype,i.ShareMixin),b.extend(n.prototype,i.AlertMixin),i.asCollapsible.call(n.prototype,{collapsedHeight:374,collapseTargetSelector:"[data-role=message-container]",collapseScope:"contentNode"}),n}),define("lounge/views/posts/collection",["jquery","underscore","backbone","moment","common/bus","common/models","lounge/views/posts","lounge/views/post"],function(a,b,c,d,e,f,g,h){"use strict";var i=c.View.extend({STREAMING_MAX_VISIBLE:250,events:{"click [data-action=more-posts]":"handleLoadMore"},initialize:function(a){this.lounge=a.lounge,this.thread=a.thread,this.userSuggestions=a.userSuggestions,this.posts=a.posts,this.postsToAppend=[],this.postsToPrepend=[],this.session=a.session,this.subViews={},this.state={nextPassTimeoutId:null,renderedPosts:[],clearDomAfterRender:!1,totalPostsProcessed:0,totalElapsedTime:0},this.listenTo(this.posts,{reset:this.redrawPosts,add:this.addPosts,remove:this.removePost}),this.listenTo(this.thread,"change:highlightedPost",this.handleHasHighlightedState),this.listenTo(this.posts,"reset add",this.toggleNoPosts),this.listenTo(this.posts,"reset add",this.enableTimestampUpdates),this.listenTo(this,"render:end",this.toggleLoadMorePosts),this.listenTo(this,"render:end",this.handleHasHighlightedState)},handleHasHighlightedState:function(){this.$el.toggleClass("has-highlighted-post",this.thread.has("highlightedPost"))},getPostView:function(a){return this.subViews[a]},bootstrap:function(a,c){this.permalinkOptions=c,this.listenTo(this.posts,"reset",b.bind(this.posts.restoreFromCache,this.posts)),this.listenTo(this.posts,"change:isDeleted",b.bind(this.posts.removeFromCache,this.posts)),this.posts.reset(a.posts),b.invoke(this.subViews,"manageMessageHeight")},bindUIUpdateHandlers:function(){var c=this,d=a(window),e=a(document.body),f=e.width(),g=b.debounce(function(){var a=e.width();f!==a&&c.subViews&&(f=a,b.each(c.subViews,function(a){a.manageMessageHeight()}))},50);d.on("resize",g)},updateTimestamps:function(){return!this.subViews||b.size(this.subViews)<1?!1:(b.invoke(this.subViews,"updateRelativeTime"),!0)},enableTimestampUpdates:function(){var a=this,c=6e4;if(!a.timestampUpdateTimer){var d=function(){return a.updateTimestamps()?void(a.timestampUpdateTimer=b.delay(d,c)):void(a.timestampUpdateTimer=null)};a.timestampUpdateTimer=b.delay(d,c)}},openReply:function(a){var b=this.posts.get(a);if(b){var c=this.subViews[b.cid];c.showReply()}},openEdit:function(a){var b=this.posts.get(a);if(b){var c=this.subViews[b.cid];c.showEdit()}},toggleLoadMorePosts:function(){var a=this.$el.find("#posts [data-role=more]"),b=this.posts.hasNext();b?a.show():a.hide()},handleLoadMore:function(b){b.preventDefault();var c=this,d=a(b.currentTarget),f=c.posts.currentPage();d.addClass("busy"),c.posts.more({success:function(){c.posts.restoreFromCache(c.session),c.once("render:end",function(){d.removeClass("busy")})},error:function(){d.removeClass("busy")}}),c.lounge.trigger("uiAction:seeMore",f+1),e.sendHostMessage("posts.paginate")},renderLayout:a.noop,toggleNoPosts:function(){var b=this.posts.models;b.length?a("#no-posts").hide():a("#no-posts").show()},handleSort:function(){a("#posts [data-role=more]").hide(),a("#no-posts").hide(),a("#post-list").addClass("loading").empty()},redrawPosts:function(){var a=this;a.subViews={},a.once("render:end",function(){b.each(g.PostReplyView.open,function(b,c){var d=a.subViews[c];if(d){var e=d.getReplyView();e.textarea.set(b.textarea.get()),b.isOpen()?e.show():e.hide()}})}),a.posts.setPageFor&&a.permalinkOptions&&a.permalinkOptions.postId&&a.posts.setPageFor(a.permalinkOptions.postId,{silent:!0}),a.addPosts(a.posts,{clearDom:!0})},postsShouldBePrepended:function(a){var b=a.length&&a[0];return!!b&&(b.created||!b.id||b.get("isRealtime")||b.get("isCached")||b.requestedByPermalink)},hasQueuedPosts:function(){return this.postsToAppend.length||this.postsToPrepend.length},addPosts:b.decorate(c.collectionAddNormalizer(c.Collection,f.Post),function(a,c,d){var e=this;if(d.clearDom&&(e.postsToAppend=[],e.postsToPrepend=[],e.postsShouldClearDom=!0),e.postsShouldBePrepended(a)){var f=[];b.each(a,function(a){var b=a.get("parent");b&&e.posts.get(b)?e.postsToPrepend.push(a):f.push(a)}),e.postsToPrepend=f.concat(e.postsToPrepend)}else e.postsToAppend=e.postsToAppend.concat(a);e.state.nextPassTimeoutId||(e.state.nextPassTimeoutId=window.requestAnimationFrame(function(){e.trigger("render:start"),e.addPostsIncremental()}))}),onDeferredViewReady:function(a){var b=this.subViews;b.hasOwnProperty(a)&&b[a].manageMessageHeight()},removePost:function(a){if(this.hasQueuedPosts())return void this.once("render:end",b.bind(this.removePost,this,a));var c=this.subViews[a.cid];c&&(c.remove(),delete this.subViews[a.cid])},addPostsIncremental:function(a){this.state.nextPassTimeoutId=null,this.discardRenderProgressIfClearDomRequested();var b=this.getPostModelsForThePass();b.length&&this.renderPass(b,a),this.finishPass(b),this.scheduleNextPass()},discardRenderProgressIfClearDomRequested:function(){this.postsShouldClearDom&&(this.state.clearDomAfterRender=!0,this.postsShouldClearDom=!1,this.state.renderedPosts=[])},getPostModelsForThePass:function(){return this.postsToAppend.length?this.postsToAppend:this.postsToPrepend},renderPass:function(a,b){for(var c=i.TARGET_PROCESS_TIME,d=b||this.calculatePostsForNextRun(c)||i.MINIMUM_POSTS_PER_RUN;d>0;){var e=a.splice(0,d),f=this.timedRenderPosts(e);if(null===f)break;c-=f,d=this.calculatePostsForNextRun(c)}},timedRenderPosts:function(a){if(!a.length)return null;var c=+new Date;Array.prototype.push.apply(this.state.renderedPosts,b.map(a,this.createPostView,this));var d=+new Date-c;return 0>d&&(d=0),this.state.totalElapsedTime+=d,this.state.totalPostsProcessed+=a.length,d||null},createPostView:function(a){var b,c=a.get("parent");c&&(c=this.posts.get(c),b=c&&this.getPostView(c.cid));var d=new h({parent:b,model:a,thread:this.thread,session:this.session,created:a.created,userSuggestions:this.userSuggestions});return this.subViews[a.cid]=d,d.render(),d},calculatePostsForNextRun:function(a){return 0>=a?0:this.state.totalElapsedTime<=0?this.state.totalPostsProcessed:Math.floor(a*this.state.totalPostsProcessed/this.state.totalElapsedTime)},finishPass:function(b){if(!b.length){if(this.$postList=a("#post-list"),this.state.clearDomAfterRender&&(this.$postList.empty(),this.state.clearDomAfterRender=!1),this.state.renderedPosts.length){this.removeOldPostsIfRealtime(),this.enablePostTracking(this.state.renderedPosts);var c=b===this.postsToAppend;this.insertPostElements(this.state.renderedPosts,c),this.state.renderedPosts=[]}this.$postList.removeClass("loading"),this.postsToPrepend.length||this.postsToAppend.length||this.trigger("render:end")}},removeOldPostsIfRealtime:function(){var a=b.any(this.state.renderedPosts,function(a){return a.model.get("isRealtime")});a&&this.removeOldPosts()},removeOldPosts:function(){if(this.lounge.switches&&this.lounge.switches.enabled("next_realtime_cap")){var a=b.size(this.subViews)-this.STREAMING_MAX_VISIBLE;if(!(0>=a))for(var c,e=this.posts.sortBy(function(a){return d(a.get("createdAt")).valueOf()}),f=0,g=0;f<e.length&&a>=g;f++)c=this.getPostView(e[f].cid),c&&0===c.childrenNode.children().length&&(this.posts.remove(e[f]),g+=1)}},enablePostTracking:function(a){b.each(a,function(a){a.visible=!0})},insertPostElements:function(a,c){var d=b.groupBy(a,function(a){return!!a.parent});b.each(d[!0],function(a){a.parent.attachChild(a)});var e=b.pluck(d[!1],"$el");c?this.$postList.append(e):this.$postList.prepend(e)},scheduleNextPass:function(){if(this.postsToPrepend.length||this.postsToAppend.length){var a=this.calculatePostsForNextRun(i.TARGET_FIRST_ATTEMPT_TIME);a=Math.max(a,i.MINIMUM_POSTS_PER_RUN),this.state.nextPassTimeoutId=window.requestAnimationFrame(b.bind(this.addPostsIncremental,this,a))}}});return i.TARGET_PROCESS_TIME=30,i.TARGET_FIRST_ATTEMPT_TIME=Math.floor(.8*i.TARGET_PROCESS_TIME),i.MINIMUM_POSTS_PER_RUN=2,{PostCollectionView:i}}),define("lounge/views/dashboard",["jquery","underscore","backbone","common/models","common/collections","common/utils","common/templates","lounge/common"],function(a,b,c,d,e,f,g,h){"use strict";var i=f.preventDefaultHandler,j=c.View.extend({events:{"click [data-action=more]":i(function(){this.trigger("fire")})},setBusy:function(){this.$el.find("[data-action=more]").addClass("busy").removeAttr("disabled")},setReady:function(){this.$el.find("[data-action=more]").removeClass("busy").removeAttr("disabled");var a=this.collection.cursor,b=a&&a.hasNext;b?this.$el.show():this.$el.hide()}}),k=c.View.extend({initialize:function(a){this.notifications=a.notifications,this.listenTo(this.notifications,{reset:this.resetNotifications,"add:many":this.addNotifications,"reset add:many":this.markNotificationsAsRead}),this._fetched=!1,this.moreButton=new j({collection:this.notifications}),this.listenTo(this.moreButton,"fire",this.loadMore)},render:function(){return this.renderLayout()},renderLayout:function(){return this.$el.html(g.render("notifications")),this.moreButton.setElement(this.$el.find("[data-role=more-notifications]")),this.$el.addClass("loading"),this},resetNotifications:function(a){var b=this.$el.find("[data-role=no-notifications]");b.hide(),this.$el.removeClass("loading"),0===a.size()?b.show():(b.hide(),this.addNotifications.apply(this,arguments))},addNotifications:b.decorate(c.collectionAddNormalizer(e.NotificationCollection,d.Notification),function(c){var d=b.map(c,function(b){var c=a(g.render("notification",{notification:b.toJSON()}));return c[0]});return this.$el.find("[data-role=entries]").append(d),this.moreButton.setReady(),this.notifications.markRead(),this}),show:function(){this._fetched||(this.notifications.fetch({reset:!0}),this._fetched=!0)},loadMore:function(){this.moreButton.setBusy(),this.notifications.more()}}),l=c.View.extend({initialize:function(){this.posts=new e.PostActivityCollection,this.listenTo(this.posts,{reset:this.resetActivity,"add:many":this.addActivity}),this._fetched=!1,this.moreButton=new j({collection:this.posts}),this.listenTo(this.moreButton,"fire",this.loadMore)},render:function(){return this.renderLayout()},renderLayout:function(){return this.$el.html(g.render("networkActivity")),this.moreButton.setElement(this.$el.find("[data-role=more-activity]")),this.$el.addClass("loading"),this},resetActivity:function(a){var b=this.$el.find("[data-role=no-activity]");b.hide(),this.$el.removeClass("loading"),0===a.size()?b.show():(b.hide(),this.addActivity.apply(this,arguments))},addActivity:b.decorate(c.collectionAddNormalizer(e.PostActivityCollection,d.Post),function(e){var f=new c.Collection;b.each(e,function(a){var c=f.get(a.get("thread").id)||new d.Thread(b.extend(a.get("thread"),{forum:a.get("forum")}));c.posts.add(a),f.add(c)});var h=f.map(function(b){var c=a(g.render("networkActivityThreadEntry",{thread:b.toJSON()})),d=b.posts.map(function(b){return a(g.render("networkActivityPostEntry",{post:b.toJSON()}))[0]});return c.find("[data-role=posts]").append(d),c[0]});return this.$el.find("[data-role=entries]").append(h),this.trigger("render:activity"),this.moreButton.setReady(),this}),show:function(){this._fetched||(this.posts.fetch({reset:!0}),this._fetched=!0)},loadMore:function(){this.moreButton.setBusy(),this.posts.more()}}),m=c.View.extend({events:{"click [data-action=network]":"showNetwork","click [data-action=notifications]":"showNotifications"},initialize:function(a){var c=this;c.lounge=a.lounge,c.network=new l,c.notifications=new k({notifications:a.session.notifications}),this.session=a.session,c.notificationCount=new h.NotificationCountView({session:a.session,showZero:!0}),c._views={network:c.network,notifications:c.notifications},c.listenTo(c.network,"render:activity",b.bind(c.trigger,c,"render:all"))},render:function(){this.$el.html(g.render("dashboard")),this._tabs={network:this.$el.find("[data-role=network-tab]"),notifications:this.$el.find("[data-role=notifications-tab]")},this.network.setElement(this.$el.find("[data-role=network]")),this.notifications.setElement(this.$el.find("[data-role=notifications]")),this.notificationCount.setElement(this.$el.find("[data-role=notification-count]")),this.network.render(),this.notifications.render(),this.notificationCount.render()},show:function(){this.setActiveTab("notifications")},setActiveTab:function(a){this.lounge.freeze(!0);var c=this.lounge.currentZone;this.lounge.currentZone=a,b.chain(this._tabs).invoke("removeClass","active"),this._tabs[a].addClass("active"),b.chain(this._views).pluck("$el").invoke("hide");var d=this._views[a];d.$el.show(),this.lounge.freeze(!1),d.show&&d.show(),this.lounge.trigger("uiAction:openZone",a,c)},showNetwork:i(function(){this.setActiveTab("network")}),showNotifications:i(function(){this.setActiveTab("notifications")})});return{DashboardView:m,PaginateButtonView:j,NetworkActivityCollectionView:l,NotificationCollectionView:k}}),define("lounge/views/community",["jquery","underscore","backbone","moment","when","common/time","common/templates","common/collections","lounge/common","lounge/mixins"],function(a,b,c,d,e,f,g,h,i,j){"use strict";var k=c.View.extend({tagName:"ol",initialize:function(){this.listenTo(this.collection,"reset",this.render)},render:function(){return this.$el.empty(),this.collection.each(function(a){var b=f.assureTzOffset(a.get("createdAt")),c=g.render("topThread",{id:a.id,title:a.get("title"),url:a.get("link"),numPosts:a.get("posts"),numLikes:a.get("likes"),timeAgo:d(b,f.ISO_8601).fromNow()});this.$el.append(c)},this),this.trigger("render"),this.attachPosts(),this},attachPosts:function(){this.collection.each(function(a){this.renderPost(a)},this)},renderPost:function(a){var c=a.get("topPost");if(c){var d=b.escape(b.strip(c.message));
d=b.truncate(d,160,"&hellip;");var e=g.render("topThreadPost",{message:d,author:c.author});this.$el.find("[data-role=thread-"+a.id+"] [data-role=top-thread-post]").html(e)}}}),l=c.View.extend({tagName:"ol",events:{"click [data-action=toggleFollow]":"toggleFollow"},initialize:function(){this.listenTo(this.collection,"reset",function(){i.getLounge().thread.users.add(this.collection.models,{merge:!0}),this.render()}),this.listenTo(this.collection,"change:isFollowing",this.render),this.listenTo(this,"render",this.manageHeight),this.session=i.getLounge().session,this.listenTo(this.session,"change:id",this.render),this.profileRowHeight=75},render:function(){return this.$el.empty(),this.collection.each(function(a){if(!a.get("isPrivate")){var b=g.render("topUser",{sessionId:this.session.user.id,buttonAsLink:!0,user:a.toJSON({session:this.session})});this.$el.append(b)}},this),this.trigger("render"),this},manageHeight:function(){this.el.scrollHeight-this.collapsedHeight>=this.profileRowHeight&&this.collapse()}});b.extend(l.prototype,j.FollowButtonMixin),j.asCollapsible.call(l.prototype,{collapsedHeight:297});var m=c.View.extend({initialize:function(a){var b=this;b.$el.addClass("loading"),b.forum=a.forum,b.session=a.session,b.topThreads=new k({id:"top-threads",collection:new h.TopThreadCollection(null,{forum:b.forum.id,limit:10})}),b.topUsers=new l({id:"top-users",collection:new h.TopUserCollection(null,{forum:b.forum.id,limit:20})})},fetch:b.memoize(function(){return a.when(this.topThreads.collection.fetch({reset:!0}),this.topUsers.collection.fetch({reset:!0}))},function(){return this.forum.id}),show:function(){return this.fetch().then(b.bind(this.render,this))},render:function(){this.$el.removeClass("loading"),this.$el.html(g.render("community",{forum:this.forum.toJSON()})),this.$el.find("[data-role=top-threads]").append(this.topThreads.el),this.$el.find("[data-role=top-users]").prepend(this.topUsers.el),this.topUsers.manageHeight(),this.isRendered=!0,this.trigger("render:all")}});return{CommunityView:m,TopThreadCollectionView:k,TopUserCollectionView:l}}),define("lounge/views/onboard-alert",["backbone","moment","remote/config","common/collections","common/utils","common/templates","common/time"],function(a,b,c,d,e,f,g){"use strict";var h=a.View.extend({switches:new d.SwitchCollection(c.switches,{parse:!0}),events:{"click [data-action=close]":"handleClose"},initialize:function(a){this.session=a.session},render:function(){return this.session.isLoggedIn()&&this.shouldShow()&&(this.$el.html(f.render("onboard",{displayedSection:this.session.user.isEditable(this.session)?"complete-profile":"follow"})),this.trigger("uiAction:onboardAlertShow")),this},shouldShow:function(){var a=this.getCookie();return a?a===h.COOKIE_NEW_USER||a===h.COOKIE_POPUP:!1},shouldPopup:function(){var a=this.getCookie();return a?a===h.COOKIE_NEW_USER:!1},getCookie:function(){return e.cookies.read(h.COOKIE_NAME)},setInitialCookie:function(){this.joinedRecently(this.session.user)&&e.cookies.create(h.COOKIE_NAME,h.COOKIE_NEW_USER,{expiresIn:2592e6})},setPopupCookie:function(){this.shouldPopup()&&e.cookies.create(h.COOKIE_NAME,h.COOKIE_POPUP,{expiresIn:2592e6})},joinedRecently:function(a){var c=a.get("joinedAt");if(!c)return!1;var d=g.assureTzOffset(a.get("joinedAt"));return b().subtract(10,"seconds").isBefore(d)},eraseCookie:function(){e.cookies.erase(h.COOKIE_NAME)},handleClose:function(a){a.preventDefault(),this.remove(),this.trigger("uiAction:onboardAlertDismiss")},remove:function(){this.eraseCookie(),this.session=null,a.View.prototype.remove.call(this)}},{COOKIE_NAME:"disqus.onboarding",COOKIE_NEW_USER:"newUser",COOKIE_POPUP:"popup"});return{OnboardAlert:h}}),define("core/bus",["backbone","underscore"],function(a,b){"use strict";return b.extend({},a.Events)}),define("lounge/views/notification-menu",["underscore","backbone","core/api","core/analytics/experiment","core/bus","remote/config","common/templates","common/views/mixins"],function(a,b,c,d,e,f,g,h){"use strict";var i=function(){return c.call("timelines/getUnreadCount.json",{data:{type:"notifications"}})},j=b.View.extend({initialize:function(b){var c=this.session=b.session;this.counterEnabled=!1,this.listenTo(c,"change:id",this.render),this.listenTo(c,"change:notificationCount",this.updateCount),this.listenTo(c,"change:id",function(){c.isLoggedOut()||(d.isActive("homenotifs")?(c.set("notificationCount",0),i().done(function(a){c.set("notificationCount",a.response)})):f.lounge.dark_test_unread_count>Math.random()&&i())});var e=this;d.isActive("bubbleanimation")?this.once("viewport:enter",function(){a.delay(function(){e.counterEnabled=!0,e.updateCount()},150)}):this.counterEnabled=!0},render:function(){return this.$el.html(g.render("notificationMenu",{isRegistered:this.session.isLoggedIn(),user:this.session.toJSON()})),this.updateCount(),this},updateCount:function(){var a=this.session.get("notificationCount")||0;a>0&&this.counterEnabled?(this.$("[data-role=notification-count]").html(a>9?'9<i class="icon icon-plus"></i>':a),this.$el.addClass("unread")):(this.$("[data-role=notification-count]").html(""),this.$el.removeClass("unread"))}});return a.extend(j.prototype,h.IsVisibleViewMixin),{NotificationMenuView:j}}),define("lounge/views/highlighted-post",["backbone","underscore","jquery","common/models","common/templates","lounge/views/post"],function(a,b,c,d,e,f){"use strict";var g=a.View.extend({template:"highlightedPost",itemViewContainer:".post-list",initialize:function(a){b.extend(this,b.pick(a,["thread","session","switches","userSuggestions"])),this.listenTo(this.thread,"change:highlightedPost",this.reset)},getPost:function(){return this.post?c.Deferred().resolve(this.post):this.getHighlightedPost()},_getHighlightedPost:function(){var a=this.thread.get("highlightedPost");return a?(a instanceof d.Post||(a=new d.UniqueModel(d.Post,a)),a.get("isDeleted")?null:a.get("isHighlighted")?a:null):null},getHighlightedPost:function(){var a,e=this.post=this._getHighlightedPost(),f=c.Deferred();return e?(a=e.getParent())&&!a.author?d.Post.fetchContext(a.id,this.thread).always(b.bind(f.resolve,f)):f.resolve():f.reject(),f.promise()},reset:function(){delete this.post,this.getPost().always(b.bind(this.render,this))},createPostView:function(){return this.post?new h({model:this.post,thread:this.thread,session:this.session,userSuggestions:this.userSuggestions,excludeAnchor:!0}).stopListening(this.post.usersTyping):null},render:function(){var a=this.createPostView();return a?(a.render(),this.$el.html(e.render(this.template)),this.$(this.itemViewContainer).append(a.el),this.$el.show(),this):(this.$el.hide(),this)}}),h=f.extend({getPostAttributes:function(){var a=f.prototype.getPostAttributes.apply(this,arguments);return a.canBeRepliedTo=!1,a},getStateByline:function(){return!1}});return{HighlightedPostView:g,FeaturedPostView:h}}),define("lounge/views/realtime",["underscore","backbone","common/templates","common/utils","lounge/common"],function(a,b,c,d,e){"use strict";var f=d.preventDefaultHandler,g=b.View.extend({initialize:function(a){this.options=a},events:{click:"handleDrain"},getDirection:function(a){if(this.offset&&this.dim){var b=a.pageOffset,c=b+a.height,d=this.offset.top+a.frameOffset.top,e=d+this.dim.height;return b>e?1:d>c?-1:0}},setCount:function(a){this.options.count=a},render:function(){var b=this;return 0===b.options.count?void b.$el.hide():(b.$el.html(c.render("realtimeCommentNotification",{comments:b.options.count})),b.listenTo(e.getLounge(),"domReflow",a.throttle(function(){0!==b.options.count&&(this.offset=b.$el.offset(),this.dim=b.$el.dim())},400)),void b.$el.show())},handleDrain:f(function(){this.model.queue.drain(),this.setCount(this.model.queue.counters.comments),this.render()})}),h=g.extend({events:{click:"handleDrain"},getDirection:function(a){if(this.options.postView.visible){this.offset=this.options.postView.offset,this.dim=this.options.postView.dim;var b=g.prototype.getDirection.call(this,a);return delete this.offset,delete this.dim,b}},render:function(){var b=this,d=b.options.postView;return 0===b.options.count?(b.$el.hide(),void(d.trackPosition=!1)):(d.trackPosition=!0,b.$el.html(c.render("realtimeReplyNotification",{replies:b.options.count})),b.$el.show(),void a.delay(function(){b.$el.addClass("reveal")},13))},handleDrain:f(function(){var a=this.model.id,b=this.options.postView,c=this.options.thread.queue;c.drain(a),this.setCount(c.counters.replies[a]),b.trackPosition=!1,this.render()})});return{QueuedPostView:g,QueuedReplyView:h}}),define("lounge/views/posts/UserSuggestionsManager",["underscore","jquery","backbone","common/collections"],function(a,b,c,d){"use strict";function e(){this.remotes=[]}return a.extend(e.prototype,{fetch:function(){return b.when.apply(b,a.chain(this.remotes).where({shouldFetch:!0}).map(this.fetchRemote,this).value())},fetchRemote:function(a){return a.collection.fetch().done(function(){a.shouldFetch=!1})},addRemote:function(a,b){b=b||{},this.remotes.push({collection:a,shouldFetch:b.shouldFetch})},all:function(){var b=new d.UserCollection;return b.add(a.chain(this.remotes).map(function(a){return a.collection.models}).flatten().value()),b},find:function(a,b){if(a&&a.length){var c,d=new RegExp(a.join(" ").replace(/[^\w\s]/,""),"i"),e=5,f=this.all(),g=[],h=0,i=1===a.length&&""===a[0]?function(){return!0}:function(a){return d.test(a.get("name"))||d.test(a.get("username"))};for(h=0;h<f.models.length&&g.length<e;h++)c=f.models[h],c.get("isAnonymous")||b.get(c.cid)||i(c)&&g.push(c);return g}},get:function(a){return this.all().get(a)}}),e}),define("lounge/views/viglink",["jquery","underscore","backbone","common/bus"],function(a,b,c,d){"use strict";var e=c.Model.extend({initialize:function(a){this.handlers={},this.listenTo(d,"viglink:getaffiliatelink:response",this.handleViglinkResponse),d.sendHostMessage("viglink:init",{clientUrl:a.linkAffiliatorClient,apiUrl:a.linkAffiliatorAPI,key:a.viglinkAPI,id:a.forumPk})},handleViglinkResponse:function(a){a=a||{};var b=this.handlers[a.linkId];b&&b(a)},fetchAffiliateLink:function(c,e){var f=a.Deferred();if(!this.shouldFetchAffiliateLink(c))return f.resolve();var g=b.uniqueId("viglink_");return d.sendHostMessage("viglink:getaffiliatelink",{linkId:g,url:e[0].href}),this.handlers[g]=function(a){a=a||{},a.url&&e.attr("href",a.url),f.resolve()},f.promise()},shouldFetchAffiliateLink:function(a){if("_blank"===a.currentTarget.getAttribute("target"))return!1;var b=a.ctrlKey||a.metaKey||a.altKey||a.shiftKey,c=a.which&&1===a.which||0===a.button;return b||!c?!1:"nofollow"!==a.currentTarget.getAttribute("rel")?!1:!0}});return e}),define("lounge/tracking",["jquery","underscore","common/intelligence","core/analytics/experiment","common/juggler","core/analytics/jester","core/bus","core/config","common/urls"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(b){return a(b.currentTarget).closest("[data-tracking-area]").attr("data-tracking-area")}function k(a,d){var k=e.client("juggler",!0),n=new c.Intelligence,o=d.initialData,p=d.switches;if(b.isObject(o)&&!b.isEmpty(o)){d.session.on("change:id",function(a){f.client.set("user_id",a.id)}),d.session.once("identify",function(){var c=this,f=c.user.id;f&&(k.overwrite({user_id:f}),e.client("jester",!0).overwrite({user_id:f}));var g={thread_slug:o.thread.slug,user_type:c.user.get("user_type")||"anon",referrer:a.document.referrer,theme:"next"},h=o.forum.settings;h&&b.has(h,"organicDiscoveryEnabled")&&b.extend(g,{organic_enabled:h.organicDiscoveryEnabled,promoted_enabled:h.promotedDiscoveryEnabled,max_enabled:h.discoveryMax,thumbnails_enabled:h.discoveryThumbnailsEnabled}),e.client("jester",!0).emit("init_embed",g),n.init({version:"next",forum:o.forum.id,features:o.features,session:c.user}),d.session.on("change:id",function(a){n.setSession(a),n.trackEvent(a.id?"login":"logout")})}),k.load({disable:!p.enabled("juggler_enabled"),url:i.juggler+"/event.js",disableSSL:p.enabled("next_disable_ssl_juggler"),thread:o.thread.id,forum:o.forum.id,forum_id:o.forum.pk}),e.client("jester",!0).load(b.extend(k.copySettings(),{url:i.jester+"/event.js"})),f.client.set({product:"embed",thread:o.thread.id,forum:o.forum.id,forum_id:o.forum.pk,zone:"thread",version:h.version}),d.once("bootstrap:complete",function(){f.client.set({page_url:d.config.referrer}),f.client.setHostReferrer(d.config.hostReferrer)});var q={inViewport:function(){n.trackEvent("view_embed"),f.client.emit({verb:"view",object_type:"product",object_id:"embed"}),d.off("inViewport")},"uiAction:createPost":function(a){d.session.user.id||n.setSession("guest"),n.trackEvent(null!=a.get("parent")?"post_comment_reply":"post_comment")},"uiCallback:postCreated":function(a,c){c=c||{},b.extend(c,{object_type:"post",object_id:a.id,verb:"post"}),a.has("parent")&&(c.target_type="comment",c.target_id=a.get("parent")),f.client.emit(c)},"uiAction:seeMore":function(a){f.client.emit({verb:"open",object_type:"section",object_id:"thread/page-"+a})},"uiAction:postUpvote":function(a,b){n.trackEvent("like_comment"),f.client.emit({verb:"like",object_type:"post",object_id:a.id,area:j(b)})},"uiAction:postUnvote":function(a,b){f.client.emit({verb:"unlike",object_type:"post",object_id:a.id,area:j(b)})},"uiAction:postDownvote":function(a,b){n.trackEvent("dislike_comment"),f.client.emit({verb:"dislike",object_type:"post",object_id:a.id,area:j(b)})},"uiAction:upvotersCardShow":function(){n.trackEvent("upvoters_card_shown")},"uiAction:showProfileFromUpvotes":function(){n.trackEvent("upvoters_profile_click")},"uiAction:threadUnlike":function(){f.client.emit({verb:"unlike",object_type:"thread",zone:m[d.currentZone]})},"uiAction:threadLike":function(){n.trackEvent("like_thread"),f.client.emit({verb:"like",object_type:"thread"})},"uiAction:postShare":function(a,b){n.trackEvent("share_comment_"+b),f.client.emit({verb:"share",object_type:"post",object_id:a.id,target_type:"service",target_id:b})},"uiAction:threadShare":function(a){n.trackEvent("share_thread_"+a),f.client.emit({verb:"share",object_type:"thread",target_type:"service",target_id:a})},"uiAction:openZone":function(a){l[a]&&n.trackEvent("open_"+l[a]),f.client.set({zone:m[a],section:"default"}),f.client.emit({verb:"view",object_type:"section",object_id:m[a]+"/default"})},"uiAction:clickLink":function(a,b){f.client.emit({verb:"click",object_type:"link",object_id:a[0].href,area:j(b)})},"uiAction:followUser":function(a){n.trackEvent("follow_user"),f.client.emit({verb:"follow",object_type:"user",object_id:a.id})},"uiAction:unfollowUser":function(a){f.client.emit({verb:"stop-following",object_type:"user",object_id:a.id})},"uiAction:openLogin":function(a){n.trackEvent("open_login_"+a),f.client.emit({verb:"open",object_type:"login",object_id:a})},"uiAction:finishRegistrationEmbed":function(){n.trackEvent("finish_registration_embed")},"uiAction:finishRegistrationWindow":function(){n.trackEvent("finish_registration_window")},"uiAction:finishAccountComplete":function(){n.trackEvent("finish_account_complete")},"uiAction:onboardAlertShow":function(){f.client.emit({verb:"view",object_type:"area",object_id:"onboard_alert"})},"uiAction:onboardOpen":function(){f.client.emit({verb:"open",object_type:"zone",object_id:"onboard"})},"uiAction:onboardAlertDismiss":function(){f.client.emit({verb:"close",object_type:"area",object_id:"onboard_alert"})}};d.on(q),g.on(q)}}var l={community:"community",notifications:"mydisqus",network:"mydisqus_network"},m={community:"community",conversation:"thread",notifications:"notifications",network:"activityfeed",dashboard:"notifications"};return{init:function(a){k(window,a)},getEventTrackingArea:j}}),define("lounge/views/homeNotifications",["backbone","jquery","underscore","common/templates"],function(a,b,c,d){"use strict";var e=a.View.extend({initialize:function(a){this.session=a.session;var b=this;this.markOldAsRead=c.once(function(){b.session.notifications.fetch({reset:!0}).done(function(){b.session.notifications.markRead()})})},show:function(){if(this.trigger("render:all"),!this.notifications){var a=this;require(["require","lounge.notifications"],function(c){c(["home/views/NotificationsView","home/models/Notifications","home/models/Session","home/models/User","home/backbone.overrides"],function(c,d,e,f){var g=new e,h=new f(a.session.user.attributes);g.setUser(h);var i=new d;i.ensureFetched(),a.notifications=new c({model:i,activeTab:"all"}),a.notifications.render(),a.$("[data-role=home-notifications]").html(a.notifications.$el).addClass("home-notifications").on("click",'a[href^="/home"]',function(){var a=b(this);a.attr("href","//disqus.com"+a.attr("href")),a.attr("target","_blank")}),a.notifications.trigger("show"),a.listenToOnce(a.notifications.getTabView("all").model,"clearUnreadCount",function(){a.session.set("notificationCount",0)})})}),this.markOldAsRead()}},render:function(){this.$el.html(d.render("homeNotifications"))}});return e}),define("templates/lounge",["handlebars"],function(a){return a.template(function(a,b,c,d,e){function f(a,b){var d,e="";return e+="\n\n",d=c["if"].call(a,a&&a.sessionUserId,{hash:{},inverse:_e.noop,fn:_e.program(2,g,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function g(a,b){var d,e="";return e+='\n<div class="follow-btn-wrap">\n',d=c["if"].call(a,(d=a&&a.user,null==d||d===!1?d:d.isSession),{hash:{},inverse:_e.program(6,j,b),fn:_e.program(3,h,b),data:b}),(d||0===d)&&(e+=d),e+="\n</div>\n"}function h(a,b){var d,e="";return e+="\n",d=c["if"].call(a,(d=a&&a.user,null==d||d===!1?d:d.isEditable),{hash:{},inverse:_e.noop,fn:_e.program(4,i,b),data:b}),(d||0===d)&&(e+=d),e+="\n\n\n"}function i(a,b){var d="";return d+='\n<a href="#" data-action="edit-profile" target="_blank" class="btn follow-btn edit-profile">'+$e(c.gettext.call(a,"Edit profile",{hash:{},data:b}))+"</a>\n"}function j(a,b){var d,e="";return e+="\n",d=c["if"].call(a,(d=a&&a.user,null==d||d===!1?d:d.isPrivate),{hash:{},inverse:_e.program(9,l,b),fn:_e.program(7,k,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function k(a,b){var d="";return d+='\n<span class="btn follow-btn private">\n<i aria-hidden="true" class="icon-lock"></i>\n<span class="btn-text">'+$e(c.gettext.call(a,"Private",{hash:{},data:b}))+"</span>\n</span>\n"}function l(a,b){var d,e="";return e+='\n<a href="'+$e((d=a&&a.user,d=null==d||d===!1?d:d.profileUrl,typeof d===af?d.apply(a):d))+'" class="btn follow-btn ',d=c["if"].call(a,(d=a&&a.user,null==d||d===!1?d:d.isFollowing),{hash:{},inverse:_e.noop,fn:_e.program(10,m,b),data:b}),(d||0===d)&&(e+=d),e+='" data-action="follow-user" data-user="'+$e((d=a&&a.user,d=null==d||d===!1?d:d.id,typeof d===af?d.apply(a):d))+'">\n<span class="btn-text following-text">'+$e(c.gettext.call(a,"Following",{hash:{},data:b}))+'</span>\n<span class="btn-text follow-text">'+$e(c.gettext.call(a,"Follow",{hash:{},data:b}))+'</span>\n<i aria-hidden="true" class="icon-plus"></i> \n<i aria-hidden="true" class="icon-checkmark"></i>\n</a>\n'}function m(){return"following"}function n(a,b){var d,e="";return e+='\n<a class="close" data-action="dismiss">×</a>\n',d=c["if"].call(a,a&&a.safe,{hash:{},inverse:_e.program(15,p,b),fn:_e.program(13,o,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function o(a,b){var d="";return d+="\n<span>"+$e(c.html.call(a,a&&a.message,{hash:{},data:b}))+"</span>\n"}function p(a){var b,c="";return c+="\n<span>"+$e((b=a&&a.message,typeof b===af?b.apply(a):b))+"</span>\n"}function q(a,b){var d,e="";return e+="\n<h5>"+$e(c.gettext.call(a,"Add to blacklist",{hash:{},data:b}))+"</h5>\n\n",d=c["if"].call(a,(d=a&&a.post,d=null==d||d===!1?d:d.author,null==d||d===!1?d:d.isRegistered),{hash:{},inverse:_e.noop,fn:_e.program(18,r,b),data:b}),(d||0===d)&&(e+=d),e+='\n\n<label><input type="checkbox" name="email" value="'+$e((d=a&&a.post,d=null==d||d===!1?d:d.author,d=null==d||d===!1?d:d.email,typeof d===af?d.apply(a):d))+'"> '+$e(c.gettext.call(a,"Email",{hash:{},data:b}))+": "+$e((d=a&&a.post,d=null==d||d===!1?d:d.author,d=null==d||d===!1?d:d.email,typeof d===af?d.apply(a):d))+'</label>\n\n<label><input type="checkbox" name="ip" value="'+$e((d=a&&a.post,d=null==d||d===!1?d:d.ipAddress,typeof d===af?d.apply(a):d))+'"> '+$e(c.gettext.call(a,"IP Address",{hash:{},data:b}))+": "+$e((d=a&&a.post,d=null==d||d===!1?d:d.ipAddress,typeof d===af?d.apply(a):d))+'</label>\n\n<label><input type="checkbox" name="retroactive" value="1"/> '+$e(c.gettext.call(a,"Apply retroactively",{hash:{},data:b}))+'</label>\n\n<div class="actions">\n<button class="btn btn-small" type="submit">'+$e(c.gettext.call(a,"Save",{hash:{},data:b}))+'</button>\n<button class="btn btn-small" data-action="cancel">'+$e(c.gettext.call(a,"Cancel",{hash:{},data:b}))+"</button>\n</div>\n"}function r(a,b){var d,e="";return e+='\n<label><input type="checkbox" name="user" value="'+$e((d=a&&a.post,d=null==d||d===!1?d:d.author,d=null==d||d===!1?d:d.id,typeof d===af?d.apply(a):d))+'" checked="checked"/> '+$e(c.gettext.call(a,"User",{hash:{},data:b}))+": "+$e((d=a&&a.post,d=null==d||d===!1?d:d.author,d=null==d||d===!1?d:d.username,typeof d===af?d.apply(a):d))+"</label>\n"}function s(a,b){var d="";return d+="\n"+$e(c.gettext.call(a,"We are unable to post your comment because you have been blocked by %(forumName)s.",{hash:{forumName:a&&a.forumName},data:b}))+'\n<a target="_blank" href="http://help.disqus.com/customer/portal/articles/466223-who-deleted-or-removed-my-comment-">'+$e(c.gettext.call(a,"Find out more.",{hash:{},data:b}))+"</a>\n"}function t(a){var b,c="";return c+='\n<link rel="stylesheet" href="'+$e((b=a&&a.loungeCss,typeof b===af?b.apply(a):b))+'">\n<div class="bubble">\n<div class="tooltip">\n<button class="close" data-action="close" title="Close">&times;</button>\n<div id="message">\n</div>\n</div>\n</div>\n'}function u(a,b){var d,e="";return e+="\n\n",d=c["if"].call(a,a&&a.topUser,{hash:{},inverse:_e.program(30,y,b),fn:_e.program(25,v,b),data:b}),(d||0===d)&&(e+=d),e+='\n\n\n<ul class="top-commenters">\n',d=c.each.call(a,a&&a.users,{hash:{},inverse:_e.noop,fn:_e.program(32,z,b),data:b}),(d||0===d)&&(e+=d),e+="\n</ul>\n\n"}function v(a,b){var d,e="";return e+="\n",d=c["if"].call(a,a&&a.usersCount,{hash:{},inverse:_e.program(28,x,b),fn:_e.program(26,w,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function w(a,b){var d="";return d+="\n"+$e(c.gettext.call(a,"Join %(topUser)s and %(usersCount)s others in comments below.",{hash:{usersCount:a&&a.usersCount,topUser:c.getPartial.call(a,"userName",a&&a.topUser,{hash:{},data:b})},data:b}))+"\n"}function x(a,b){var d="";return d+="\n"+$e(c.gettext.call(a,"Join %(topUser)s in comments below.",{hash:{topUser:c.getPartial.call(a,"userName",a&&a.topUser,{hash:{},data:b})},data:b}))+"\n"}function y(a,b){var e,f="";return f+="\n",e=_e.invokePartial(d.topThreadLink,"topThreadLink",a&&a.topThread,c,d,b),(e||0===e)&&(f+=e),f+="\n"}function z(a,b){var d,e="";return e+='\n<li>\n<img src="'+$e((d=a&&a.avatar,d=null==d||d===!1?d:d.cache,typeof d===af?d.apply(a):d))+'" class="user" alt="'+$e(c.gettext.call(a,"Avatar",{hash:{},data:b}))+'" />\n</li>\n'}function A(a){var b,c="";return c+='\n<span class="author publisher-anchor-color"><a data-user="'+$e((b=a&&a.id,typeof b===af?b.apply(a):b))+'" data-role="username">'+$e((b=a&&a.name,typeof b===af?b.apply(a):b))+"</a></span>\n"}function B(a,b){var d,e="";return e+='\n\n<a href="'+$e((d=a&&a.link,typeof d===af?d.apply(a):d))+'" target="_blank" class="top-thread-link-overlay">\n</a>\n<span id="top-threads">\n<span id="community">\n<h3>'+$e(c.gettext.call(a,"Top Discussions on %(forum)s",{hash:{forum:c.getPartial.call(a,"communityForum",a&&a.forum,{hash:{},data:b})},data:b}))+'</h3>\n</span>\n<span class="publisher-anchor-color top-thread-link"><a>'+$e((d=a&&a.title,typeof d===af?d.apply(a):d))+'</a></span>\n<ul class="meta">\n',d=c["if"].call(a,a&&a.likes,{hash:{},inverse:_e.noop,fn:_e.program(37,C,b),data:b}),(d||0===d)&&(e+=d),e+="\n\n",d=c["if"].call(a,c.gt.call(a,a&&a.posts,0,{hash:{},data:b}),{hash:{},inverse:_e.program(46,H,b),fn:_e.program(39,D,b),data:b}),(d||0===d)&&(e+=d),e+='\n\n<li class="time">'+$e((d=a&&a.timeAgo,typeof d===af?d.apply(a):d))+"</li>\n</ul>\n</span>\n"}function C(a,b){var d="";return d+='\n<li class="likes">\n<a>\n<span class="icon-star"></span>\n'+$e(c.gettext.call(a,"%(numLikes)s starred this",{hash:{numLikes:a&&a.likes},data:b}))+"\n</a>\n</li>\n"}function D(a,b){var d,e="";return e+="\n",d=c["if"].call(a,a&&a.likes,{hash:{},inverse:_e.noop,fn:_e.program(40,E,b),data:b}),(d||0===d)&&(e+=d),e+='\n\n<li class="comments">\n<a>\n',d=c["if"].call(a,c.eq.call(a,a&&a.posts,1,{hash:{},data:b}),{hash:{},inverse:_e.program(44,G,b),fn:_e.program(42,F,b),data:b}),(d||0===d)&&(e+=d),e+='\n</a>\n</li>\n<li class="bullet">&bull;</li>\n'}function E(){return'\n<li class="bullet">&bull;</li>\n'}function F(a,b){var d="";return d+="\n"+$e(c.gettext.call(a,"1 comment",{hash:{},data:b}))+"\n"}function G(a,b){var d="";return d+="\n"+$e(c.gettext.call(a,"%(numPosts)s comments",{hash:{numPosts:a&&a.posts},data:b}))+"\n"}function H(a,b){var d,e="";return e+="\n",d=c["if"].call(a,a&&a.likes,{hash:{},inverse:_e.noop,fn:_e.program(40,E,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function I(a){var b,c="";return c+="\n<strong>"+$e((b=a&&a.name,typeof b===af?b.apply(a):b))+"</strong>\n"}function J(a,b){var d="";return d+='\n<div>\n<div class="row">\n<h3>'+$e(c.gettext.call(a,"Top Commenters on %(forum)s",{hash:{forum:c.getPartial.call(a,"communityForum",a&&a.forum,{hash:{},data:b})},data:b}))+'</h3>\n\n<div data-role="top-users">\n\n<a class="see-more hidden" title="'+$e(c.gettext.call(a,"see more",{hash:{},data:b}))+'" data-action="see-more">'+$e(c.gettext.call(a,"see more",{hash:{},data:b}))+'</a>\n</div>\n\n</div>\n\n<div class="row">\n<h3>'+$e(c.gettext.call(a,"Top Discussions on %(forum)s",{hash:{forum:c.getPartial.call(a,"communityForum",a&&a.forum,{hash:{},data:b})},data:b}))+'</h3>\n<div data-role="top-threads"></div>\n</div>\n</div>\n'}function K(a,b){var d,e="";return e+='\n<div class="tooltip">\n<div class="notch"></div>\n\n',d=c["if"].call(a,(d=a&&a.post,d=null==d||d===!1?d:d.author,null==d||d===!1?d:d.isAnonymous),{hash:{},inverse:_e.program(55,M,b),fn:_e.program(53,L,b),data:b}),(d||0===d)&&(e+=d),e+='\n\n<img src="'+$e((d=a&&a.post,d=null==d||d===!1?d:d.author,d=null==d||d===!1?d:d.avatar,d=null==d||d===!1?d:d.cache,typeof d===af?d.apply(a):d))+'" class="user" alt="'+$e(c.gettext.call(a,"Avatar",{hash:{},data:b}))+'" />\n\n',d=c["if"].call(a,(d=a&&a.post,d=null==d||d===!1?d:d.author,null==d||d===!1?d:d.isAnonymous),{hash:{},inverse:_e.program(59,O,b),fn:_e.program(57,N,b),data:b}),(d||0===d)&&(e+=d),e+='\n\n<div class="content">\n<h3>\n',d=c.unless.call(a,(d=a&&a.post,d=null==d||d===!1?d:d.author,null==d||d===!1?d:d.isAnonymous),{hash:{},inverse:_e.noop,fn:_e.program(61,P,b),data:b}),(d||0===d)&&(e+=d),e+="\n\n<h3>"+$e((d=a&&a.post,d=null==d||d===!1?d:d.author,d=null==d||d===!1?d:d.name,typeof d===af?d.apply(a):d))+"</h3>\n\n",d=c.unless.call(a,(d=a&&a.post,d=null==d||d===!1?d:d.author,null==d||d===!1?d:d.isAnonymous),{hash:{},inverse:_e.noop,fn:_e.program(59,O,b),data:b}),(d||0===d)&&(e+=d),e+="\n</h3>\n\n<p>"+$e(c.html.call(a,(d=a&&a.post,null==d||d===!1?d:d.excerpt),{hash:{},data:b}))+"</p>\n</div>\n</div>\n"}function L(){return'\n<div class="avatar">\n'}function M(a){var b,c="";return c+='\n<a href="'+$e((b=a&&a.post,b=null==b||b===!1?b:b.author,b=null==b||b===!1?b:b.profileUrl,typeof b===af?b.apply(a):b))+'" class="avatar" data-action="profile" data-user="'+$e((b=a&&a.post,b=null==b||b===!1?b:b.author,b=null==b||b===!1?b:b.id,typeof b===af?b.apply(a):b))+'">\n'}function N(){return"\n</div>\n"}function O(){return"\n</a>\n"}function P(a){var b,c="";return c+='\n<a href="'+$e((b=a&&a.post,b=null==b||b===!1?b:b.author,b=null==b||b===!1?b:b.profileUrl,typeof b===af?b.apply(a):b))+'" data-action="profile" data-user="'+$e((b=a&&a.post,b=null==b||b===!1?b:b.author,b=null==b||b===!1?b:b.id,typeof b===af?b.apply(a):b))+'">\n'}function Q(a,b){var d="";return d+='\n<div>\n<ul class="my-disqus-nav">\n<li class="user-vote-count" data-role="notifications-tab">\n<a href="#" title="notifications" data-action="notifications">\n<span class="count"><span data-role="notification-count"></span> '+$e(c.gettext.call(a,"new",{hash:{},data:b}))+'</span>\n<span class="label">'+$e(c.gettext.call(a,"Notifications",{hash:{},data:b}))+'</span>\n</a>\n</li>\n<li class="user-comment-count active" data-role="network-tab">\n<a href="#" title="network" data-action="network">\n<span class="count">'+$e(c.gettext.call(a,"Now",{hash:{},data:b}))+'</span>\n<span class="label">'+$e(c.gettext.call(a,"in your network",{hash:{},data:b}))+'</span>\n</a>\n</li>\n</ul>\n\n\n<div data-role="network"></div>\n\n\n<div data-role="notifications"></div>\n</div>\n'}function R(a,b){var d="";return d+='\n<div class="textarea-wrapper" data-role="textarea">\n<div class="post-actions">\n<div class="logged-in">\n<section>\n<div class="temp-post">\n\n<a class="cancel" href="#" data-action="edit" tabindex="-1">\n'+$e(c.gettext.call(a,"Cancel",{hash:{},data:b}))+'\n</a>\n<button class="btn" type="submit">'+$e(c.gettext.call(a,"Save Edit",{hash:{},data:b}))+"</button>\n</div>\n</section>\n</div>\n</div>\n</div>\n"}function S(a,b){var d,e="";return e+="\n",d=c["if"].call(a,(d=a&&a.user,null==d||d===!1?d:d.isSession),{hash:{},inverse:_e.program(74,X,b),fn:_e.program(68,T,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function T(a,b){var d,e="";return e+="\n",d=c["if"].call(a,(d=a&&a.user,null==d||d===!1?d:d.isEditable),{hash:{},inverse:_e.noop,fn:_e.program(69,U,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function U(a,b){var d,e="";return e+='\n<a href="'+$e(c.urlfor.call(a,"editProfile",{hash:{},data:b}))+'"\ntarget="_blank"\nclass="\n',d=c["if"].call(a,a&&a.buttonAsLink,{hash:{},inverse:_e.program(72,W,b),fn:_e.program(70,V,b),data:b}),(d||0===d)&&(e+=d),e+='">\n'+$e(c.gettext.call(a,"Edit profile",{hash:{},data:b}))+"\n</a>\n"}function V(){return"\npublisher-anchor-color follow-link\n"}function W(){return"\nbtn btn-small\n"}function X(a,b){var d,e="";return e+="\n",d=c["if"].call(a,(d=a&&a.user,null==d||d===!1?d:d.isPrivate),{hash:{},inverse:_e.program(77,Z,b),fn:_e.program(75,Y,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function Y(a,b){var d="";return d+='\n<span\nclass="btn btn-small follow-btn private">\n<i aria-hidden="true" class="icon-lock"></i>\n<span class="btn-text">\n'+$e(c.gettext.call(a,"Private",{hash:{},data:b}))+"\n</span>\n</span>\n"}function Z(a,b){var d,e="";return e+='\n<a href="#" class="\n',d=c["if"].call(a,a&&a.buttonAsLink,{hash:{},inverse:_e.program(78,$,b),fn:_e.program(70,V,b),data:b}),(d||0===d)&&(e+=d),e+="\n",d=c["if"].call(a,(d=a&&a.user,null==d||d===!1?d:d.isFollowing),{hash:{},inverse:_e.noop,fn:_e.program(10,m,b),data:b}),(d||0===d)&&(e+=d),e+='"\ndata-action="toggleFollow"\ndata-user="'+$e((d=a&&a.user,d=null==d||d===!1?d:d.id,typeof d===af?d.apply(a):d))+'">\n<span class="btn-text following-text">'+$e(c.gettext.call(a,"Following",{hash:{},data:b}))+'</span>\n<span class="btn-text follow-text">'+$e(c.gettext.call(a,"Follow",{hash:{},data:b}))+'</span>\n<i aria-hidden="true" class="icon-checkmark"></i>\n</a>\n'}function $(){return"\nbtn btn-small follow-btn\n"}function _(a){var b,c="";return c+='\n<span data-user="'+$e((b=a&&a.id,typeof b===af?b.apply(a):b))+'" data-role="username">'+$e((b=a&&a.name,typeof b===af?b.apply(a):b))+"</span>\n"}function ab(a,b){var d,e="";return e+='\n<div class="alert error" style="display:none" role="alert">\n<a class="close" data-action="dismiss-alert" title="'+$e(c.gettext.call(a,"Dismiss",{hash:{},data:b}))+'">×</a>\n<span></span>\n</div>\n\n<div class="postbox">\n<div class="avatar">\n',d=c["if"].call(a,(d=a&&a.user,null==d||d===!1?d:d.isRegistered),{hash:{},inverse:_e.program(85,cb,b),fn:_e.program(83,bb,b),data:b}),(d||0===d)&&(e+=d),e+='\n</div>\n\n<div class="textarea-wrapper" data-role="textarea" dir="auto">\n<div data-role="drag-drop-placeholder" class="media-drag-hover" style="display: none">\n<div class="drag-text">\n&#11015; '+$e(c.gettext.call(a,"Drag and drop your images here to upload them.",{hash:{},data:b}))+"\n</div>\n</div>\n",d=c["if"].call(a,a&&a.allowMedia,{hash:{},inverse:_e.noop,fn:_e.program(87,db,b),data:b}),(d||0===d)&&(e+=d),e+='\n<div class="edit-alert" role="postbox-alert"></div>\n<div class="post-actions">\n<ul class="wysiwyg">\n',d=c["if"].call(a,a&&a.allowMedia,{hash:{},inverse:_e.noop,fn:_e.program(89,eb,b),data:b}),(d||0===d)&&(e+=d),e+="\n\n</ul>\n\n",d=c["if"].call(a,(d=a&&a.user,null==d||d===!1?d:d.isRegistered),{hash:{},inverse:_e.noop,fn:_e.program(95,ib,b),data:b}),(d||0===d)&&(e+=d),e+='\n</div>\n</div>\n\n\n<div data-role="login-form"></div>\n\n</div>\n'
}function bb(a){var b,c="";return c+='\n<a href="'+$e((b=a&&a.user,b=null==b||b===!1?b:b.profileUrl,typeof b===af?b.apply(a):b))+'" class="user" data-action="profile" data-user="'+$e((b=a&&a.user,b=null==b||b===!1?b:b.id,typeof b===af?b.apply(a):b))+'">\n<img data-role="user-avatar" data-user="'+$e((b=a&&a.user,b=null==b||b===!1?b:b.id,typeof b===af?b.apply(a):b))+'" src="'+$e((b=a&&a.user,b=null==b||b===!1?b:b.avatar,b=null==b||b===!1?b:b.cache,typeof b===af?b.apply(a):b))+'"/>\n</a>\n'}function cb(a){var b,c="";return c+='\n<span class="user">\n<img data-role="user-avatar" src="'+$e((b=a&&a.user,b=null==b||b===!1?b:b.avatar,b=null==b||b===!1?b:b.cache,typeof b===af?b.apply(a):b))+'"/>\n</span>\n'}function db(){var a="";return a+='\n<div class="media-preview empty" data-role="media-preview">\n<ul data-role="media-legacy-list"></ul>\n<ul data-role="media-rich-list"></ul>\n<div class="media-expanded empty" data-role="media-preview-expanded">\n\n<img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="\ndata-role="media-preview-expanded-image">\n</div>\n</div>\n'}function eb(a,b){var d,e="";return e+='\n<li>\n<a href="#" tabindex="-1" data-action="attach" class="attach" title="'+$e(c.gettext.call(a,"Upload Images",{hash:{},data:b}))+'"><span>'+$e(c.gettext.call(a,"Attach",{hash:{},data:b}))+'</span></a>\n<input type="file" data-role="media-upload"\ntabindex="-1"\n',d=c["with"].call(a,"_window_",{hash:{},inverse:_e.noop,fn:_e.program(90,fb,b),data:b}),(d||0===d)&&(e+=d),e+="\n>\n</li>\n"}function fb(a,b){var d,e="";return e+="\n",d=c["if"].call(a,c["typeof"].call(a,a&&a.FormData,"undefined",{hash:{},data:b}),{hash:{},inverse:_e.program(93,hb,b),fn:_e.program(91,gb,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function gb(){var a="";return a+='\n\nclass="ie"\nname="attachment"\n'}function hb(){return'\nclass="regular"\naccept="image/*"\n'}function ib(a,b){var d,e="";return e+="\n",d=c.unless.call(a,a&&a.audienceSyncRequired,{hash:{},inverse:_e.noop,fn:_e.program(96,jb,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function jb(a,b){var d="";return d+='\n<div class="logged-in">\n<section>\n<div class="temp-post" style="text-align: right">\n<button class="btn">\n'+$e(c.gettext.call(a,"Post as %(name)s",{hash:{name:c.getPartial.call(a,"formUser",a&&a.user,{hash:{},data:b})},data:b}))+"\n</button>\n</div>\n</section>\n</div>\n"}function kb(a,b){var d,e="";return e+="\n",d=c["if"].call(a,(d=a&&a.user,null==d||d===!1?d:d.isAnonymous),{hash:{},inverse:_e.noop,fn:_e.program(99,lb,b),data:b}),(d||0===d)&&(e+=d),e+="\n\n\n",d=c["if"].call(a,a&&a.audienceSyncRequired,{hash:{},inverse:_e.noop,fn:_e.program(101,mb,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function lb(a,b){var e,f="";return f+='\n<section class="auth-section logged-out">\n<div class="connect">\n<h6>'+$e(c.gettext.call(a,"Sign in with",{hash:{},data:b}))+"</h6>\n",e=_e.invokePartial(d.loginButtons,"loginButtons",a,c,d,b),(e||0===e)&&(f+=e),f+="\n</div>\n",e=_e.invokePartial(d.guestForm,"guestForm",a,c,d,b),(e||0===e)&&(f+=e),f+="\n</section>\n"}function mb(a,b){var e,f="";return f+='\n<section class="auth-section">\n',e=_e.invokePartial(d.audienceSync,"audienceSync",a,c,d,b),(e||0===e)&&(f+=e),f+="\n</section>\n"}function nb(a,b){var d,e="";return e+='\n<ul data-role="login-menu" class="services login-buttons">\n\n',d=c["if"].call(a,(d=a&&a.sso,null==d||d===!1?d:d.url),{hash:{},inverse:_e.noop,fn:_e.program(104,ob,b),data:b}),(d||0===d)&&(e+=d),e+='\n\n<li class="auth-disqus">\n<button type="button" data-action="auth:disqus" title="Disqus"><i class="icon-disqus"></i></button>\n</li>\n<li class="auth-facebook">\n<button type="button" data-action="auth:facebook" title="Facebook"><i class="icon-facebook-circle"></i></button>\n</li>\n<li class="auth-twitter">\n<button type="button" data-action="auth:twitter" title="Twitter"><i class="icon-twitter-circle"></i></button>\n</li>\n<li class="auth-google">\n<button type="button" data-action="auth:google" title="Google"><i class="icon-google-plus-circle"></i></button>\n</li>\n<li class="auth-signup">\n<button type="button" data-action="auth:disqus" title="Disqus">Sign up for Disqus</button>\n</li>\n</ul>\n'}function ob(a,b){var d,e="";return e+='\n<li class="sso">\n<button type="button" data-action="auth:sso"\ntitle="'+$e((d=a&&a.sso,d=null==d||d===!1?d:d.name,typeof d===af?d.apply(a):d))+'"\nclass="',d=c["if"].call(a,(d=a&&a.sso,null==d||d===!1?d:d.button),{hash:{},inverse:_e.program(107,qb,b),fn:_e.program(105,pb,b),data:b}),(d||0===d)&&(e+=d),e+='">\n',d=c["if"].call(a,(d=a&&a.sso,null==d||d===!1?d:d.button),{hash:{},inverse:_e.program(111,sb,b),fn:_e.program(109,rb,b),data:b}),(d||0===d)&&(e+=d),e+="\n</button>\n</li>\n"}function pb(){return"image"}function qb(){return"no-image"}function rb(a){var b,c="";return c+='\n<img alt="'+$e((b=a&&a.sso,b=null==b||b===!1?b:b.name,typeof b===af?b.apply(a):b))+'" src="'+$e((b=a&&a.sso,b=null==b||b===!1?b:b.button,typeof b===af?b.apply(a):b))+'"/>\n'}function sb(a){var b,c="";return c+="\n"+$e((b=a&&a.sso,b=null==b||b===!1?b:b.name,typeof b===af?b.apply(a):b))+"\n"}function tb(a,b){var d,e="";return e+='\n<div class="guest">\n<h6 class="guest-form-title">\n',d=c["if"].call(a,a&&a.allowAnonPost,{hash:{},inverse:_e.program(116,vb,b),fn:_e.program(114,ub,b),data:b}),(d||0===d)&&(e+=d),e+='\n</h6>\n\n<div class="what-is-disqus help-icon">\n<div id="rules" class="tooltip show">\n<h3>'+$e(c.gettext.call(a,"Disqus is a conversation network",{hash:{},data:b}))+"</h3>\n<ul>\n<li><span>"+$e(c.gettext.call(a,"Disqus never moderates or censors. The rules on this community are its own.",{hash:{},data:b}))+"</span></li>\n<li><span>"+$e(c.gettext.call(a,"Your email is safe with us. It's only used for moderation and optional notifications.",{hash:{},data:b}))+"</span></li>\n<li><span>"+$e(c.gettext.call(a,"Don't be a jerk or do anything illegal. Everything is easier that way.",{hash:{},data:b}))+'</span></li>\n</ul>\n<p class="clearfix"><a href="http://docs.disqus.com/kb/terms-and-policies/" class="btn btn-small" target="_blank">'+$e(c.gettext.call(a,"Read full terms and conditions",{hash:{},data:b}))+'</a></p>\n</div>\n</div>\n\n<p class="input-wrapper">\n<input dir="auto" type="text" placeholder="'+$e(c.gettext.call(a,"Name",{hash:{},data:b}))+'" name="display_name" maxlength="30" />\n</p>\n\n<div class="guest-details ',d=c["if"].call(a,(d=a&&a.sso,null==d||d===!1?d:d.url),{hash:{},inverse:_e.noop,fn:_e.program(118,wb,b),data:b}),(d||0===d)&&(e+=d),e+='" data-role="guest-details">\n<p class="input-wrapper">\n<input dir="auto" type="email" placeholder="'+$e(c.gettext.call(a,"Email",{hash:{},data:b}))+'" name="email"/>\n</p>\n\n<p class="input-wrapper">\n<input dir="auto" type="password" placeholder="'+$e(c.gettext.call(a,"Password",{hash:{},data:b}))+'" name="password"/>\n</p>\n',d=c["if"].call(a,a&&a.allowAnonPost,{hash:{},inverse:_e.program(122,yb,b),fn:_e.program(120,xb,b),data:b}),(d||0===d)&&(e+=d),e+='\n\n</div>\n</div>\n<div class="proceed">\n',d=c["if"].call(a,a&&a.allowAnonPost,{hash:{},inverse:_e.program(126,Ab,b),fn:_e.program(124,zb,b),data:b}),(d||0===d)&&(e+=d),e+="\n</div>\n"}function ub(a,b){var d="";return d+="\n"+$e(c.gettext.call(a,"or pick a name",{hash:{},data:b}))+"\n"}function vb(a,b){var d="";return d+="\n"+$e(c.gettext.call(a,"or register with Disqus",{hash:{},data:b}))+"\n"}function wb(){return"expanded"}function xb(a,b){var d="";return d+='\n<div class="guest-checkbox">\n<label>\n<input type="checkbox" name="author-guest"/>\n'+$e(c.gettext.call(a,"I'd rather post as guest",{hash:{},data:b}))+"\n</label>\n</div>\n"}function yb(){return'\n<input type="checkbox" name="author-guest" style="display:none"/>\n'}function zb(a,b){var d="";return d+='\n<button type="submit" class="btn submit" aria-label="'+$e(c.gettext.call(a,"Post",{hash:{},data:b}))+'"><span class="icon-proceed"></span></button>\n<button type="submit" class="btn next" aria-label="'+$e(c.gettext.call(a,"Next",{hash:{},data:b}))+'"><span class="icon-proceed"></span></button>\n'}function Ab(a,b){var d="";return d+='\n<button type="submit" class="btn submit" aria-label="'+$e(c.gettext.call(a,"Next",{hash:{},data:b}))+'"><span class="icon-proceed"></span></button>\n'}function Bb(a,b){var d,e="";return e+='\n<div class="audiencesync">\n<h6>'+$e(c.gettext.call(a,"Connect with %(forumName)s",{hash:{forumName:a&&a.forumName},data:b}))+'</h6>\n<div class="services">\n<div class="icons-container">\n<img class="icon" alt="Disqus"\nsrc="'+$e("//a.disquscdn.com/next/assets/img/sync-icon.a97d408756a74d139b9d78160ddda973.png")+'">\n<img class="icon" alt="arrow to"\nsrc="'+$e("//a.disquscdn.com/next/assets/img/sync-arrow.f870280459c2d762e3b56d6a8b81aff6.png")+'">\n<img class="icon" alt="'+$e((d=a&&a.forumName,typeof d===af?d.apply(a):d))+'"\nsrc="'+$e(c.urlfor.call(a,"root",{hash:{},data:b}))+"/api/applications/icons/"+$e((d=a&&a.apiKey,typeof d===af?d.apply(a):d))+'.png">\n</div>\n<p>\n'+$e(c.gettext.call(a,"%(forumName)s needs permission to access your account.",{hash:{forumName:a&&a.forumName},data:b}))+'\n</p>\n</div>\n<button type="button" data-action="audiencesync"\nclass="proceed btn submit">'+$e(c.gettext.call(a,"Next",{hash:{},data:b}))+"</button>\n</div>\n"}function Cb(a,b){var d,e="";return e+='\n<li class="publisher-border-color">\n<div class="media-box">\n<div class="media-ct">\n<div class="media-surface">\n<a href="'+$e(c.any.call(a,(d=a&&a.media,null==d||d===!1?d:d.url),a&&a.backupUrl,{hash:{},data:b}))+'" target="_blank">\n<img src="'+$e((d=a&&a.media,d=null==d||d===!1?d:d.thumbnailUrl,typeof d===af?d.apply(a):d))+'" alt="',d=c["if"].call(a,(d=a&&a.media,null==d||d===!1?d:d.title),{hash:{},inverse:_e.program(133,Eb,b),fn:_e.program(131,Db,b),data:b}),(d||0===d)&&(e+=d),e+='">\n</a>\n</div>\n</div>\n</div>\n</li>\n'}function Db(a){var b;return $e((b=a&&a.media,b=null==b||b===!1?b:b.title,typeof b===af?b.apply(a):b))}function Eb(a,b){return $e(c.gettext.call(a,"Media attachment",{hash:{},data:b}))}function Fb(a,b){var d,e="";return e+='\n<li class="publisher-border-color" data-media-id="'+$e((d=a&&a.location,typeof d===af?d.apply(a):d))+'">\n<div class="media-box">\n<div class="media-ct">\n<div class="media-surface">\n<img src="'+$e((d=a&&a.location,typeof d===af?d.apply(a):d))+'?w=128&h=128" alt="'+$e(c.gettext.call(a,"Media attachment",{hash:{},data:b}))+'">\n<a href="#" class="media-delete" data-action="detach">&#10005;</a>\n</div>\n</div>\n</div>\n</li>\n'}function Gb(a,b){var d="";return d+='\n\n<h2 class="highlighted-comment-header">'+$e(c.gettext.call(a,"Featured Comment",{hash:{},data:b}))+'</h2>\n\n<ul class="post-list"></ul>\n'}function Hb(a,b){var d="";return d+='\n<div class="home-notifications-nav">\n<div class="right">\n<a href="//disqus.com/home/notifications" target="_blank" title="'+$e(c.gettext.call(a,"Notifications Settings",{hash:{},data:b}))+'">\n<span class="text-desktop">'+$e(c.gettext.call(a,"Notifications Settings",{hash:{},data:b}))+'</span>\n<span class="text-mobile">'+$e(c.gettext.call(a,"Settings",{hash:{},data:b}))+'</span>\n</a>\n<a href="//disqus.com/home" target="_blank" title="'+$e(c.gettext.call(a,"Disqus Home",{hash:{},data:b}))+'">\n<span class="text-desktop">'+$e(c.gettext.call(a,"Disqus Home",{hash:{},data:b}))+'</span>\n<span class="text-mobile">'+$e(c.gettext.call(a,"Home",{hash:{},data:b}))+'</span>\n</a>\n</div>\n<div class="left">\n'+$e(c.gettext.call(a,"Your Notifications",{hash:{},data:b}))+'\n</div>\n</div>\n\n<div data-role="home-notifications"></div>\n'}function Ib(a,b){var e,f="";return f+='\n<div class="tooltip">\n<div class="notch"></div>\n<a href="'+$e((e=a&&a.user,e=null==e||e===!1?e:e.profileUrl,typeof e===af?e.apply(a):e))+'" class="avatar" data-action="profile" data-user="'+$e((e=a&&a.user,e=null==e||e===!1?e:e.id,typeof e===af?e.apply(a):e))+'">\n<img data-user="'+$e((e=a&&a.user,e=null==e||e===!1?e:e.id,typeof e===af?e.apply(a):e))+'" data-role="user-avatar" src="'+$e((e=a&&a.user,e=null==e||e===!1?e:e.avatar,e=null==e||e===!1?e:e.cache,typeof e===af?e.apply(a):e))+'" class="user" alt="'+$e(c.gettext.call(a,"Avatar",{hash:{},data:b}))+'" />\n</a>\n<div class="content">\n<h3>\n<a href="'+$e((e=a&&a.user,e=null==e||e===!1?e:e.profileUrl,typeof e===af?e.apply(a):e))+'" data-action="profile" data-role="username" data-user="'+$e((e=a&&a.user,e=null==e||e===!1?e:e.id,typeof e===af?e.apply(a):e))+'">'+$e((e=a&&a.user,e=null==e||e===!1?e:e.name,typeof e===af?e.apply(a):e))+"</a>\n",e=c["if"].call(a,(e=a&&a.user,e=null==e||e===!1?e:e.thread,null==e||e===!1?e:e.canModerate),{hash:{},inverse:_e.noop,fn:_e.program(142,Jb,b),data:b}),(e||0===e)&&(f+=e),f+="\n</h3>\n\n",e=c["if"].call(a,(e=a&&a.user,null==e||e===!1?e:e.about),{hash:{},inverse:_e.noop,fn:_e.program(144,Kb,b),data:b}),(e||0===e)&&(f+=e),f+='\n\n\n<p class="stats" data-role="counters">\n',e=c.if_all.call(a,c.notNull.call(a,(e=a&&a.user,null==e||e===!1?e:e.numPosts),{hash:{},data:b}),c.notNull.call(a,(e=a&&a.user,null==e||e===!1?e:e.numLikesReceived),{hash:{},data:b}),{hash:{},inverse:_e.noop,fn:_e.program(146,Lb,b),data:b}),(e||0===e)&&(f+=e),f+='\n</p>\n</div>\n<footer data-role="actions">\n',e=_e.invokePartial(d.hovercardActions,"hovercardActions",a,c,d,b),(e||0===e)&&(f+=e),f+="\n</footer>\n</div>\n"}function Jb(a,b){var d="";return d+='<span class="badge moderator">'+$e(c.gettext.call(a,"MOD",{hash:{},data:b}))+"</span>"}function Kb(a,b){var d,e="";return e+='\n<p class="bio">'+$e(c.truncate.call(a,(d=a&&a.user,null==d||d===!1?d:d.about),80,{hash:{},data:b}))+"</p>\n"}function Lb(a,b){var e,f="";return f+="\n",e=_e.invokePartial(d.hovercardCounters,"hovercardCounters",a,c,d,b),(e||0===e)&&(f+=e),f+="\n"}function Mb(a,b){var d,e="";return e+="\n",d=c["if"].call(a,c.eq.call(a,(d=a&&a.user,null==d||d===!1?d:d.numPosts),1,{hash:{},data:b}),{hash:{},inverse:_e.program(149,Nb,b),fn:_e.program(42,F,b),data:b}),(d||0===d)&&(e+=d),e+='\n<span class="bullet">•</span>\n',d=c["if"].call(a,c.eq.call(a,(d=a&&a.user,null==d||d===!1?d:d.numLikesReceived),1,{hash:{},data:b}),{hash:{},inverse:_e.program(153,Pb,b),fn:_e.program(151,Ob,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function Nb(a,b){var d,e="";return e+="\n"+$e(c.gettext.call(a,"%(numPosts)s comments",{hash:{numPosts:(d=a&&a.user,null==d||d===!1?d:d.numPosts)},data:b}))+"\n"}function Ob(a,b){var d="";return d+="\n"+$e(c.gettext.call(a,"1 vote",{hash:{},data:b}))+"\n"}function Pb(a,b){var d,e="";return e+="\n"+$e(c.gettext.call(a,"%(numLikesReceived)s votes",{hash:{numLikesReceived:(d=a&&a.user,null==d||d===!1?d:d.numLikesReceived)},data:b}))+"\n"}function Qb(a,b){var d,e="";return e+='\n<a href="'+$e((d=a&&a.user,d=null==d||d===!1?d:d.profileUrl,typeof d===af?d.apply(a):d))+'" class="full-profile" data-action="profile" data-user="'+$e((d=a&&a.user,d=null==d||d===!1?d:d.id,typeof d===af?d.apply(a):d))+'">'+$e(c.gettext.call(a,"Full profile",{hash:{},data:b}))+"</a>\n\n",d=c["if"].call(a,a&&a.showFollowButton,{hash:{},inverse:_e.noop,fn:_e.program(156,Rb,b),data:b}),(d||0===d)&&(e+=d),e+="\n\n&nbsp;\n"}function Rb(a,b){var e,f="";return f+="\n\n",e=_e.invokePartial(d.followButtonSmall,"followButtonSmall",a,c,d,b),(e||0===e)&&(f+=e),f+="\n"}function Sb(a,b){var e,f="";return f+='\n<div id="layout" data-tracking-area="layout">\n\n<div id="discovery-top" data-tracking-area="discovery-north"></div>\n\n<div id="onboard" data-tracking-area="onboard"></div>\n\n<div id="highlighted-post" data-tracking-area="highlighted" class="highlighted-post"></div>\n\n<header id="main-nav" data-tracking-area="main-nav">\n',e=_e.invokePartial(d.topNavigation,"topNavigation",a,c,d,b),(e||0===e)&&(f+=e),f+='\n</header>\n\n\n\n\n<section id="conversation" data-role="main" data-tracking-area="main">\n',e=_e.invokePartial(d.secondaryNavigation,"secondaryNavigation",a,c,d,b),(e||0===e)&&(f+=e),f+='\n\n<div id="posts">\n\n<div id="form"></div>\n\n<button class="alert realtime" style="display: none" data-role="realtime-notification">\n\n</button>\n\n\n<div id="no-posts" style="display:none">'+$e(c.gettext.call(a,"Be the first to comment.",{hash:{},data:b}))+'</div>\n\n<ul id="post-list" class="post-list loading">\n</ul>\n\n<div class="load-more" data-role="more" style="display:none">\n<a href="#" data-action="more-posts" class="btn">'+$e(c.gettext.call(a,"Load more comments",{hash:{},data:b}))+'</a>\n</div>\n</div>\n\n</section>\n\n<section id="community" data-tracking-area="main" style="display:none" data-role="main" data-outbound-link="embed:community">\n\n</section>\n\n<section id="dashboard" style="display:none" data-role="main" data-tracking-area="main">\n\n\n<p style="line-height: 1.4">'+$e(c.gettext.call(a,"Nothing for you here ... yet. But as you comment with Disqus and follow\nother Disqus users, you will start to receive notifications here, as well as a personalized\nfeed of activity by you and the people you follow. So get out there and participate in\nsome discussions!",{hash:{},data:b}))+'</p>\n</section>\n\n<section id="profile" style="display:none" data-role="main" data-tracking-area="main">\n</section>\n\n<div id="discovery" data-tracking-area="discovery-south"></div>\n\n<div id="footer" data-tracking-area="footer">\n<ul>\n<li class="logo"><a href="http://disqus.com" title="'+$e(c.gettext.call(a,"Powered by Disqus",{hash:{},data:b}))+'">'+$e(c.gettext.call(a,"Powered by Disqus",{hash:{},data:b}))+'</a></li>\n<li id="thread-subscribe-button" class="email"> \n<div class="default">\n<a href="#" data-action="subscribe" title="'+$e(c.gettext.call(a,"Subscribe and get email updates from this discussion",{hash:{},data:b}))+'"><i aria-hidden="true" class="icon-mail"></i><span class="clip">'+$e(c.gettext.call(a,"Subscribe",{hash:{},data:b}))+'</span> <i aria-hidden="true" class="icon-checkmark"></i></a>\n</div>\n<div class="form">\n<div class="input-wrapper"><input id="thread-subscribe-email" type="email" placeholder="'+$e(c.gettext.call(a,"yourname@email.com",{hash:{},data:b}))+'"/></div>\n</div>\n</li>\n<li class="install">\n<a href="https://disqus.com/websites/?utm_source='+$e((e=a&&a.forum,e=null==e||e===!1?e:e.id,typeof e===af?e.apply(a):e))+'&utm_medium=Disqus-Footer" target="_blank">\n<i aria-hidden="true" class="icon-disqus"></i>\n<span class="clip">'+$e(c.gettext.call(a,"Add Disqus to your site",{hash:{},data:b}))+"</span>\n</a>\n</li>\n</ul>\n</div>\n</div>\n"}function Tb(a,b){var d,e="";return e+='\n<li data-role="post-sort" class="dropdown sorting">\n<a href="#" class="dropdown-toggle" data-nav="conversation" data-toggle="dropdown">\n',d=c["if"].call(a,c.eq.call(a,a&&a.order,"popular",{hash:{},data:b}),{hash:{},inverse:_e.noop,fn:_e.program(161,Ub,b),data:b}),(d||0===d)&&(e+=d),e+="\n",d=c["if"].call(a,c.eq.call(a,a&&a.order,"desc",{hash:{},data:b}),{hash:{},inverse:_e.noop,fn:_e.program(163,Vb,b),data:b}),(d||0===d)&&(e+=d),e+="\n",d=c["if"].call(a,c.eq.call(a,a&&a.order,"asc",{hash:{},data:b}),{hash:{},inverse:_e.noop,fn:_e.program(165,Wb,b),data:b}),(d||0===d)&&(e+=d),e+='\n<span class="caret"></span>\n</a>\n<ul class="dropdown-menu">\n<li ',d=c["if"].call(a,c.eq.call(a,a&&a.order,"popular",{hash:{},data:b}),{hash:{},inverse:_e.noop,fn:_e.program(167,Xb,b),data:b}),(d||0===d)&&(e+=d),e+='>\n<a href="#" data-action="sort" data-sort="popular">'+$e(c.gettext.call(a,"Best",{hash:{},data:b}))+"</a>\n</li>\n\n<li ",d=c["if"].call(a,c.eq.call(a,a&&a.order,"desc",{hash:{},data:b}),{hash:{},inverse:_e.noop,fn:_e.program(167,Xb,b),data:b}),(d||0===d)&&(e+=d),e+='>\n<a href="#" data-action="sort" data-sort="desc">'+$e(c.gettext.call(a,"Newest",{hash:{},data:b}))+"</a>\n</li>\n\n<li ",d=c["if"].call(a,c.eq.call(a,a&&a.order,"asc",{hash:{},data:b}),{hash:{},inverse:_e.noop,fn:_e.program(167,Xb,b),data:b}),(d||0===d)&&(e+=d),e+='>\n<a href="#" data-action="sort" data-sort="asc">'+$e(c.gettext.call(a,"Oldest",{hash:{},data:b}))+"</a>\n</li>\n</ul>\n</li>\n"}function Ub(a,b){return $e(c.gettext.call(a,"Sort by Best",{hash:{},data:b}))}function Vb(a,b){return $e(c.gettext.call(a,"Sort by Newest",{hash:{},data:b}))}function Wb(a,b){return $e(c.gettext.call(a,"Sort by Oldest",{hash:{},data:b}))}function Xb(){return'class="selected"'}function Yb(a,b){var d,e="";return e+='\n\n<span class="comment-count">\n',d=c["if"].call(a,c.eq.call(a,a&&a.count,1,{hash:{},data:b}),{hash:{},inverse:_e.program(170,Zb,b),fn:_e.program(42,F,b),data:b}),(d||0===d)&&(e+=d),e+='\n</span>\n\n\n<span class="comment-count-placeholder">\n'+$e(c.gettext.call(a,"Comments",{hash:{},data:b}))+"\n</span>\n"}function Zb(a,b){var d="";return d+="\n"+$e(c.gettext.call(a,"%(numPosts)s comments",{hash:{numPosts:a&&a.count},data:b}))+"\n"}function $b(a,b){var d,e="";return e+='\n<nav class="nav nav-primary">\n<ul>\n<li class="tab-conversation active">\n\n<a href="#" data-role="post-count" class="publisher-nav-color" data-nav="conversation">\n',d=c["with"].call(a,"count",(d=a&&a.thread,null==d||d===!1?d:d.posts),{hash:{},inverse:_e.noop,fn:_e.program(173,_b,b),data:b}),(d||0===d)&&(e+=d),e+='\n</a>\n</li>\n<li class="tab-community">\n<a href="#" class="publisher-nav-color" data-nav="community" id="community-tab">\n\n\n<span class="community-name">\n',d=c["with"].call(a,a&&a.forum,{hash:{},inverse:_e.noop,fn:_e.program(175,ac,b),data:b}),(d||0===d)&&(e+=d),e+='\n</span>\n\n\n<strong class="community-name-placeholder">'+$e(c.gettext.call(a,"Community",{hash:{},data:b}))+'</strong>\n</a>\n</li>\n<li class="dropdown user-menu" data-role="logout">\n<!-- rendered dynamically -->\n</li>\n<li class="notification-menu" data-role="notification-menu">\n<!-- rendered dynamically -->\n</li>\n</ul>\n</nav>\n'}function _b(a,b){var e,f="";return f+="\n",e=_e.invokePartial(d.postCount,"postCount",a,c,d,b),(e||0===e)&&(f+=e),f+="\n"}function ac(a,b){var e;return e=_e.invokePartial(d.communityForum,"communityForum",a,c,d,b),e||0===e?e:""}function bc(a,b){var d="";return d+='\n<a href="#" data-action="upvote" title="'+$e(c.gettext.call(a,"Favorite this discussion",{hash:{},data:b}))+'">\n<span class="label">'+$e(c.gettext.call(a,"Favorite",{hash:{},data:b}))+'</span>\n<span class="icon-star"></span>\n<span class="icon-check"></span>\n</a>\n'}function cc(a,b){var e,f="";return f+='\n<div class="nav nav-secondary" data-tracking-area="secondary-nav">\n<ul>\n',e=_e.invokePartial(d.postSort,"postSort",a,c,d,b),(e||0===e)&&(f+=e),f+='\n\n<li id="thread-votes" class="favorite pull-right">\n<!-- rendered dynamically -->\n</li>\n\n<li id="thread-share-menu" class="dropdown share-menu">\n<a href="#" class="dropdown-toggle" data-toggle="dropdown" title="'+$e(c.gettext.call(a,"Share",{hash:{},data:b}))+'">\n<span class="label">'+$e(c.gettext.call(a,"Share",{hash:{},data:b}))+'</span> <span class="icon-export"></span>\n</a>\n<ul class="share-menu dropdown-menu pull-right">\n<li class="share">'+$e(c.gettext.call(a,"Share this discussion on",{hash:{},data:b}))+'\n<ul>\n<li class="twitter">\n<a data-action="share:twitter"\nhref="#">Twitter</a>\n</li>\n<li class="facebook">\n<a data-action="share:facebook" href="#">Facebook</a>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</div>\n'}function dc(a,b){var d="";return d+='\n<div>\n<ul class="network-activity" data-role="entries"></ul>\n\n<div data-role="no-activity" style="display:none">\n'+$e(c.gettext.call(a,"You have no activity.",{hash:{},data:b}))+'\n</div>\n\n<div class="load-more" data-role="more-activity" style="display:none">\n<a href="#" data-action="more" class="btn">'+$e(c.gettext.call(a,"Load more activity",{hash:{},data:b}))+"</a>\n</div>\n</div>\n"}function ec(a,b){var d,e="";return e+='\n<li class="network-activity-group">\n<h5>'+$e(c.gettext.call(a,"Discussion on %(forum)s",{hash:{forum:c.getPartial.call(a,"networkForumLink",a&&a.thread,{hash:{},data:b})},data:b}))+'</h5>\n\n\n\n<h4><a class="outbound-link" target="_blank" href="'+$e((d=a&&a.thread,d=null==d||d===!1?d:d.link,typeof d===af?d.apply(a):d))+'">'+$e(c.html.call(a,(d=a&&a.thread,null==d||d===!1?d:d.title),{hash:{},data:b}))+'<i aria-hidden="true" class="icon-expand"></i></a></h4>\n\n<ul data-role="posts" class="post-list"/>\n</li>\n'}function fc(a,b){var d,e="";return e+='\n<li class="post">\n<div class="post-content ',d=c["if"].call(a,(d=a&&a.post,null==d||d===!1?d:d.parent),{hash:{},inverse:_e.noop,fn:_e.program(186,gc,b),data:b}),(d||0===d)&&(e+=d),e+='">\n<div class="avatar">\n<img src="'+$e((d=a&&a.post,d=null==d||d===!1?d:d.author,d=null==d||d===!1?d:d.avatar,d=null==d||d===!1?d:d.cache,typeof d===af?d.apply(a):d))+'" class="source-avatar"/>\n',d=c["if"].call(a,(d=a&&a.post,null==d||d===!1?d:d.parent),{hash:{},inverse:_e.noop,fn:_e.program(188,hc,b),data:b}),(d||0===d)&&(e+=d),e+='\n</div>\n<div class="post-body">\n<header>\n',d=c["if"].call(a,(d=a&&a.post,null==d||d===!1?d:d.parent),{hash:{},inverse:_e.program(192,jc,b),fn:_e.program(190,ic,b),data:b}),(d||0===d)&&(e+=d),e+='\n\n<span class="bullet" aria-hidden="true">•</span>\n<a href="'+$e((d=a&&a.post,d=null==d||d===!1?d:d.url,typeof d===af?d.apply(a):d))+'" class="time-ago" title="'+$e((d=a&&a.post,d=null==d||d===!1?d:d.formattedCreatedAt,typeof d===af?d.apply(a):d))+'">'+$e((d=a&&a.post,d=null==d||d===!1?d:d.relativeCreatedAt,typeof d===af?d.apply(a):d))+'</a>\n</header>\n<div class="post-message publisher-anchor-color">\n'+$e(c.html.call(a,(d=a&&a.post,null==d||d===!1?d:d.message),{hash:{},data:b}))+"\n</div>\n</div>\n</div>\n</li>\n"}function gc(){return"post-reply"}function hc(a){var b,c="";return c+='\n<img src="'+$e((b=a&&a.post,b=null==b||b===!1?b:b.parent,b=null==b||b===!1?b:b.author,b=null==b||b===!1?b:b.avatar,b=null==b||b===!1?b:b.cache,typeof b===af?b.apply(a):b))+'" class="target-avatar"/>\n'}function ic(a,b){var d,e="";return e+="\n"+$e(c.gettext.call(a,"%(user)s replied to %(author)s",{hash:{user:c.getPartial.call(a,"profileLink",(d=a&&a.post,null==d||d===!1?d:d.author),{hash:{},data:b}),author:c.getPartial.call(a,"profileLink",(d=a&&a.post,d=null==d||d===!1?d:d.parent,null==d||d===!1?d:d.author),{hash:{},data:b})},data:b}))+"\n"}function jc(a,b){var d,e="";return e+="\n\n",d=c["with"].call(a,(d=a&&a.post,null==d||d===!1?d:d.author),{hash:{},inverse:_e.noop,fn:_e.program(193,kc,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function kc(a,b){var e,f="";return f+="\n",e=_e.invokePartial(d.profileLink,"profileLink",a,c,d,b),(e||0===e)&&(f+=e),f+="\n"}function lc(a){var b,c="";return c+='\n<strong><a class="outbound-link" target="_blank" href="'+$e((b=a&&a.forum,b=null==b||b===!1?b:b.url,typeof b===af?b.apply(a):b))+'">'+$e((b=a&&a.forum,b=null==b||b===!1?b:b.name,typeof b===af?b.apply(a):b))+'<i aria-hidden="true" class="icon-expand"></i></a></strong>\n'}function mc(a,b){var d,e="";return e+='\n<span class="publisher-anchor-color">\n',d=c["if"].call(a,a&&a.isRegistered,{hash:{},inverse:_e.program(200,oc,b),fn:_e.program(198,nc,b),data:b}),(d||0===d)&&(e+=d),e+="\n</span>\n"}function nc(a){var b,c="";return c+='\n<a href="'+$e((b=a&&a.profileUrl,typeof b===af?b.apply(a):b))+'" data-action="profile" data-user="'+$e((b=a&&a.id,typeof b===af?b.apply(a):b))+'">'+$e((b=a&&a.name,typeof b===af?b.apply(a):b))+"</a>\n"}function oc(a){var b,c="";return c+="\n"+$e((b=a&&a.name,typeof b===af?b.apply(a):b))+"\n"}function pc(a,b){var d,e="";return e+="\n",d=c["if"].call(a,a&&a.isRegistered,{hash:{},inverse:_e.program(205,rc,b),fn:_e.program(203,qc,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function qc(){return'\n<a href="#" class="notification-container" data-nav="dashboard">\n<span class="notification-icon icon-comment"></span>\n<span class="notification-count" data-role="notification-count"></span>\n</a>\n'}function rc(a,b){var d,e="";return e+="\n",d=c["if"].call(a,(d=a&&a.user,d=null==d||d===!1?d:d.thread,null==d||d===!1?d:d.canReply),{hash:{},inverse:_e.noop,fn:_e.program(206,sc,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function sc(){var a="";return a+='\n\n<a href="#" class="notification-container" data-action="auth:disqus">\n<span class="notification-icon icon-disqus"></span>\n'}function tc(a,b){var d="";return d+='\n<div>\n<ul class="notifications" data-role="entries"></ul>\n\n<div data-role="no-notifications" style="display:none">\n'+$e(c.gettext.call(a,"You have no notifications.",{hash:{},data:b}))+'\n</div>\n\n<div class="load-more" data-role="more-notifications" style="display:none">\n<a href="#" data-action="more" class="btn">'+$e(c.gettext.call(a,"Load more notifications",{hash:{},data:b}))+"</a>\n</div>\n</div>\n"}function uc(a,b){var d,e="";return e+='\n<li class="notification ',d=c.unless.call(a,(d=a&&a.notification,null==d||d===!1?d:d.isRead),{hash:{},inverse:_e.noop,fn:_e.program(211,vc,b),data:b}),(d||0===d)&&(e+=d),e+='">\n<div class="indicator"></div>\n\n',d=c["if"].call(a,(d=a&&a.notification,null==d||d===!1?d:d.post),{hash:{},inverse:_e.program(215,xc,b),fn:_e.program(213,wc,b),data:b}),(d||0===d)&&(e+=d),e+="\n</li>\n"}function vc(){return"unseen"}function wc(a,b){var d,e="";return e+='\n\n\n<div class="avatar">\n<img src="'+$e((d=a&&a.notification,d=null==d||d===!1?d:d.post,d=null==d||d===!1?d:d.author,d=null==d||d===!1?d:d.avatar,d=null==d||d===!1?d:d.cache,typeof d===af?d.apply(a):d))+'" />\n</div>\n<p>\n'+$e(c.gettext.call(a,"%(user)s has replied to you on %(article)s",{hash:{user:c.getPartial.call(a,"profileLink",(d=a&&a.notification,d=null==d||d===!1?d:d.post,null==d||d===!1?d:d.author),{hash:{},data:b}),article:c.getPartial.call(a,"postLink",(d=a&&a.notification,null==d||d===!1?d:d.post),{hash:{},data:b})},data:b}))+'\n<p class="notification-meta">'+$e((d=a&&a.notification,d=null==d||d===!1?d:d.relativeCreatedAt,typeof d===af?d.apply(a):d))+'\n<span class="bullet" aria-hidden="true">•</span> <a href="'+$e((d=a&&a.notification,d=null==d||d===!1?d:d.post,d=null==d||d===!1?d:d.forum,d=null==d||d===!1?d:d.url,typeof d===af?d.apply(a):d))+'">'+$e((d=a&&a.notification,d=null==d||d===!1?d:d.post,d=null==d||d===!1?d:d.forum,d=null==d||d===!1?d:d.name,typeof d===af?d.apply(a):d))+"</a>\n</p>\n"}function xc(a,b){var d,e="";return e+='\n\n<div class="avatar">\n<img src="https://twimg0-a.akamaihd.net/profile_images/2305121474/zcrps8sb7b8zk6ezamf5.png"/>\n</div>\n<p class="publisher-anchor-color">'+$e(c.html.call(a,(d=a&&a.notification,d=null==d||d===!1?d:d.formatted,null==d||d===!1?d:d.text),{hash:{},data:b}))+'</p>\n<p class="notification-meta">\n'+$e((d=a&&a.notification,d=null==d||d===!1?d:d.relativeCreatedAt,typeof d===af?d.apply(a):d))+"\n</p>\n"}function yc(a,b){var d,e="";return e+="\n",d=c["if"].call(a,c["typeof"].call(a,a&&a.url,"undefined",{hash:{},data:b}),{hash:{},inverse:_e.program(220,Ac,b),fn:_e.program(218,zc,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function zc(a,b){var d,e="";return e+="\n"+$e(c.html.call(a,(d=a&&a.thread,null==d||d===!1?d:d.title),{hash:{},data:b}))+"\n"}function Ac(a,b){var d,e="";return e+='\n<a class="outbound-link publisher-anchor-color" target="_blank" href="'+$e((d=a&&a.url,typeof d===af?d.apply(a):d))+'">'+$e(c.html.call(a,(d=a&&a.thread,null==d||d===!1?d:d.title),{hash:{},data:b}))+'<i aria-hidden="true" class="icon-expand"></i></a>\n'}function Bc(a,b){var d,e="";return e+='\n<div class="notice">\n<div class="notice-wrapper">\n<span class="icon icon-disqus"></span>\n<a data-action="onboard" href="#" data-section="'+$e((d=a&&a.displayedSection,typeof d===af?d.apply(a):d))+'" class="message">'+$e(c.gettext.call(a,"Your Disqus account has been created! Learn more about using Disqus on your favorite communities.",{hash:{},data:b}))+'</a>\n<a data-action="onboard" href="#" data-section="'+$e((d=a&&a.displayedSection,typeof d===af?d.apply(a):d))+'" class="btn btn-primary">'+$e(c.gettext.call(a,"Get Started",{hash:{},data:b}))+'</a>\n</div>\n</div>\n<a class="dismiss" data-action="close" href="#" title=\''+$e(c.gettext.call(a,"Dismiss",{hash:{},data:b}))+'\'>Dismiss <span aria-label="Dismiss" class="cross">×</span></a>\n'}function Cc(a,b){var e,f="";return f+='\n<div role="alert"></div>\n',e=_e.invokePartial(d.postWrapperTop,"postWrapperTop",a,c,d,b),(e||0===e)&&(f+=e),f+="\n\n",e=_e.invokePartial(d.postUserAvatar,"postUserAvatar",a,c,d,b),(e||0===e)&&(f+=e),f+='\n<div class="post-body">\n<header>\n<span class="post-byline">\n',e=c["if"].call(a,(e=a&&a.post,e=null==e||e===!1?e:e.author,null==e||e===!1?e:e.isRegistered),{hash:{},inverse:_e.program(231,Hc,b),fn:_e.program(225,Dc,b),data:b}),(e||0===e)&&(f+=e),f+="\n\n",e=c["if"].call(a,a&&a.parentPost,{hash:{},inverse:_e.noop,fn:_e.program(233,Ic,b),data:b}),(e||0===e)&&(f+=e),f+='\n</span>\n\n<span class="post-meta">\n<span class="bullet time-ago-bullet" aria-hidden="true">•</span>\n\n',e=c["if"].call(a,(e=a&&a.post,null==e||e===!1?e:e.id),{hash:{},inverse:_e.program(237,Kc,b),fn:_e.program(235,Jc,b),data:b}),(e||0===e)&&(f+=e),f+="\n</span>\n\n",e=c["if"].call(a,a&&a.stateByline,{hash:{},inverse:_e.noop,fn:_e.program(239,Lc,b),data:b}),(e||0===e)&&(f+=e),f+='\n</header>\n\n\n<div class="post-body-inner">\n\n<div class="post-message-container" data-role="message-container">\n\n<div class="publisher-anchor-color" data-role="message-content">\n<div class="post-message ',e=c.unless.call(a,(e=a&&a.post,null==e||e===!1?e:e.message),{hash:{},inverse:_e.noop,fn:_e.program(241,Mc,b),data:b}),(e||0===e)&&(f+=e),f+='"\ndata-role="message" dir="auto">\n',e=c["if"].call(a,c.eq.call(a,(e=a&&a.post,null==e||e===!1?e:e.message),"",{hash:{},data:b}),{hash:{},inverse:_e.program(245,Oc,b),fn:_e.program(243,Nc,b),data:b}),(e||0===e)&&(f+=e),f+='\n</div>\n\n<span class="post-media"><ul data-role="post-media-list"></ul></span>\n</div>\n</div>\n<a class="see-more hidden" title="'+$e(c.gettext.call(a,"see more",{hash:{},data:b}))+'" data-action="see-more">'+$e(c.gettext.call(a,"see more",{hash:{},data:b}))+"</a>\n</div>\n\n<footer>\n",e=_e.invokePartial(d.postFooter,"postFooter",a,c,d,b),(e||0===e)&&(f+=e),f+="\n</footer>\n</div>\n\n",e=_e.invokePartial(d.postWrapperBottom,"postWrapperBottom",a,c,d,b),(e||0===e)&&(f+=e),f+="\n\n"
}function Dc(a,b){var d,e="";return e+='\n<span class="author publisher-anchor-color"><a href="#" data-action="profile" data-user="'+$e((d=a&&a.post,d=null==d||d===!1?d:d.author,d=null==d||d===!1?d:d.id,typeof d===af?d.apply(a):d))+'" data-role="username">'+$e((d=a&&a.post,d=null==d||d===!1?d:d.author,d=null==d||d===!1?d:d.name,typeof d===af?d.apply(a):d))+"</a></span>\n",d=c["if"].call(a,(d=a&&a.post,d=null==d||d===!1?d:d.author,null==d||d===!1?d:d.badge),{hash:{},inverse:_e.program(228,Fc,b),fn:_e.program(226,Ec,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function Ec(a){var b,c="";return c+='\n<span class="badge" data-type="tracked-badge">'+$e((b=a&&a.post,b=null==b||b===!1?b:b.author,b=null==b||b===!1?b:b.badge,typeof b===af?b.apply(a):b))+"</span>\n"}function Fc(a,b){var d,e="";return e+="\n",d=c["if"].call(a,(d=a&&a.post,d=null==d||d===!1?d:d.author,d=null==d||d===!1?d:d.thread,null==d||d===!1?d:d.canModerate),{hash:{},inverse:_e.noop,fn:_e.program(229,Gc,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function Gc(a,b){var d="";return d+='\n<span class="badge moderator">'+$e(c.gettext.call(a,"Mod",{hash:{},data:b}))+"</span>\n"}function Hc(a){var b,c="";return c+='\n<span class="author">'+$e((b=a&&a.post,b=null==b||b===!1?b:b.author,b=null==b||b===!1?b:b.name,typeof b===af?b.apply(a):b))+"</span>\n"}function Ic(a){var b,c="";return c+='\n<span><a href="#comment-'+$e((b=a&&a.parentPost,b=null==b||b===!1?b:b.id,typeof b===af?b.apply(a):b))+'" class="parent-link" data-role="parent-link"><i aria-hidden="true" class="icon-forward" title="in reply to"></i> '+$e((b=a&&a.parentPost,b=null==b||b===!1?b:b.author,b=null==b||b===!1?b:b.name,typeof b===af?b.apply(a):b))+"</a></span>\n"}function Jc(a){var b,c="";return c+='\n<a href="#comment-'+$e((b=a&&a.post,b=null==b||b===!1?b:b.id,typeof b===af?b.apply(a):b))+'" data-role="relative-time" class="time-ago" title="'+$e((b=a&&a.post,b=null==b||b===!1?b:b.formattedCreatedAt,typeof b===af?b.apply(a):b))+'">\n'+$e((b=a&&a.post,b=null==b||b===!1?b:b.relativeCreatedAt,typeof b===af?b.apply(a):b))+"\n</a>\n"}function Kc(a){var b,c="";return c+='\n<span class="time-ago" data-role="relative-time" title="'+$e((b=a&&a.post,b=null==b||b===!1?b:b.formattedCreatedAt,typeof b===af?b.apply(a):b))+'">\n'+$e((b=a&&a.post,b=null==b||b===!1?b:b.relativeCreatedAt,typeof b===af?b.apply(a):b))+"\n</span>\n"}function Lc(a){var b,c="";return c+='\n<span class="state-byline state-byline-'+$e((b=a&&a.stateByline,b=null==b||b===!1?b:b.style,typeof b===af?b.apply(a):b))+'">\n<span class="icon-mobile icon-'+$e((b=a&&a.stateByline,b=null==b||b===!1?b:b.icon,typeof b===af?b.apply(a):b))+'" aria-hidden="true"></span>\n<span class="text">\n'+$e((b=a&&a.stateByline,b=null==b||b===!1?b:b.text,typeof b===af?b.apply(a):b))+"\n</span>\n</span>\n"}function Mc(){return"loading"}function Nc(a,b){var d="";return d+="\n<p><i>"+$e(c.gettext.call(a,"This comment has no content.",{hash:{},data:b}))+"</i></p>\n"}function Oc(a,b){var d,e="";return e+="\n"+$e(c.html.call(a,(d=a&&a.post,null==d||d===!1?d:d.message),{hash:{},data:b}))+"\n"}function Pc(a,b){var e,f="";return f+='\n<div data-role="post-content" class="post-content\n',e=c["if"].call(a,(e=a&&a.post,null==e||e===!1?e:e.isRealtime),{hash:{},inverse:_e.noop,fn:_e.program(248,Qc,b),data:b}),(e||0===e)&&(f+=e),f+="\n",e=c.if_all.call(a,(e=a&&a.session,null==e||e===!1?e:e.isRegistered),c.eq.call(a,(e=a&&a.post,e=null==e||e===!1?e:e.author,null==e||e===!1?e:e.id),(e=a&&a.session,null==e||e===!1?e:e.id),{hash:{},data:b}),{hash:{},inverse:_e.noop,fn:_e.program(250,Rc,b),data:b}),(e||0===e)&&(f+=e),f+="\n",e=c["if"].call(a,(e=a&&a.post,null==e||e===!1?e:e.isFlaggedByUser),{hash:{},inverse:_e.noop,fn:_e.program(252,Sc,b),data:b}),(e||0===e)&&(f+=e),f+='\n">\n',e=_e.invokePartial(d.postMenu,"postMenu",a,c,d,b),(e||0===e)&&(f+=e),f+='\n<div class="indicator"></div>\n'}function Qc(){return"new"}function Rc(){return"authored-by-session-user"}function Sc(){return"user-reported"}function Tc(){var a="";return a+='\n<div data-role="blacklist-form"></div>\n<div class="reply-form-container" data-role="reply-form"></div>\n</div>\n\n\n<ul data-role="children" class="children"/>\n'}function Uc(a,b){var d,e="";return e+='\n\n<div data-role="post-media">\n\n<a class="media-button media-button-expand publisher-color publisher-border-color" href="'+$e((d=a&&a.media,d=null==d||d===!1?d:d.url,typeof d===af?d.apply(a):d))+'" rel="nofollow" target="_blank" data-action="expand"\ntitle="',d=c["if"].call(a,(d=a&&a.media,null==d||d===!1?d:d.title),{hash:{},inverse:_e.noop,fn:_e.program(257,Vc,b),data:b}),(d||0===d)&&(e+=d),e+='">\n',d=c["if"].call(a,(d=a&&a.model,null==d||d===!1?d:d.providerIcon),{hash:{},inverse:_e.noop,fn:_e.program(260,Xc,b),data:b}),(d||0===d)&&(e+=d),e+="\n"+$e((d=a&&a.model,d=null==d||d===!1?d:d.providerExpandMessage,typeof d===af?d.apply(a):d))+'\n</a>\n<a class="media-button media-button-contract publisher-color publisher-border-color" href="#" target="_blank" data-action="contract">\n<i class="icon-cancel publisher-background-color"></i> '+$e((d=a&&a.model,d=null==d||d===!1?d:d.providerCollapseMessage,typeof d===af?d.apply(a):d))+'\n</a>\n\n<div class="media-content-loader" data-role="content-loader"></div>\n\n<div data-role="content-placeholder" class="media-content-placeholder"></div>\n</div>\n'}function Vc(a,b){var d,e="";return d=c["if"].call(a,(d=a&&a.media,null==d||d===!1?d:d.providerName),{hash:{},inverse:_e.noop,fn:_e.program(258,Wc,b),data:b}),(d||0===d)&&(e+=d),e+=$e((d=a&&a.media,d=null==d||d===!1?d:d.title,typeof d===af?d.apply(a):d))}function Wc(a){var b,c="";return c+=$e((b=a&&a.media,b=null==b||b===!1?b:b.providerName,typeof b===af?b.apply(a):b))+" &ndash; "}function Xc(a){var b,c="";return c+='<i class="'+$e((b=a&&a.model,b=null==b||b===!1?b:b.providerIcon,typeof b===af?b.apply(a):b))+' publisher-background-color"></i>'}function Yc(){var a="";return a+='\n\n<div data-role="post-media">\n\n<div class="media-content-loader" data-role="content-loader"></div>\n\n<div data-role="content-placeholder" class="media-content-placeholder"></div>\n</div>\n'}function Zc(a){var b,c="";return c+='\n<iframe src="'+$e((b=a&&a.url,typeof b===af?b.apply(a):b))+'" frameborder="0"></iframe>\n'}function $c(a){var b,c="";return c+='\n<a href="#" class="media-force-load" data-action="force-load"><i class="'+$e((b=a&&a.model,b=null==b||b===!1?b:b.providerIcon,typeof b===af?b.apply(a):b))+'"></i></a>\n'}function _c(a,b){var d,e="";return e+='\n<a href="'+$e((d=a&&a.imageUrl,typeof d===af?d.apply(a):d))+'" target="_blank" rel="nofollow">\n\n<img src="'+$e((d=a&&a.thumbnailUrl,typeof d===af?d.apply(a):d))+'" data-post="'+$e((d=a&&a.postId,typeof d===af?d.apply(a):d))+'" ',d=c["if"].call(a,(d=a&&a.model,null==d||d===!1?d:d.deferredHeight),{hash:{},inverse:_e.noop,fn:_e.program(269,ad,b),data:b}),(d||0===d)&&(e+=d),e+="/>\n</a>\n"}function ad(a){var b,c="";return c+=' height="'+$e((b=a&&a.model,b=null==b||b===!1?b:b.deferredHeight,typeof b===af?b.apply(a):b))+'" '}function bd(a,b){var d,e="";return e+="\n",d=c["if"].call(a,(d=a&&a.model,null==d||d===!1?d:d.deferred),{hash:{},inverse:_e.program(274,dd,b),fn:_e.program(272,cd,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function cd(a){var b,c="";return c+='\n\n<a href="'+$e((b=a&&a.href,typeof b===af?b.apply(a):b))+'" rel="nofollow">'+$e((b=a&&a.text,typeof b===af?b.apply(a):b))+"</a>\n"}function dd(a,b){var d,e="";return e+='\n\n<a href="'+$e((d=a&&a.href,typeof d===af?d.apply(a):d))+'" class="post-media-link" data-action="expand-collapse-media" rel="nofollow">',d=c["if"].call(a,(d=a&&a.model,null==d||d===!1?d:d.providerIcon),{hash:{},inverse:_e.noop,fn:_e.program(275,ed,b),data:b}),(d||0===d)&&(e+=d),e+=$e((d=a&&a.mediaLinkText,typeof d===af?d.apply(a):d)),d=c["if"].call(a,a&&a.domain,{hash:{},inverse:_e.noop,fn:_e.program(277,fd,b),data:b}),(d||0===d)&&(e+=d),e+="</a>\n"}function ed(a){var b,c="";return c+='<i class="'+$e((b=a&&a.model,b=null==b||b===!1?b:b.providerIcon,typeof b===af?b.apply(a):b))+'"></i>'}function fd(a){var b,c="";return c+='<span class="post-media-link-domain"> &mdash; '+$e((b=a&&a.domain,typeof b===af?b.apply(a):b))+"</span>"}function gd(a){var b,c="";return c+='\n<meta name="twitter:widgets:csp" content="on">\n<blockquote class="twitter-tweet" data-theme="'+$e((b=a&&a.theme,typeof b===af?b.apply(a):b))+'" data-link-color="'+$e((b=a&&a.linkColor,typeof b===af?b.apply(a):b))+'" lang="'+$e((b=a&&a.language,typeof b===af?b.apply(a):b))+'">\n<a href="'+$e((b=a&&a.url,typeof b===af?b.apply(a):b))+'"></a>\n</blockquote>\n<script src="//platform.twitter.com/widgets.js"></script>\n'}function hd(a,b){var d,e="";return e+='\n<a href="#" class="vote-up ',d=c["if"].call(a,c.gt.call(a,(d=a&&a.post,null==d||d===!1?d:d.userScore),0,{hash:{},data:b}),{hash:{},inverse:_e.noop,fn:_e.program(282,id,b),data:b}),(d||0===d)&&(e+=d),e+=" count-"+$e((d=a&&a.post,d=null==d||d===!1?d:d.likes,typeof d===af?d.apply(a):d))+'" data-action="upvote" title="',d=c.unless.call(a,(d=a&&a.post,null==d||d===!1?d:d.likes),{hash:{},inverse:_e.noop,fn:_e.program(284,jd,b),data:b}),(d||0===d)&&(e+=d),e+='">\n<span class="updatable count" data-role="likes">'+$e((d=a&&a.post,d=null==d||d===!1?d:d.likes,typeof d===af?d.apply(a):d))+'</span>\n<span class="control"><i aria-hidden="true" class="icon icon-arrow-2"></i></span>\n</a>\n<span role="button" class="vote-down ',d=c["if"].call(a,c.lt.call(a,(d=a&&a.post,null==d||d===!1?d:d.userScore),0,{hash:{},data:b}),{hash:{},inverse:_e.noop,fn:_e.program(286,kd,b),data:b}),(d||0===d)&&(e+=d),e+=" count-"+$e((d=a&&a.post,d=null==d||d===!1?d:d.dislikes,typeof d===af?d.apply(a):d))+'" ',d=c["if"].call(a,(d=a&&a.session,null==d||d===!1?d:d.isRegistered),{hash:{},inverse:_e.noop,fn:_e.program(288,ld,b),data:b}),(d||0===d)&&(e+=d),e+=' title="'+$e(c.gettext.call(a,"Vote down",{hash:{},data:b}))+'">\n',d=c.unless.call(a,a&&a.hideDownvoteNumber,{hash:{},inverse:_e.noop,fn:_e.program(290,md,b),data:b}),(d||0===d)&&(e+=d),e+='\n<span class="control"><i aria-hidden="true" class="icon icon-arrow"></i></span>\n',d=c["if"].call(a,(d=a&&a.session,null==d||d===!1?d:d.isAnonymous),{hash:{},inverse:_e.program(294,od,b),fn:_e.program(292,nd,b),data:b}),(d||0===d)&&(e+=d),e+="\n</span>\n"}function id(){return"upvoted"}function jd(a,b){return $e(c.gettext.call(a,"Vote up",{hash:{},data:b}))}function kd(){return"downvoted"}function ld(){return'href="#" data-action="downvote"'}function md(a){var b,c="";return c+='\n<span class="updatable count" data-role="dislikes">'+$e((b=a&&a.post,b=null==b||b===!1?b:b.dislikes,typeof b===af?b.apply(a):b))+"</span>\n"}function nd(a,b){var d="";return d+='\n<span class="tooltip">'+$e(c.gettext.call(a,"You must sign in to down-vote this post.",{hash:{},data:b}))+"</span>\n"}function od(a,b){var d="";return d+='\n<span class="tooltip tooltip-disabled" data-role="downvote-tooltip">\n'+$e(c.gettext.call(a,"Voting has changed.",{hash:{},data:b}))+'\n<a class="btn-link" target="_blank" data-action="downvote-tooltip-link" href="http://help.disqus.com/customer/portal/articles/658811-how-voting-works">\n'+$e(c.gettext.call(a,"Learn more",{hash:{},data:b}))+"\n</a>\n</span>\n"}function pd(a,b){var d,e="";return e+='\n<ul class="post-menu dropdown" data-role="menu">\n<li class="collapse">\n<a href="#" data-action="collapse" title="'+$e(c.gettext.call(a,"Collapse",{hash:{},data:b}))+'"><span>−</span></a>\n</li>\n<li class="expand">\n<a href="#" data-action="collapse" title="'+$e(c.gettext.call(a,"Expand",{hash:{},data:b}))+'"><span>+</span></a>\n</li>\n\n',d=c.if_all.call(a,(d=a&&a.post,null==d||d===!1?d:d.id),c.ne.call(a,(d=a&&a.post,null==d||d===!1?d:d.isMinimized),!0,{hash:{},data:b}),c.ne.call(a,(d=a&&a.post,null==d||d===!1?d:d.isDeleted),!0,{hash:{},data:b}),{hash:{},inverse:_e.noop,fn:_e.program(297,qd,b),data:b}),(d||0===d)&&(e+=d),e+="\n</ul>\n"}function qd(a,b){var d,e="";return e+='\n<li class="',d=c["if"].call(a,(d=a&&a.session,d=null==d||d===!1?d:d.thread,null==d||d===!1?d:d.canModerate),{hash:{},inverse:_e.noop,fn:_e.program(298,rd,b),data:b}),(d||0===d)&&(e+=d),e+='"\nrole="menu">\n',d=c["if"].call(a,(d=a&&a.session,d=null==d||d===!1?d:d.thread,null==d||d===!1?d:d.canModerate),{hash:{},inverse:_e.program(309,xd,b),fn:_e.program(300,sd,b),data:b}),(d||0===d)&&(e+=d),e+="\n</li>\n"}function rd(){return"moderator-menu-options"}function sd(a,b){var d,e="";return e+='\n<a class="dropdown-toggle" data-toggle="dropdown" href="#"><b\nclass="caret moderator-menu-options"></b></a>\n<ul class="dropdown-menu">\n<li><a href="#" data-action="spam">'+$e(c.gettext.call(a,"Mark as Spam",{hash:{},data:b}))+'</a></li>\n<li><a href="#" data-action="delete">'+$e(c.gettext.call(a,"Delete",{hash:{},data:b}))+'</a> </li>\n<li><a href="#" data-action="blacklist">'+$e(c.gettext.call(a,"Blacklist",{hash:{},data:b}))+'</a> </li>\n<li>\n<a href="'+$e(c.urlfor.call(a,"moderate",{hash:{},data:b}))+"#/approved/search/id:"+$e((d=a&&a.post,d=null==d||d===!1?d:d.id,typeof d===af?d.apply(a):d))+'"\ntarget="_blank">'+$e(c.gettext.call(a,"Moderate",{hash:{},data:b}))+'</a>\n</li>\n\n<li class="highlight-toggle">\n<a href="#"\ndata-action="',d=c["if"].call(a,(d=a&&a.post,null==d||d===!1?d:d.isHighlighted),{hash:{},inverse:_e.program(303,ud,b),fn:_e.program(301,td,b),data:b}),(d||0===d)&&(e+=d),e+='">\n',d=c["if"].call(a,(d=a&&a.post,null==d||d===!1?d:d.isHighlighted),{hash:{},inverse:_e.program(307,wd,b),fn:_e.program(305,vd,b),data:b}),(d||0===d)&&(e+=d),e+="\n</a>\n</li>\n</ul>\n"}function td(){return"unhighlight"}function ud(){return"highlight"}function vd(a,b){var d="";return d+="\n"+$e(c.gettext.call(a,"Stop featuring",{hash:{},data:b}))+"\n"}function wd(a,b){var d="";return d+="\n"+$e(c.gettext.call(a,"Feature this comment",{hash:{},data:b}))+"\n"}function xd(a,b){var d,e="";return e+="\n",d=c.if_all.call(a,(d=a&&a.session,null==d||d===!1?d:d.isRegistered),(d=a&&a.post,null==d||d===!1?d:d.author),c.eq.call(a,(d=a&&a.post,d=null==d||d===!1?d:d.author,null==d||d===!1?d:d.id),(d=a&&a.session,null==d||d===!1?d:d.id),{hash:{},data:b}),{hash:{},inverse:_e.program(312,zd,b),fn:_e.program(310,yd,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function yd(a,b){var d="";return d+='\n<a class="dropdown-toggle" data-toggle="dropdown"\nhref="#"><b class="caret"></b></a>\n<ul class="dropdown-menu">\n<li><a href="#" data-action="delete">'+$e(c.gettext.call(a,"Delete",{hash:{},data:b}))+'</a></li>\n<li><a href="#" data-action="flag">'+$e(c.gettext.call(a,"Flag as inappropriate",{hash:{},data:b}))+"</a></li>\n</ul>\n"}function zd(a,b){var d="";return d+='\n<a class="dropdown-toggle" href="#" data-action="flag"\ndata-role="flag" title="'+$e(c.gettext.call(a,"Flag as inappropriate",{hash:{},data:b}))+'">\n<i aria-hidden="true" class="icon icon-flag"></i>\n</a>\n'}function Ad(a,b){var e,f="";return f+='\n<menu>\n\n<li class="voting" data-role="voting">\n',e=_e.invokePartial(d.postVotes,"postVotes",a,c,d,b),(e||0===e)&&(f+=e),f+='\n</li>\n<li class="bullet" aria-hidden="true">•</li>\n\n',e=c["if"].call(a,(e=a&&a.post,null==e||e===!1?e:e.canBeEdited),{hash:{},inverse:_e.noop,fn:_e.program(315,Bd,b),data:b}),(e||0===e)&&(f+=e),f+="\n\n",e=c["if"].call(a,(e=a&&a.post,null==e||e===!1?e:e.canBeRepliedTo),{hash:{},inverse:_e.noop,fn:_e.program(317,Cd,b),data:b}),(e||0===e)&&(f+=e),f+="\n\n",e=c["if"].call(a,(e=a&&a.post,null==e||e===!1?e:e.isSponsored),{hash:{},inverse:_e.noop,fn:_e.program(319,Dd,b),data:b}),(e||0===e)&&(f+=e),f+="\n\n",e=c["if"].call(a,(e=a&&a.post,null==e||e===!1?e:e.canBeShared),{hash:{},inverse:_e.noop,fn:_e.program(321,Ed,b),data:b}),(e||0===e)&&(f+=e),f+="\n\n",e=c.unless.call(a,(e=a&&a.post,null==e||e===!1?e:e.isDeleted),{hash:{},inverse:_e.noop,fn:_e.program(323,Fd,b),data:b}),(e||0===e)&&(f+=e),f+="\n\n",e=c["if"].call(a,(e=a&&a.post,null==e||e===!1?e:e.isSponsored),{hash:{},inverse:_e.noop,fn:_e.program(325,Gd,b),data:b}),(e||0===e)&&(f+=e),f+="\n</menu>\n"}function Bd(a,b){var d="";return d+='\n<li class="edit" data-role="edit-link">\n<a href="#" data-action="edit">\n<i class="icon icon-mobile icon-pencil"></i><span class="text">'+$e(c.gettext.call(a,"Edit",{hash:{},data:b}))+'</span></a></li>\n<li class="bullet" aria-hidden="true">•</li>\n'}function Cd(a,b){var d="";return d+='\n<li class="reply" data-role="reply-link">\n<a href="#" data-action="reply">\n<i class="icon icon-mobile icon-reply"></i><span class="text">'+$e(c.gettext.call(a,"Reply",{hash:{},data:b}))+'</span></a></li>\n<li class="bullet" aria-hidden="true">•</li>\n'}function Dd(a,b){var d,e="";return e+='\n<li class="thread-link" data-role="thread-link">\n<a href="'+$e((d=a&&a.thread,d=null==d||d===!1?d:d.link,typeof d===af?d.apply(a):d))+"#comment-"+$e((d=a&&a.post,d=null==d||d===!1?d:d.id,typeof d===af?d.apply(a):d))+'" target="_blank" data-action="thread">\n<i class="icon icon-mobile"></i><span class="text">'+$e(c.gettext.call(a,"View all comments",{hash:{},data:b}))+'</span></a></li>\n<li class="bullet" aria-hidden="true">•</li>\n'}function Ed(a,b){var d,e="";return e+='\n<li class="share">\n<a class="toggle"><i class="icon icon-mobile icon-share"></i><span class="text">'+$e(c.gettext.call(a,"Share",{hash:{},data:b}))+' ›</span></a>\n<ul>\n<li class="twitter"><a href="#" data-action="share:twitter">Twitter</a></li>\n<li class="facebook"><a href="#" data-action="share:facebook">Facebook</a></li>\n<li class="link"><a href="#comment-'+$e((d=a&&a.post,d=null==d||d===!1?d:d.id,typeof d===af?d.apply(a):d))+'">'+$e(c.gettext.call(a,"Link",{hash:{},data:b}))+"</a></li>\n</ul>\n</li>\n"}function Fd(a){var b,c="";return c+='\n<li class="realtime" data-role="realtime-notification:'+$e((b=a&&a.post,b=null==b||b===!1?b:b.id,typeof b===af?b.apply(a):b))+'">\n<span style="display:none;" class="realtime-replies"></span>\n<a style="display:none;" href="#" class="btn btn-small"></a>\n\n</li>\n'}function Gd(a,b){var d="";return d+='\n<li class="feedback">\n<button data-action="feedback">'+$e(c.gettext.call(a,"Leave Feedback",{hash:{},data:b}))+"</button>\n</li>\n"}function Hd(a,b){var d,e="";return e+="\n",d=c.if_all.call(a,(d=a&&a.post,d=null==d||d===!1?d:d.author,null==d||d===!1?d:d.isRegistered),c.ne.call(a,(d=a&&a.post,null==d||d===!1?d:d.isMinimized),!0,{hash:{},data:b}),{hash:{},inverse:_e.program(330,Jd,b),fn:_e.program(328,Id,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function Id(a,b){var d,e="";return e+='\n<div class="avatar hovercard">\n<a href="'+$e((d=a&&a.post,d=null==d||d===!1?d:d.author,d=null==d||d===!1?d:d.profileUrl,typeof d===af?d.apply(a):d))+'" class="user"\ndata-action="profile" data-user="'+$e((d=a&&a.post,d=null==d||d===!1?d:d.author,d=null==d||d===!1?d:d.id,typeof d===af?d.apply(a):d))+'">\n<img data-role="user-avatar" data-user="'+$e((d=a&&a.post,d=null==d||d===!1?d:d.author,d=null==d||d===!1?d:d.id,typeof d===af?d.apply(a):d))+'" src="'+$e((d=a&&a.defaultAvatarUrl,typeof d===af?d.apply(a):d))+'" data-src="'+$e((d=a&&a.post,d=null==d||d===!1?d:d.author,d=null==d||d===!1?d:d.avatar,d=null==d||d===!1?d:d.cache,typeof d===af?d.apply(a):d))+'"\nalt="'+$e(c.gettext.call(a,"Avatar",{hash:{},data:b}))+'"/>\n</a>\n</div>\n'}function Jd(a,b){var d,e="";return e+='\n<div class="avatar">\n\n<div class="user"><img src="'+$e((d=a&&a.defaultAvatarUrl,typeof d===af?d.apply(a):d))+'"\nclass="user" alt="'+$e(c.gettext.call(a,"Avatar",{hash:{},data:b}))+'"/></div>\n</div>\n'}function Kd(a,b){var d="";return d+="\n\n"+$e(c.gettext.call(a,"You've featured a comment! This comment will now also appear at the top of the discussion.",{hash:{},data:b}))+"\n"}function Ld(a,b){var e,f="";return f+="\n",e=_e.invokePartial(d.postWrapperTop,"postWrapperTop",a,c,d,b),(e||0===e)&&(f+=e),f+='\n\n<div class="avatar">\n<img data-src="'+$e(c.urlfor.call(a,"avatar.generic",{hash:{},data:b}))+'" class="user" alt="'+$e(c.gettext.call(a,"Avatar",{hash:{},data:b}))+'" />\n</div>\n<div class="post-body">\n<div class="post-message">\n<p>'+$e(c.gettext.call(a,"This comment was deleted.",{hash:{},data:b}))+"</p>\n</div>\n\n<header>\n",e=_e.invokePartial(d.postMenu,"postMenu",a,c,d,b),(e||0===e)&&(f+=e),f+="\n</header>\n</div>\n\n",e=_e.invokePartial(d.postWrapperBottom,"postWrapperBottom",a,c,d,b),(e||0===e)&&(f+=e),f+="\n"}function Md(a,b){var e,f="";return f+="\n",e=_e.invokePartial(d.postWrapperTop,"postWrapperTop",a,c,d,b),(e||0===e)&&(f+=e),f+="\n\n",e=_e.invokePartial(d.postUserAvatar,"postUserAvatar",a,c,d,b),(e||0===e)&&(f+=e),f+='\n<div class="post-body">\n<div class="post-message publisher-anchor-color">\n',e=c.if_any.call(a,a&&a.created,(e=a&&a.post,null==e||e===!1?e:e.isApproved),{hash:{},inverse:_e.program(342,Qd,b),fn:_e.program(337,Nd,b),data:b}),(e||0===e)&&(f+=e),f+='\n</div>\n\n<header>\n<div class="post-meta">\n\n'+$e(c.gettext.call(a,"This comment is awaiting moderation.",{hash:{},data:b}))+"\n</div>\n\n",e=_e.invokePartial(d.postMenu,"postMenu",a,c,d,b),(e||0===e)&&(f+=e),f+="\n</header>\n</div>\n\n",e=_e.invokePartial(d.postWrapperBottom,"postWrapperBottom",a,c,d,b),(e||0===e)&&(f+=e),f+="\n"}function Nd(a,b){var d,e="";return e+="\n",d=c["if"].call(a,(d=a&&a.post,null==d||d===!1?d:d.isApproved),{hash:{},inverse:_e.program(340,Pd,b),fn:_e.program(338,Od,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function Od(a,b){var d="";return d+="\n<p>"+$e(c.gettext.call(a,"Comment score below threshold.",{hash:{},data:b}))+' <a href="#" data-action="reveal">'+$e(c.gettext.call(a,"Show comment.",{hash:{},data:b}))+"</a></p>\n"}function Pd(a,b){var d="";return d+="\n<p>"+$e(c.gettext.call(a,"Your comment is awaiting moderation.",{hash:{},data:b}))+' <a href="#" data-action="reveal">'+$e(c.gettext.call(a,"See your comment.",{hash:{},data:b}))+'</a>  <a href="http://help.disqus.com/customer/portal/articles/466223" class="help-icon" title="'+$e(c.gettext.call(a,"Why?",{hash:{},data:b}))+'" target="_blank"></a> </p>\n'}function Qd(a,b){var d="";return d+="\n\n<p>"+$e(c.gettext.call(a,"This comment is awaiting moderation.",{hash:{},data:b}))+' <a href="#" data-action="reveal">'+$e(c.gettext.call(a,"Show comment.",{hash:{},data:b}))+"</a></p>\n"}function Rd(a,b){var d,e="";return e+='\n<div class="alert">\n<span class="icon icon-warning"></span>\n<p class="text">\n<span>\n',d=c["if"].call(a,a&&a.safe,{hash:{},inverse:_e.program(347,Td,b),fn:_e.program(345,Sd,b),data:b}),(d||0===d)&&(e+=d),e+="\n</span>\n</p>\n</div>\n"}function Sd(a,b){var d="";return d+="\n"+$e(c.html.call(a,a&&a.message,{hash:{},data:b}))+"\n"}function Td(a){var b,c="";return c+="\n"+$e((b=a&&a.message,typeof b===af?b.apply(a):b))+"\n"}function Ud(a,b){var d,e="";return e+="\n",d=c["if"].call(a,c.eq.call(a,a&&a.comments,1,{hash:{},data:b}),{hash:{},inverse:_e.program(352,Wd,b),fn:_e.program(350,Vd,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function Vd(a,b){var d="";return d+="\n"+$e(c.gettext.call(a,"Show One New Comment",{hash:{},data:b}))+"\n"}function Wd(a,b){var d="";return d+="\n"+$e(c.gettext.call(a,"Show %(comments)s New Comments",{hash:{comments:a&&a.comments},data:b}))+"\n"}function Xd(a,b){var d,e="";return e+="\n",d=c["if"].call(a,c.eq.call(a,a&&a.replies,1,{hash:{},data:b}),{hash:{},inverse:_e.program(357,Zd,b),fn:_e.program(355,Yd,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function Yd(a,b){var d="";return d+='\n<span class="indicator"></span>'+$e(c.gettext.call(a,"Show 1 new reply",{hash:{},data:b}))+"\n"}function Zd(a,b){var d="";return d+='\n<span class="indicator"></span>'+$e(c.gettext.call(a,"Show %(replies)s new replies",{hash:{replies:a&&a.replies},data:b}))+"\n"}function $d(a){var b,c="";return c+='\n<!doctype html>\n<style>\nhtml * {\nmargin: 0;\npadding: 0;\ncursor: pointer;\n}\n\ndiv {\ntext-align: center;\nfont-family: "Helvetica Neue", Helvetica, sans-serif;\nborder: 2px solid #ccc;\nbackground: #f4f4f4;\ncolor: #777;\npadding: 7px 0;\nfilter: alpha(opacity=90);\nopacity: 0.9;\nfont-size: 13px;\nline-height: 1;\nz-index: 1000;\n}\n\ndiv.north {\nborder-top: 0;\nborder-radius: 0 0 4px 4px;\n}\n\ndiv.south {\nborder-bottom: 0;\nborder-radius: 4px 4px 0 0;\n}\n</style>\n<div class="'+$e((b=a&&a.orientation,typeof b===af?b.apply(a):b))+'" id="message">-</div>\n'}function _d(a,b){var d,e="";return e+="\n",d=c["if"].call(a,c.eq.call(a,a&&a.orientation,"north",{hash:{},data:b}),{hash:{},inverse:_e.program(367,de,b),fn:_e.program(362,ae,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function ae(a,b){var d,e="";return e+="\n",d=c["if"].call(a,c.eq.call(a,a&&a.num,1,{hash:{},data:b}),{hash:{},inverse:_e.program(365,ce,b),fn:_e.program(363,be,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function be(a,b){var d="";return d+="\n<p>"+$e(c.gettext.call(a,"One new comment above.",{hash:{},data:b}))+"</p>\n"}function ce(a,b){var d="";return d+="\n<p>"+$e(c.gettext.call(a,"%(num)s new comments above.",{hash:{num:a&&a.num},data:b}))+"</p>\n"}function de(a,b){var d,e="";return e+="\n",d=c["if"].call(a,c.eq.call(a,a&&a.num,1,{hash:{},data:b}),{hash:{},inverse:_e.program(370,fe,b),fn:_e.program(368,ee,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function ee(a,b){var d="";return d+="\n<p>"+$e(c.gettext.call(a,"One new comment below.",{hash:{},data:b}))+"</p>\n"}function fe(a,b){var d="";return d+="\n<p>"+$e(c.gettext.call(a,"%(num)s new comments below.",{hash:{num:a&&a.num},data:b}))+"</p>\n"}function ge(a,b){var d="";return d+='\n<ul class="suggestions">\n<li class="header">\n<h5>'+$e(c.gettext.call(a,"in this conversation",{hash:{},data:b}))+"</h5>\n</li>\n</ul>\n"}function he(a,b){var d,e="";return e+='\n<li data-cid="'+$e((d=a&&a.cid,typeof d===af?d.apply(a):d))+'">\n<img src="'+$e((d=a&&a.avatar,d=null==d||d===!1?d:d.cache,typeof d===af?d.apply(a):d))+'" class="avatar">\n<span>'+$e(c.any.call(a,a&&a.name,a&&a.username,{hash:{},data:b}))+"</span>\n</li>\n"}function ie(a,b){var d,e="";return e+='\n<div>\n<div class="avatar">\n',d=c["if"].call(a,(d=a&&a.author,null==d||d===!1?d:d.isRegistered),{hash:{},inverse:_e.program(379,ke,b),fn:_e.program(377,je,b),data:b}),(d||0===d)&&(e+=d),e+="\n</div>\n\n<div>\n<p>\n<strong>\n",d=c["if"].call(a,(d=a&&a.author,null==d||d===!1?d:d.isRegistered),{hash:{},inverse:_e.program(383,me,b),fn:_e.program(381,le,b),data:b}),(d||0===d)&&(e+=d),e+="\n</strong>\n&mdash; "+$e(c.html.call(a,a&&a.message,{hash:{},data:b}))+"\n</p>\n</div>\n</div>\n"}function je(a,b){var d,e="";return e+='\n<a href="'+$e((d=a&&a.author,d=null==d||d===!1?d:d.profileUrl,typeof d===af?d.apply(a):d))+'" class="user" data-action="profile" data-user="'+$e((d=a&&a.author,d=null==d||d===!1?d:d.id,typeof d===af?d.apply(a):d))+'">\n<img data-src="'+$e((d=a&&a.author,d=null==d||d===!1?d:d.avatar,d=null==d||d===!1?d:d.cache,typeof d===af?d.apply(a):d))+'" alt="'+$e(c.gettext.call(a,"Avatar",{hash:{},data:b}))+'"/>\n</a>\n'}function ke(a,b){var d,e="";return e+='\n<div class="user">\n<img data-src="'+$e((d=a&&a.author,d=null==d||d===!1?d:d.avatar,d=null==d||d===!1?d:d.cache,typeof d===af?d.apply(a):d))+'" class="user" alt="'+$e(c.gettext.call(a,"Avatar",{hash:{},data:b}))+'"/>\n</div>\n'}function le(a,b){var d,e="";return e+='\n<a href="'+$e((d=a&&a.author,d=null==d||d===!1?d:d.profileUrl,typeof d===af?d.apply(a):d))+'" class="user" data-action="profile" data-user="'+$e((d=a&&a.author,d=null==d||d===!1?d:d.id,typeof d===af?d.apply(a):d))+'">\n'+$e(c.any.call(a,(d=a&&a.author,null==d||d===!1?d:d.name),(d=a&&a.author,null==d||d===!1?d:d.username),{hash:{},data:b}))+"</a>\n"}function me(a,b){var d,e="";return e+='\n<span class="user">'+$e(c.any.call(a,(d=a&&a.author,null==d||d===!1?d:d.name),(d=a&&a.author,null==d||d===!1?d:d.username),{hash:{},data:b}))+"</span>\n"}function ne(a,b){var e,f="";return f+='\n<li class="top-user">\n<div class="avatar">\n',e=c["if"].call(a,(e=a&&a.user,null==e||e===!1?e:e.isRegistered),{hash:{},inverse:_e.program(388,pe,b),fn:_e.program(386,oe,b),data:b}),(e||0===e)&&(f+=e),f+='\n</div>\n\n<div class="profile-card-text">\n<h5>\n<span>\n',e=c["if"].call(a,(e=a&&a.user,null==e||e===!1?e:e.isRegistered),{hash:{},inverse:_e.program(392,re,b),fn:_e.program(390,qe,b),data:b}),(e||0===e)&&(f+=e),f+='\n</span>\n</h5>\n\n<span class="post-count">\n',e=c["if"].call(a,c.eq.call(a,(e=a&&a.user,null==e||e===!1?e:e.numPosts),1,{hash:{},data:b}),{hash:{},inverse:_e.noop,fn:_e.program(42,F,b),data:b}),(e||0===e)&&(f+=e),f+="\n\n",e=c["if"].call(a,c.ge.call(a,(e=a&&a.user,null==e||e===!1?e:e.numPosts),2,{hash:{},data:b}),{hash:{},inverse:_e.noop,fn:_e.program(149,Nb,b),data:b}),(e||0===e)&&(f+=e),f+="\n</span>\n\n",e=_e.invokePartial(d.followButtonSmall,"followButtonSmall",a,c,d,b),(e||0===e)&&(f+=e),f+="\n\n</div>\n</li>\n"}function oe(a,b){var d,e="";return e+='\n<a href="#" class="user" data-action="profile" data-user="'+$e((d=a&&a.user,d=null==d||d===!1?d:d.id,typeof d===af?d.apply(a):d))+'">\n<img data-role="user-avatar" data-user="'+$e((d=a&&a.user,d=null==d||d===!1?d:d.id,typeof d===af?d.apply(a):d))+'" data-src="'+$e((d=a&&a.user,d=null==d||d===!1?d:d.avatar,d=null==d||d===!1?d:d.cache,typeof d===af?d.apply(a):d))+'" alt="'+$e(c.gettext.call(a,"Avatar",{hash:{},data:b}))+'"/>\n</a>\n'}function pe(a,b){var d,e="";return e+='\n<div class="user">\n<img data-src="'+$e((d=a&&a.user,d=null==d||d===!1?d:d.avatar,d=null==d||d===!1?d:d.cache,typeof d===af?d.apply(a):d))+'" class="user" alt="'+$e(c.gettext.call(a,"Avatar",{hash:{},data:b}))+'"/>\n</div>\n'}function qe(a,b){var d,e="";return e+='\n<a href="'+$e((d=a&&a.user,d=null==d||d===!1?d:d.profileUrl,typeof d===af?d.apply(a):d))+'" data-action="profile" data-user="'+$e((d=a&&a.user,d=null==d||d===!1?d:d.id,typeof d===af?d.apply(a):d))+'" data-role="username">\n'+$e(c.any.call(a,(d=a&&a.user,null==d||d===!1?d:d.name),(d=a&&a.user,null==d||d===!1?d:d.username),{hash:{},data:b}))+"</a>\n"}function re(a,b){var d,e="";return e+="\n"+$e(c.any.call(a,(d=a&&a.author,null==d||d===!1?d:d.name),(d=a&&a.author,null==d||d===!1?d:d.username),{hash:{},data:b}))+"\n"}function se(a,b){var d,e="";return e+='\n<li data-role="thread-'+$e((d=a&&a.id,typeof d===af?d.apply(a):d))+'">\n\n\n\n<h4><span class="publisher-anchor-color"><a class="outbound-link" target="_blank" href="'+$e((d=a&&a.url,typeof d===af?d.apply(a):d))+'">'+$e(c.html.call(a,a&&a.title,{hash:{},data:b}))+'<i aria-hidden="true" class="icon-expand"></i></a></span></h4>\n\n<ul class="meta">\n<li class="likes">\n<a href="'+$e((d=a&&a.url,typeof d===af?d.apply(a):d))+'">\n<span class="icon-star"></span>\n'+$e(c.gettext.call(a,"%(numLikes)s starred this",{hash:{numLikes:a&&a.numLikes},data:b}))+"\n</a>\n</li>\n\n",d=c["if"].call(a,c.gt.call(a,a&&a.numPosts,0,{hash:{},data:b}),{hash:{},inverse:_e.noop,fn:_e.program(395,te,b),data:b}),(d||0===d)&&(e+=d),e+='\n\n<li class="bullet">•</li>\n\n<li class="time">'+$e((d=a&&a.timeAgo,typeof d===af?d.apply(a):d))+'</li>\n</ul>\n\n<div class="top-thread-post" data-role="top-thread-post">\n\n</div>\n</li>\n'}function te(a,b){var d,e="";return e+='\n<li class="bullet">•</li>\n\n<li class="comments">\n<a href="'+$e((d=a&&a.url,typeof d===af?d.apply(a):d))+'">\n',d=c["if"].call(a,c.eq.call(a,a&&a.numPosts,1,{hash:{},data:b}),{hash:{},inverse:_e.program(396,ue,b),fn:_e.program(42,F,b),data:b}),(d||0===d)&&(e+=d),e+="\n</a>\n</li>\n"}function ue(a,b){var d="";return d+="\n"+$e(c.gettext.call(a,"%(numPosts)s comments",{hash:{numPosts:a&&a.numPosts},data:b}))+"\n"}function ve(a,b){var d,e="";return e+='\n<div class="tooltip upvoters ',d=c.unless.call(a,(d=a&&a.users,null==d||d===!1?d:d.length),{hash:{},inverse:_e.noop,fn:_e.program(399,we,b),data:b}),(d||0===d)&&(e+=d),e+='">\n<ul class="scroll-measure" data-role="content">\n',d=c["if"].call(a,(d=a&&a.users,null==d||d===!1?d:d.length),{hash:{},inverse:_e.program(404,ze,b),fn:_e.program(401,xe,b),data:b}),(d||0===d)&&(e+=d),e+="\n\n",d=c["if"].call(a,a&&a.guestCount,{hash:{},inverse:_e.noop,fn:_e.program(407,Be,b),data:b}),(d||0===d)&&(e+=d),e+='\n</ul>\n</div>\n<div class="tooltip-point hidden"></div>\n'}function we(){return"guests-only"}function xe(a,b){var d,e="";return e+="\n",d=c.each.call(a,a&&a.users,{hash:{},inverse:_e.noop,fn:_e.program(402,ye,b),data:b}),(d||0===d)&&(e+=d),e+="\n"
}function ye(a,b){var e,f="";return f+="\n",e=_e.invokePartial(d.upvoter,"upvoter",a,c,d,b),(e||0===e)&&(f+=e),f+="\n"}function ze(a,b){var d,e="";return e+="\n",d=c["if"].call(a,a&&a.isLoading,{hash:{},inverse:_e.noop,fn:_e.program(405,Ae,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function Ae(){return'\n<li class="loading"></li>\n'}function Be(a,b){var e,f="";return f+="\n",e=_e.invokePartial(d.guestUpvoter,"guestUpvoter",a,c,d,b),(e||0===e)&&(f+=e),f+="\n"}function Ce(a,b){var d,e="";return e+='\n<li class="user ',d=c["if"].call(a,a&&a.highlight,{hash:{},inverse:_e.noop,fn:_e.program(303,ud,b),data:b}),(d||0===d)&&(e+=d),e+='" data-action="profile" data-user="'+$e((d=a&&a.id,typeof d===af?d.apply(a):d))+'">\n\n<a class="avatar" href="#" title="'+$e((d=a&&a.name,typeof d===af?d.apply(a):d))+'">\n<img src="'+$e((d=a&&a.avatar,d=null==d||d===!1?d:d.cache,typeof d===af?d.apply(a):d))+'" alt="'+$e(c.gettext.call(a,"Avatar",{hash:{},data:b}))+'" />\n</a>\n<a class="username" href="#" title="'+$e((d=a&&a.name,typeof d===af?d.apply(a):d))+'">\n'+$e((d=a&&a.name,typeof d===af?d.apply(a):d))+"\n</a>\n</li>\n"}function De(a,b){var d,e="";return e+="\n",d=c["if"].call(a,a&&a.guestCount,{hash:{},inverse:_e.noop,fn:_e.program(412,Ee,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function Ee(a,b){var e,f="";return f+='\n<li class="user ',e=c["if"].call(a,a&&a.highlight,{hash:{},inverse:_e.noop,fn:_e.program(303,ud,b),data:b}),(e||0===e)&&(f+=e),f+='" data-role="guest">\n<span class="avatar" title="',e=_e.invokePartial(d.guestUpvoterText,"guestUpvoterText",a,c,d,b),(e||0===e)&&(f+=e),f+='">\n<img src="'+$e((e=a&&a.guestAvatarUrl,typeof e===af?e.apply(a):e))+'" alt="'+$e(c.gettext.call(a,"Avatar",{hash:{},data:b}))+'" />\n</span>\n<span class="username" title="',e=_e.invokePartial(d.guestUpvoterText,"guestUpvoterText",a,c,d,b),(e||0===e)&&(f+=e),f+='">\n',e=_e.invokePartial(d.guestUpvoterText,"guestUpvoterText",a,c,d,b),(e||0===e)&&(f+=e),f+="\n</span>\n</li>\n"}function Fe(a,b){var d,e="";return e+="\n",d=c["if"].call(a,c.gt.call(a,a&&a.guestCount,1,{hash:{},data:b}),{hash:{},inverse:_e.program(417,He,b),fn:_e.program(415,Ge,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function Ge(a,b){var d="";return d+=" "+$e(c.gettext.call(a,"%(guestCount)s Guest Votes",{hash:{guestCount:a&&a.guestCount},data:b}))+" "}function He(a,b){var d="";return d+=" "+$e(c.gettext.call(a,"1 Guest Vote",{hash:{},data:b}))+" "}function Ie(a,b){var d,e="";return e+="\n",d=c["if"].call(a,(d=a&&a.user,d=null==d||d===!1?d:d.thread,null==d||d===!1?d:d.canReply),{hash:{},inverse:_e.noop,fn:_e.program(420,Je,b),data:b}),(d||0===d)&&(e+=d),e+='\n<ul class="dropdown-menu">\n',d=c["if"].call(a,(d=a&&a.user,null==d||d===!1?d:d.isRegistered),{hash:{},inverse:_e.program(428,Oe,b),fn:_e.program(425,Me,b),data:b}),(d||0===d)&&(e+=d),e+="\n\n",d=c["if"].call(a,(d=a&&a.user,d=null==d||d===!1?d:d.thread,null==d||d===!1?d:d.canModerate),{hash:{},inverse:_e.noop,fn:_e.program(431,Qe,b),data:b}),(d||0===d)&&(e+=d),e+="\n\n",d=c["if"].call(a,(d=a&&a.user,null==d||d===!1?d:d.isGlobalAdmin),{hash:{},inverse:_e.noop,fn:_e.program(442,We,b),data:b}),(d||0===d)&&(e+=d),e+="\n\n",d=c.if_all.call(a,(d=a&&a.user,null==d||d===!1?d:d.isRegistered),(d=a&&a.user,d=null==d||d===!1?d:d.thread,null==d||d===!1?d:d.canReply),{hash:{},inverse:_e.noop,fn:_e.program(444,Xe,b),data:b}),(d||0===d)&&(e+=d),e+="\n</ul>\n"}function Je(a,b){var d,e="";return e+='\n\n<a href="#" class="dropdown-toggle" data-toggle="dropdown">\n<span class="dropdown-toggle-wrapper">\n\n',d=c["if"].call(a,(d=a&&a.user,null==d||d===!1?d:d.isRegistered),{hash:{},inverse:_e.program(423,Le,b),fn:_e.program(421,Ke,b),data:b}),(d||0===d)&&(e+=d),e+='\n\n</span> <span class="caret"></span>\n</a>\n'}function Ke(a,b){var d,e="";return e+='\n<span class="avatar">\n<img data-role="user-avatar" data-user="'+$e((d=a&&a.user,d=null==d||d===!1?d:d.id,typeof d===af?d.apply(a):d))+'" data-src="'+$e((d=a&&a.user,d=null==d||d===!1?d:d.avatar,d=null==d||d===!1?d:d.cache,typeof d===af?d.apply(a):d))+'"/>\n</span>\n<span class="username" data-role="username" data-user="'+$e((d=a&&a.user,d=null==d||d===!1?d:d.id,typeof d===af?d.apply(a):d))+'">\n'+$e(c.any.call(a,(d=a&&a.user,null==d||d===!1?d:d.name),(d=a&&a.user,null==d||d===!1?d:d.username),{hash:{},data:b}))+"\n</span>\n"}function Le(a,b){var d="";return d+="\n<span>\n"+$e(c.gettext.call(a,"Login",{hash:{},data:b}))+"\n</span>\n"}function Me(a,b){var d,e="";return e+='\n<li>\n<a href="'+$e((d=a&&a.user,d=null==d||d===!1?d:d.profileUrl,typeof d===af?d.apply(a):d))+'" data-role="user-profile-link" data-action="profile" data-user="'+$e((d=a&&a.user,d=null==d||d===!1?d:d.id,typeof d===af?d.apply(a):d))+'">\n'+$e(c.gettext.call(a,"Your Profile",{hash:{},data:b}))+'\n</a>\n</li>\n<li>\n<a href="#" class="media-toggle-on" data-action="toggle-media">'+$e(c.gettext.call(a,"Display Media",{hash:{},data:b}))+'</a>\n<a href="#" class="media-toggle-off" data-action="toggle-media">'+$e(c.gettext.call(a,"Hide Media",{hash:{},data:b}))+"</a>\n</li>\n",d=c.unless.call(a,(d=a&&a.user,null==d||d===!1?d:d.remote),{hash:{},inverse:_e.noop,fn:_e.program(426,Ne,b),data:b}),(d||0===d)&&(e+=d),e+="\n"}function Ne(a,b){var d="";return d+='\n\n<li>\n<a href="'+$e(c.urlfor.call(a,"editProfile",{hash:{},data:b}))+'">'+$e(c.gettext.call(a,"Edit Settings",{hash:{},data:b}))+"</a>\n</li>\n"}function Oe(a,b){var d,e="";return e+="\n\n",d=c["if"].call(a,(d=a&&a.sso,null==d||d===!1?d:d.url),{hash:{},inverse:_e.noop,fn:_e.program(429,Pe,b),data:b}),(d||0===d)&&(e+=d),e+='\n\n<li>\n<a href="#" data-action="auth:disqus">Disqus</a>\n</li>\n<li>\n<a href="#" data-action="auth:facebook">Facebook</a>\n</li>\n<li>\n<a href="#" data-action="auth:twitter">Twitter</a>\n</li>\n<li>\n<a href="#" data-action="auth:google">Google</a>\n</li>\n'}function Pe(a){var b,c="";return c+='\n<li class="sso">\n<a href="#" data-action="auth:sso">'+$e((b=a&&a.sso,b=null==b||b===!1?b:b.name,typeof b===af?b.apply(a):b))+"</a>\n</li>\n"}function Qe(a,b){var d,e="";return e+='\n<li data-role="toggle-thread">\n<a href="#" data-action="',d=c["if"].call(a,(d=a&&a.thread,null==d||d===!1?d:d.isClosed),{hash:{},inverse:_e.program(434,Se,b),fn:_e.program(432,Re,b),data:b}),(d||0===d)&&(e+=d),e+='-thread">\n',d=c["if"].call(a,(d=a&&a.thread,null==d||d===!1?d:d.isClosed),{hash:{},inverse:_e.program(438,Ue,b),fn:_e.program(436,Te,b),data:b}),(d||0===d)&&(e+=d),e+="\n</a>\n</li>\n\n",d=c.unless.call(a,(d=a&&a.user,null==d||d===!1?d:d.isGlobalAdmin),{hash:{},inverse:_e.noop,fn:_e.program(440,Ve,b),data:b}),(d||0===d)&&(e+=d),e+="\n\n"}function Re(){return"open"}function Se(){return"close"}function Te(a,b){var d="";return d+="\n"+$e(c.gettext.call(a,"Open Thread",{hash:{},data:b}))+"\n"}function Ue(a,b){var d="";return d+="\n"+$e(c.gettext.call(a,"Close Thread",{hash:{},data:b}))+"\n"}function Ve(a,b){var d="";return d+='\n<li>\n<a href="http://docs.disqus.com/kb/2012/">'+$e(c.gettext.call(a,"Help",{hash:{},data:b}))+"</a>\n</li>\n"}function We(a,b){var d="";return d+='\n<li>\n<a href="#" data-action="debug">'+$e(c.gettext.call(a,"Debug",{hash:{},data:b}))+'</a>\n</li>\n\n<li>\n<a href="#" data-action="repair">'+$e(c.gettext.call(a,"Repair",{hash:{},data:b}))+"</a>\n</li>\n"}function Xe(a,b){var d,e="";return e+='\n<li>\n<a href="'+$e((d=a&&a.user,d=null==d||d===!1?d:d.logoutUrl,typeof d===af?d.apply(a):d))+'" data-action="logout">'+$e(c.gettext.call(a,"Logout",{hash:{},data:b}))+"</a>\n</li>\n"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),d=this.merge(d,a.partials),e=e||{};var Ye,Ze="",$e=this.escapeExpression,_e=this,af="function";return Ye=c.partial.call(b,"followButton",{hash:{},inverse:_e.noop,fn:_e.program(1,f,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"alert",{hash:{},inverse:_e.noop,fn:_e.program(12,n,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"blacklist",{hash:{},inverse:_e.noop,fn:_e.program(17,q,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"blacklistErrorMessage",{hash:{},inverse:_e.noop,fn:_e.program(20,s,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"bubbleLayout",{hash:{},inverse:_e.noop,fn:_e.program(22,t,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"bubbleMessage",{hash:{},inverse:_e.noop,fn:_e.program(24,u,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n\n",Ye=c.partial.call(b,"userName",{hash:{},inverse:_e.noop,fn:_e.program(34,A,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"topThreadLink",{hash:{},inverse:_e.noop,fn:_e.program(36,B,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n\n\n",Ye=c.partial.call(b,"communityForum",{hash:{},inverse:_e.noop,fn:_e.program(48,I,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"community",{hash:{},inverse:_e.noop,fn:_e.program(50,J,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"contextCard",{hash:{},inverse:_e.noop,fn:_e.program(52,K,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n\n\n",Ye=c.partial.call(b,"dashboard",{hash:{},inverse:_e.noop,fn:_e.program(63,Q,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"edit",{hash:{},inverse:_e.noop,fn:_e.program(65,R,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"followButtonSmall",{hash:{},inverse:_e.noop,fn:_e.program(67,S,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"formUser",{hash:{},inverse:_e.noop,fn:_e.program(80,_,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"form",{hash:{},inverse:_e.noop,fn:_e.program(82,ab,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"loginForm",{hash:{},inverse:_e.noop,fn:_e.program(98,kb,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"loginButtons",{hash:{},inverse:_e.noop,fn:_e.program(103,nb,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"guestForm",{hash:{},inverse:_e.noop,fn:_e.program(113,tb,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"audienceSync",{hash:{},inverse:_e.noop,fn:_e.program(128,Bb,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"mediaUpload",{hash:{},inverse:_e.noop,fn:_e.program(130,Cb,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"legacyMediaUpload",{hash:{},inverse:_e.noop,fn:_e.program(135,Fb,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"highlightedPost",{hash:{},inverse:_e.noop,fn:_e.program(137,Gb,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"homeNotifications",{hash:{},inverse:_e.noop,fn:_e.program(139,Hb,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"hovercard",{hash:{},inverse:_e.noop,fn:_e.program(141,Ib,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"hovercardCounters",{hash:{},inverse:_e.noop,fn:_e.program(148,Mb,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"hovercardActions",{hash:{},inverse:_e.noop,fn:_e.program(155,Qb,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n\n\n",Ye=c.partial.call(b,"layout",{hash:{},inverse:_e.noop,fn:_e.program(158,Sb,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"postSort",{hash:{},inverse:_e.noop,fn:_e.program(160,Tb,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"postCount",{hash:{},inverse:_e.noop,fn:_e.program(169,Yb,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"topNavigation",{hash:{},inverse:_e.noop,fn:_e.program(172,$b,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"threadVotes",{hash:{},inverse:_e.noop,fn:_e.program(177,bc,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"secondaryNavigation",{hash:{},inverse:_e.noop,fn:_e.program(179,cc,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n\n",Ye=c.partial.call(b,"networkActivity",{hash:{},inverse:_e.noop,fn:_e.program(181,dc,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"networkActivityThreadEntry",{hash:{},inverse:_e.noop,fn:_e.program(183,ec,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"networkActivityPostEntry",{hash:{},inverse:_e.noop,fn:_e.program(185,fc,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"networkForumLink",{hash:{},inverse:_e.noop,fn:_e.program(195,lc,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"profileLink",{hash:{},inverse:_e.noop,fn:_e.program(197,mc,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"notificationMenu",{hash:{},inverse:_e.noop,fn:_e.program(202,pc,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"notifications",{hash:{},inverse:_e.noop,fn:_e.program(208,tc,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"notification",{hash:{},inverse:_e.noop,fn:_e.program(210,uc,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"postLink",{hash:{},inverse:_e.noop,fn:_e.program(217,yc,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"onboard",{hash:{},inverse:_e.noop,fn:_e.program(222,Bc,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"post",{hash:{},inverse:_e.noop,fn:_e.program(224,Cc,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"postWrapperTop",{hash:{},inverse:_e.noop,fn:_e.program(247,Pc,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"postWrapperBottom",{hash:{},inverse:_e.noop,fn:_e.program(254,Tc,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"postMedia",{hash:{},inverse:_e.noop,fn:_e.program(256,Uc,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"sponsoredCommentMedia",{hash:{},inverse:_e.noop,fn:_e.program(262,Yc,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"unknownMediaIframe",{hash:{},inverse:_e.noop,fn:_e.program(264,Zc,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"postMediaPlaceholder",{hash:{},inverse:_e.noop,fn:_e.program(266,$c,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"postMediaImage",{hash:{},inverse:_e.noop,fn:_e.program(268,_c,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"postMediaInlineLink",{hash:{},inverse:_e.noop,fn:_e.program(271,bd,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"postMediaTwitterContent",{hash:{},inverse:_e.noop,fn:_e.program(279,gd,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"postVotes",{hash:{},inverse:_e.noop,fn:_e.program(281,hd,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"postMenu",{hash:{},inverse:_e.noop,fn:_e.program(296,pd,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"postFooter",{hash:{},inverse:_e.noop,fn:_e.program(314,Ad,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"postUserAvatar",{hash:{},inverse:_e.noop,fn:_e.program(327,Hd,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"highlightedSuccessMessage",{hash:{},inverse:_e.noop,fn:_e.program(332,Kd,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"postDeleted",{hash:{},inverse:_e.noop,fn:_e.program(334,Ld,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"postMinimized",{hash:{},inverse:_e.noop,fn:_e.program(336,Md,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"postboxAlert",{hash:{},inverse:_e.noop,fn:_e.program(344,Rd,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"realtimeCommentNotification",{hash:{},inverse:_e.noop,fn:_e.program(349,Ud,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"realtimeReplyNotification",{hash:{},inverse:_e.noop,fn:_e.program(354,Xd,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"realtimeIndicator",{hash:{},inverse:_e.noop,fn:_e.program(359,$d,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"realtimeIndicatorText",{hash:{},inverse:_e.noop,fn:_e.program(361,_d,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"suggestions",{hash:{},inverse:_e.noop,fn:_e.program(372,ge,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"suggestedUser",{hash:{},inverse:_e.noop,fn:_e.program(374,he,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n\n\n",Ye=c.partial.call(b,"topThreadPost",{hash:{},inverse:_e.noop,fn:_e.program(376,ie,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n\n\n",Ye=c.partial.call(b,"topUser",{hash:{},inverse:_e.noop,fn:_e.program(385,ne,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n\n\n",Ye=c.partial.call(b,"topThread",{hash:{},inverse:_e.noop,fn:_e.program(394,se,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"upvoters",{hash:{},inverse:_e.noop,fn:_e.program(398,ve,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"upvoter",{hash:{},inverse:_e.noop,fn:_e.program(409,Ce,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"guestUpvoter",{hash:{},inverse:_e.noop,fn:_e.program(411,De,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"guestUpvoterText",{hash:{},inverse:_e.noop,fn:_e.program(414,Fe,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n\n",Ye=c.partial.call(b,"userMenu",{hash:{},inverse:_e.noop,fn:_e.program(419,Ie,e),data:e}),(Ye||0===Ye)&&(Ze+=Ye),Ze+="\n"})}),define("lounge/views",["jquery","underscore","backbone","moment","modernizr","core/api","remote/config","common/defines","core/analytics/experiment","common/models","common/collections","common/utils","common/bus","core/strings","common/urls","core/analytics/jester","common/views/mixins","common/templates","common/keys","common/time","common/outboundlinkhandler","shared/common/corefuncs","shared/common/logger","shared/common/urls","lounge/common","lounge/menu-handler","lounge/mixins","lounge/realtime","lounge/views/posts","lounge/views/posts/collection","lounge/views/dashboard","lounge/views/community","lounge/views/media","lounge/views/onboard-alert","lounge/views/notification-menu","lounge/views/highlighted-post","lounge/views/realtime","lounge/views/posts/UserSuggestionsManager","lounge/views/viglink","lounge/tracking","lounge/views/homeNotifications","templates/lounge","initializer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q){"use strict";function R(a){var b={};if(!a)return b;var c=a.match(/discovery\-([\w\-]+)/);return b.discoveryOverride=c&&c[1],c=a.match(/\bsponsored-comment-ad-id=(\d+)/),b.sponsoredCommentAdId=c&&c[1],b}var S=n.get,T=l.preventDefaultHandler,U=c.View.extend({events:{"click [data-action^=auth\\:]":"handleAuth","click [data-action=verify-email]":"verifyEmail","click [data-action=audiencesync]":"audienceSync","click [data-action=profile]":"handleShowProfile","click [data-action=onboard]":"handleShowOnboarding","click [data-action=sort]":"handleSort","click [data-action=close-thread]":"closeThread","click [data-action=open-thread]":"openThread","click [data-action=debug]":"renderDebugInfo","click [data-action=repair]":"repairThread","click [data-action=toggle-media]":"toggleMedia","click a":"handleLinkClick"},MEDIA_PERSISTED_WIDTHS:[320,480,600,800],MAX_MEDIA_HEIGHT:480,initialize:function(c){y.setLounge(this),c=c||{};var d=c.jsonData||{};this.initialData=d.response||{},this.cleanInitialData(this.initialData),this.profileWindowName=b.globalUniqueId("disqus_"),l.extract(d,"response.forum.id")&&(o.moderate=l.updateURL(o.moderate,{hostname:d.response.forum.id+"."})),this.deferredViews=[],this.unsortedDeferredViews=[],j.Session.setDefaults(this.initialData.session),this.session=j.Session.get(),this.forum=new j.Forum,this.forum.set(this.initialData.forum),this.thread=new j.Thread(this.initialData.thread,{forum:this.forum,postCursor:d.cursor,moderators:(this.initialData.thread||{}).moderators,order:d.order}),this.initUserSuggestionsManager(),this.postsView=new D.PostCollectionView({posts:this.thread.posts,thread:this.thread,lounge:this,session:this.session,el:this.el,userSuggestions:this.userSuggestions}),this.switches=new k.SwitchCollection(g.switches,{parse:!0}),this.states={realtimeIndicatorsCreated:!1,streamingPaused:!1,discoveryLoaded:!1,inViewport:!1},Q.timings.loungeStart=a.now(),this.forum.get("settings").backplaneEnabled&&this.enableBackplane();var e=b.bind(this.bootstrap,this);l.isIframed(window)?this.listenTo(m,"init",e):b.defer(e),this.setAlertSelector("#layout"),this.initResizeHandler()},cleanInitialData:function(a){var c=a.thread&&a.thread.highlightedPost;c&&(c.isHighlighted=!0),b.each(a.posts,function(a){a.isHighlighted=c?a.id===c.id:!1})},initOnboardAlert:function(){var a=this.onboardAlert=new H.OnboardAlert({session:this.session});this.proxyViewEvents(this.onboardAlert),this.listenTo(this.session,"change:id",function(){a.setInitialCookie(),a.render().$el.appendTo("#onboard")}),this.listenTo(m,{"onboard.complete":b.bind(a.remove,a),"onboardAlert.show":function(){a.render().$el.appendTo("#onboard")}}),this.listenToOnce(this,"uiCallback:postCreated",function(){if(a.shouldPopup()){a.setPopupCookie();var b=this.session.user.isEditable(this.session)?"complete-profile":"follow";this.showOnboarding(b)}}),this.listenTo(m,"onboard.profileUpdated",this.updateSessionUser)},updateSessionUser:function(){this.updateUserFromSession()||this.session.user.fetch({reset:!0})},updateUserFromSession:function(){var a=this.session.user,b=e.sessionstorage&&sessionStorage.getItem("onboard.profileUpdated");if(!b)return!1;try{var c=JSON.parse(b);a.set(c)}catch(d){return!1}finally{sessionStorage.removeItem("onboard.profileUpdated")}return!0},enableBackplane:function(){this.backplaneCredentialsReady=!1,this.events["click [data-action=logout]"]=function(a){return this.backplaneCredentialsReady?(a.preventDefault(),void m.sendHostMessage("backplane.invalidate",{redirectUrl:o.logout})):!0},this.listenTo(this.session,"identify",function(){this.backplaneCredentialsReady&&this.session.isLoggedOut()&&(m.sendHostMessage("backplane.invalidate"),this.backplaneCredentialsReady=!1,f.headers({Authorization:null}))}),this.listenTo(m,"login",function(a){null!==a.backplane&&(this.setBackplaneHeaders(a.backplane),this.fetchSession())}),m.sendHostMessage("loadBackplane")},setBackplaneHeaders:function(a){var b="Backplane "+JSON.stringify({provider:"janrain",message_id_url:a.messageUrl,channel_name:a.channel,forum_id:this.forum.id});this.backplaneCredentialsReady=!0,f.headers({Authorization:b})},bootstrap:function(d){var e=this,g={};e.config=d=d||l.getConfigFromHash(window),this.hashConfig=new c.Model(R(d.parentWindowHash)),this.listenTo(this.hashConfig,"change:discoveryOverride change:sponsoredCommentAdId",b.bind(this.fetchSession,this)),d.discovery||(d.discovery={}),d.apiKey&&(g["X-Disqus-Publisher-API-Key"]=d.apiKey),d.remoteAuthS3&&(g["X-Disqus-Remote-Auth"]=d.remoteAuthS3),b.isEmpty(g)||f.headers(g),this.isForceHttpsAPIEnabled()&&f.defaults({secure:!0}),d.anchorColor&&!function(){var a=l.escapeColor(d.anchorColor);l.addStylesheetRules([[".publisher-anchor-color a",["color",a,!0]],["a.publisher-anchor-color",["color",a,!0]],[".publisher-anchor-hover a:hover",["color",a,!0]],["a.publisher-anchor-hover:hover",["color",a,!0]],[".active .publisher-nav-color:after",["background",a,!0]],[".media-preview .active.publisher-border-color",["border-color",a,!0]],[".publisher-color",["color",a,!1]],[".publisher-color:hover",["color",a,!1]],[".publisher-background-color",["background-color",a,!1]],[".publisher-border-color",["border-color",a,!1]]])}(),this.isMobile=l.isPhone(window),l.injectBaseElement(d.referrer),d.referrer&&(e.thread.currentUrl=d.referrer),d.width&&(document.body.style.width=d.width+"px");var h=this.getPermalinkOptions(d.parentWindowHash);h&&m.once("embed.rendered",b.bind(e.scrollToPost,e,h.postId,h.options)),d.sso&&e.session.set("sso",d.sso),this.position=d.initialPosition?d.initialPosition:l.calculatePositionFullscreen(),this.switches.enabled("experiments_disabled")&&i.disable(),e.updateModeratorText(),e.initUI(),e.bindBusListeners(),e.initHighlightedPost();var j=Q.timings;j.hostStart=d.timestamp||j.initStart,e.listenToOnce(e.postsView,"render:start",function(){j.renderStart=a.now()}),e.listenToOnce(e.postsView,"render:end",e.sendTelemetry),j.bootstrapStart=a.now(),e.postsView.bootstrap(this.initialData,h),e.initSession(),e.listenTo(e.thread,"create",function(a){m.sendHostMessage("posts.create",a.toJSON())}),this.initLinkHandler(),e.initialized=!0,this.trigger("bootstrap:complete",this)},isForceHttpsAPIEnabled:function(){var a=g.lounge;return"withCredentials"in new XMLHttpRequest&&a&&(b.random(0,100)<100*a.force_https_sample_rate||a.force_https_enabled_forums&&a.force_https_enabled_forums.hasOwnProperty(this.forum.id))},sendTelemetry:function(){var c=g.lounge.telemetry_sample_rate;if(c&&!(Math.random()>1/c)){var d=a.now(),e=Q.timings,f={frame:e.initStart-e.hostStart,asset:e.downloadEnd-e.initStart,render:d-e.renderStart,total:d-e.hostStart-(e.renderStart-e.bootstrapStart)},h=window.performance;if(h){var i=h.timing;i.responseStart&&(f.frame_rtt=i.responseStart-i.navigationStart);var j=b.find(h.getEntries&&h.getEntries()||[],function(a){return a.name.indexOf("/next/config.js")>-1});j&&j.responseStart&&(f.config_rtt=j.responseStart-j.startTime)}b.any(f,function(a){return 0>=a})||(b.each(f,function(a,b){f[b]=Math.round(a)}),(new Image).src=v.serialize(o.jester+"/telemetry/lounge.gif",f))}},initUI:function(){this.applyPublisherClasses(),P(),this.renderLayout(),this.currentZone="conversation",this.bindUIUpdateHandlers(),this.initDeferredViews(),this.initNotificationMenu(),this.postsView.once("render:end",function(){var a=l.getPageHeight();m.sendHostMessage("mainViewRendered",{height:a}),this._lastHeight=a,this.initRealtime()},this),b.defer(b.bind(this.initUIComponents,this))},initUIComponents:function(){this.findClosestThumbnailSize(),this.renderForm(),this.updatePostCount(),this.initCommunity(),this.initUserMenu(),this.initThreadVotes(),this.initThreadShareMenu(),this.initThreadSubscribe(),this.initOnboardAlert(),this.bindProfileUIListeners(this.session)},initHighlightedPost:function(){var b=this.thread.get("highlightedPost");b&&this.thread.posts.add(b),this.highlightedPostView=new J.HighlightedPostView({el:a("#highlighted-post"),thread:this.thread,session:this.session,switches:this.switches,userSuggestions:this.userSuggestions}),this.highlightedPostView.reset()},bindUIUpdateHandlers:function(){var a=this,b=a.thread,c=a.session;a.listenTo(b,{"change:likes":a.updateThreadVotes,"change:userScore":a.updateThreadUserScore,"change:posts":a.updatePostCount}),a.listenTo(b.queue,"add reset",a.toggleRealtimeNotifications),a.postsView.bindUIUpdateHandlers(),a.listenTo(c,"change:id",a.updateThreadSessionData),a.listenTo(c,"change:id",a.initDashboard),a.listenTo(a,"scrollOffViewport",function(){this.states.realtimeIndicatorsCreated&&"conversation"===this.currentZone&&m.sendHostMessage("indicator:hide")}),a.listenTo(a,"scroll",a.handleRealtimeScroll),a.listenTo(a,"scroll",function(a){this.position=a,"conversation"===this.currentZone&&(this.conversationPosition=a)}),a.listenTo(a.postsView,"render:end",a.toggleRealtimeNotifications)},initDeferredViews:function(){var a=this;a.listenTo(a,"scroll",a.processDeferredViews),a.listenTo(a,"domReflow",function(){this.invalidateDeferredViewOffsets(),this.processDeferredViews()}),a.listenTo(m,"window.resize",a.processDeferredViews)},shouldFetchSession:function(){return this.config.remoteAuthS3||l.cookies.read("disqusauth")},initSession:function(){return this.bindSessionEvents(),this.shouldFetchSession()?void(!this.switches.enabled("next_lazy_embed")||this.states.inViewport?this.fetchSession():this.listenToOnce(this,"inViewport",this.fetchSession)):void this.session.trigger("identify",this.session)},bindBusListeners:function(){this.stopListening(m),this.listenTo(m,{"window.hashchange":function(a){this.hashConfig.set(R(a));var b=this.getPermalinkOptions(a);b&&this.scrollToPost(b.postId,b.options)},"window.scroll":function(a){this.trigger("scroll",a)},"window.inViewport":function(){this.states.inViewport=!0,this.trigger("inViewport")},"window.scrollOffViewport":function(){this.states.inViewport=!1,this.trigger("scrollOffViewport")},"window.resize":this.resize,"indicator:click":this.handleRealtimeClick,"!auth:success":function(a){a&&(a.sessionId&&f.headers({"X-Sessionid":a.sessionId}),a.message&&this.alert(a.message,{type:"info"}),a.logEvent&&this.trigger("uiAction:"+a.logEvent)),this.fetchSession()},"!audiencesync:grant":function(){this.session.set("audienceSyncVerified",!0)}})},isLinkAffiliatorEnabled:function(){return this.switches.enabled("enable_link_affiliation")&&l.extract(this,"initialData.forum.settings.linkAffiliationEnabled")&&!this.isHttps()&&this.isPublisherIdValid()},isPublisherIdValid:function(){var a=l.extract(this,"initialData.forum.pk");return b.isNumber(a)},initLinkHandler:function(){this.outboundLinkHandler=new u,this.outboundLinkHandler.registerBeforeNavigationHandler(this.logLinkClick,this),this.isLinkAffiliatorEnabled()&&!this.initLinkAffiliatorCalled&&(this.viglink=new M({forumPk:l.extract(this,"initialData.forum.pk"),linkAffiliatorClient:o.linkAffiliatorClient,linkAffiliatorAPI:o.linkAffiliatorAPI,viglinkAPI:s.viglinkAPI}),this.listenTo(m,"viglink:change:timeout",function(a){this.outboundLinkHandler.timeout=a.timeout}),this.initLinkAffiliatorCalled=!0,this.outboundLinkHandler.registerBeforeNavigationHandler(this.viglink.fetchAffiliateLink,this.viglink))},handleLinkClick:function(a){this.outboundLinkHandler.handleClick(a)},bindSessionEvents:b.once(function(){this.listenTo(this.session,"change:isReadOnly",function(){this.session.get("isReadOnly")&&this.alert(S("The Disqus comment system is temporarily in maintenance mode. You can still read comments during this time, however posting comments and other actions are temporarily delayed."))}),this.listenTo(this.session,"identify change:audienceSyncVerified",function(){this.session.get("audienceSyncVerified")&&m.sendHostMessage("session.identify",this.session.user.id)}),this.listenTo(this.session,"identify change:id",this.loadDiscovery)}),fetchSession:function(){var a={thread:this.thread};return this.session.fetch(a)},initRealtimeIndicators:function(){if(!this.switches.enabled("disable_realtime_indicators")&&!this.states.realtimeIndicatorsCreated){var a={contents:r.render("realtimeIndicator",{orientation:"north"})},b={contents:r.render("realtimeIndicator",{orientation:"south"})};m.sendHostMessage("indicator:init",{north:a,south:b}),this.states.realtimeIndicatorsCreated=!0}},insertStreamingComments:b.throttle(function(){var a=this.thread.queue;a.drain(),b.each(a.counters.replies,function(b,c){a.drain(c)})},1e3),updateModeratorText:function(){var a=this.forum.get("settings");a.moderatorText&&(n.translations.Mod=a.moderatorText)},logLinkClick:function(b){var c=a(b.currentTarget);if(l.clickShouldBeLogged(b,c))return p.client.emit({verb:"click",object_type:"link",object_id:c[0].href,area:N.getEventTrackingArea(b)})},handleRealtimeScroll:function(a){if(this.states.inViewport&&this.states.realtimeIndicatorsCreated&&"conversation"===this.currentZone){var c=b.union([this.queueView],b.values(this.postsView.subViews)),d=0,e=0;b.each(c,function(b){if(b&&!b.getDirection&&(b=b.queueView),b&&!(b.options.count<=0)){var c=b.getDirection(a);1===c?d+=b.options.count:-1===c&&(e+=b.options.count)}});var f,g;g={type:"north"},d>0?(f="indicator:show",g.content=r.render("realtimeIndicatorText",{num:d,orientation:"north"})):f="indicator:hide",m.sendHostMessage(f,g),g={type:"south"},e>0?(g.content=r.render("realtimeIndicatorText",{num:e,orientation:"south"}),f="indicator:show"):f="indicator:hide",m.sendHostMessage(f,g)}},handleRealtimeClick:function(a){var c=this;m.sendHostMessage("indicator:hide",{type:a});var d,e,f,g=b.union([c],b.toArray(c.postsView.subViews));g=b.filter(g,function(b){if(b=b.queueView,!b||b.options.count<=0)return!1;var d="north"===a?1:-1;return b.getDirection(c.position)!==d?!1:!0}),g=b.sortBy(g,function(a){return a===c?0:a.offset.top}),d="north"===a?b.last(g):b.first(g),e=d.queueView,d===c?(f=0,e.handleDrain()):(f=d.offset.top-100,e.handleDrain()),y.getLounge().once("domReflow",b.bind(m.sendHostMessage,m,"scrollTo",{top:f}))
},toggleRealtimeNotifications:function(){var c=this,d=c.thread.queue;if(b.defer(function(){m.sendHostMessage("fakeScroll")}),!d.length)return void a("[data-role=realtime-notification]").hide();if(c.thread.get("hasStreaming"))return void c.insertStreamingComments();if(d.counters.comments){var e=c.queueView||new K.QueuedPostView({model:c.thread,el:c.$el.find("button[data-role=realtime-notification]")});c.queueView=e,e.setCount(d.counters.comments),e.render()}b.each(d.counters.replies,function(a,b){var d=c.thread.posts.get(b);if(d){var e=c.postsView.getPostView(d.cid);if(e){var f=e.queueView;f||(f=new K.QueuedReplyView({thread:c.thread,postView:e,model:d,el:e.$el.find("[data-role=realtime-notification\\:"+b+"] a")}),e.queueView=f),f.setCount(a),f.render()}}})},renderDebugInfo:T(function(){if(this.session.user.get("isGlobalAdmin")){for(var a=[],b=0,c=this.switches.models.length;c>b;b++)this.switches.models[b].attributes.enabled&&a.push(this.switches.models[b].id);var d=new $({Shortname:this.thread.get("forum"),"Thread ID":this.thread.get("id"),"Thread slug":this.thread.get("slug"),"Anchor color":l.escapeColor(this.config.anchorColor),Switches:a.join(", ")});d.render();var e=document.body;e.insertBefore(d.el,e.firstChild)}}),repairThread:T(function(){this.session.user.get("isGlobalAdmin")&&f.call("internal/threads/repair.json",{method:"GET",data:{thread:this.thread.get("id")},success:b.bind(this.alert,this,"Thread repair has been queued. Refresh in a few seconds."),error:b.bind(this.alert,this,"An error occurred while repairing thread. Please try again.","error")})}),getPermalinkOptions:function(a){var b=a&&a.match(/(comment|reply|edit)\-([0-9]+)/);if(b)return{postId:b[2],options:{highlight:!0,openReply:"reply"===b[1],openEdit:"edit"===b[1]}}},scrollToPost:function(a,c){c=c||{},c.padding=c.padding||90;var d=this;"conversation"!==d.currentZone&&(c.force=!0),d.mainNav.navTo("conversation");var e=d.$el.find("#post-"+a);return e.length?(c.highlight&&(d.$el.find(".post-content.target").removeClass("target"),e.find(".post-content").first().addClass("target")),c.openReply&&d.postsView.openReply(a),c.openEdit&&d.postsView.openEdit(a),void m.sendHostMessage("scrollTo",{top:e.offset().top-c.padding,force:c.force||null})):void j.Post.fetchContext(a,d.thread,{requestedByPermalink:!0}).done(function(){m.once("embed.resized",b.bind(d.scrollToPost,d,a,c))})},updateThreadSessionData:function(a){if(a){a.get("thread")&&this.thread.set(a.get("thread"));var c=a.get("votes");c&&"object"==typeof c&&b.each(c,function(a,b){var c=this.postsView.posts.get(b);c&&c.set("userScore",a)},this)}},initDashboard:function(){this.dashboard=i.isActive("homenotifs")?new O({el:"#dashboard",session:this.session,lounge:this}):new E.DashboardView({el:"#dashboard",session:this.session,notifications:this.notifications,lounge:this}),this.dashboard.render()},initCommunity:function(){this.community=new F.CommunityView({el:document.getElementById("community"),forum:this.forum,session:this.session})},initNotificationMenu:function(){var a=this.notificationMenu=new I.NotificationMenuView({el:this.$el.find("[data-role=notification-menu]")[0],session:this.session});a.render(),this.trackDeferredView(a)},initUserMenu:function(){var a=this.userMenu=new Y({el:this.$el.find("[data-role=logout]")[0],session:this.session,thread:this.thread,referrerUrl:this.config.referrer});this.listenTo(this.thread,"change:isClosed",this.render),a.render()},initThreadShareMenu:function(){this.threadShareMenu=new V({el:a("#thread-share-menu")[0],model:this.thread})},getFeaturedPostInTrophyPosition:function(){return this.highlightedPostView?this.highlightedPostView.getPost():a.Deferred().resolve()},loadDiscovery:function(){var a=this;(!a.config.discovery.disable_all||a.forum.get("settings").discoveryLocked)&&(a.states.discoveryLoaded||(a.states.discoveryLoaded=!0,Q.loadCss("//a.disquscdn.com/next/styles/discovery.9d5388d06dc38ac22e5801bcdb736112.css"),require(["discovery/main"],function(c){a.getFeaturedPostInTrophyPosition().always(b.bind(a.initDiscovery,a,c))})))},initDiscovery:function(a,b){var c=a.init(this.thread,this.hashConfig,this.config.discovery,this.switches,{containerId:"discovery",session:this.session,position:this.getPosition(),userSuggestions:this.userSuggestions,hasSpaceForSponsoredComment:!b,colorTheme:this.getColorScheme()});return c?(this.listenTo(this.thread,"change:highlightedPost",function(a,b){c.set("hasSpaceForSponsoredComment",!b)}),void this.listenTo(c,"init:bubble",this.initBubble)):void w.log("Discovery seems not enabled. Check Gargoyle switches or forum settings.")},initBubble:function(a){h.browser.mobile||(m.sendHostMessage("bubble:init",{contents:r.render("bubbleLayout",{loungeCss:"//a.disquscdn.com/next/styles/lounge.bfd38cd7885406402c3c8cd9bc7f4ce3.css"}),colorTheme:this.getColorScheme()}),this.listenTo(m,"window.scroll.always",this.bubbleOnScroll),this.listenTo(m,"bubble:click",this.handleBubbleClick),this.listenTo(m,"bubble:close",b.bind(this.closeBubble,this,!0)),this.isNotificationBubbleVisible=!1,this.notificatinoBubbleTargetPerc=a.targetPerc,this.notificationBubbleReportOptions=a.reportOptions,this.thread.posts.length||(this.topThread=new k.TopThreadCollection(null,{forum:this.forum.id,limit:1}),this.topThread.fetch()))},bubbleOnScroll:function(a){var b=a.frameOffset.top-a.pageOffset-a.height<0,c=this.notificatinoBubbleTargetPerc,e=a.frameOffset.top*c-a.pageOffset-a.height<0;if(b)return void this.closeBubble(!0);if(!e)return void(this.isNotificationBubbleVisible&&this.closeBubble());if(!this.isNotificationBubbleVisible){for(var f=[],g={},h=this.thread.posts.models,i=0;i<h.length;i++){var j=h[i];if(g[j.author.id]||this.session.user.id===j.author.id||(f.push(j.author.toJSON()),g[j.author.id]=1),5===f.length)break}var k=this.topThread&&this.topThread.length&&this.topThread.at(0).toJSON();if(k){k.timeAgo=d(k.createdAt,t.ISO_8601).fromNow(),k.forum=this.forum.toJSON();var l=this.topThread.at(0).get("link");/\#/.test(l)||(l+="#disqus_thread"),k.link=l}(f.length||k)&&(m.sendHostMessage("bubble:show",{message:r.render("bubbleMessage",{usersCount:this.thread.users.length-1,topUser:f.length&&f[0],users:f,topThread:k})}),this.reportBubbleActivity({verb:"view"},this.topThread&&this.topThread.length),this.isNotificationBubbleVisible=!0)}},handleBubbleClick:function(){var a=this.topThread&&this.topThread.length;a||m.sendHostMessage("scrollTo",{top:0,force:!0}),this.closeBubble(!0),this.reportBubbleActivity({verb:"click"},a)},reportBubbleActivity:function(a,c){p.client.emit(b.defaults(a,this.notificationBubbleReportOptions,{object_type:"area",object_id:c?"article_bubble":"comment_bubble"}))},closeBubble:function(a){this.isNotificationBubbleVisible&&m.sendHostMessage("bubble:hide"),this.isNotificationBubbleVisible=!1,a===!0&&(this.stopListening(m,"window.scroll.always",this.showBubble),this.stopListening(m,"bubble:click"),this.stopListening(m,"bubble:close"))},isHttps:function(){return"https:"===window.location.protocol},isRealtimeEnabled:function(){var a=d.unix(this.initialData.lastModified);return!this.thread.get("isClosed")&&(this.switches.enabled("realtime_for_oldies")||d().diff(a,"days")<=7)},realtimeHandlers:{Post:function(a){var b=a.data,c=this.thread;if(!this.thread.get("hasStreaming")||!this.states.streamingPaused){if(!b.id)return void w.logError("RT: no post ID");if(!b.author||!b.author.id)return void w.logError("RT: no author or author ID");if(!b.author.name)return void w.logError("RT: no author name or email hash");if(!b.post||!b.post.message)return void w.logError("RT: no post message");if(c.posts.get(b.id)||c.queue.get(b.id))return void w.log("RT: duplicate: ",b.id);if("approved"!==b.type)return void w.log("RT: unnaproved: ",b.id);if(b.type===b.type_prev)return void w.log("RT: Post change message, ignoring for now ",b.id);this.thread.incrementPostCount(1);var d=b.post.parent_post.id;if(d="0"!==d?d:null,d&&!c.posts.get(d)&&!c.queue.get(d))return void w.log("RT: parent is not on this page: ",b.id);var e=b.author.id,f=c.users.get(e);f||(f=new j.UniqueModel(j.User,{id:e,name:b.author.name,isAnonymous:"0"===b.author.id}),b.author.avatar&&f.set("avatar",{cache:b.author.avatar,permalink:b.author.avatar}),c.users.add(f)),c.queue.add({id:b.id,userId:f.get("id"),parentId:d,message:b.post.message,createdAt:b.date,media:b.post.media})}},Vote:function(a){var b=a.data;if(b.id&&b.vote){var c=this.thread,d=c.posts.get(b.vote.recipient_post_id);if(d){w.log("RT: Vote for post ",d.id);var e=d.votes.get(b.id);e||(w.log("RT: Creating new vote with id ",b.id),e=new j.Vote({id:b.id}),d.votes.add(e));var f=d._vote(b.vote.vote,e.get("score"),b.voter);0!==f&&e.set("score",f)}}},ThreadVote:function(a){var b=a.data,c=this.thread;if(b.id&&b.vote&&(!this.session.user.id||b.vote.voter_id!==this.session.user.id)){var d=c.votes.get(b.id);d||(d=new j.ThreadVote({id:b.id}),c.votes.add(d));var e=c._vote(b.vote.vote,d.get("score"));0!==e&&d.set("score",e)}},typing:function(a){var c=a.data,d=this.thread,e=c.typing,f=c.post;if(c.thread===d.id&&f){var g=d.posts.get(f);g&&(g.usersTyping.count()<=0&&!e||g.usersTyping.add(j.TypingUser.make(b.extend({client_context:a.lastEventId},c))))}}},initRealtime:function(){var a=B.Manager;if(!a.pipe&&this.isRealtimeEnabled()){this.initRealtimeIndicators();var b;this.switches.enabled("aggressive_embed_cache")&&(b=this.initialData.lastModified),a.initialize("thread/"+this.thread.id,b,this.realtimeHandlers,this);var c=0;this.listenTo(f,"call",function(b){"POST"!==b.method||b.secure||(c++,a.pause())}),this.listenTo(f,"complete",function(){0>=c||--c||a.resume()})}},initThreadVotes:b.debounce(function(){var c,d=this;d.threadVotes&&d.threadVotes.remove(),d.threadVotes=c=new W({thread:d.thread,session:d.session}),d.listenTo(c,{"vote:like":b.bind(d.trigger,d,"uiAction:threadLike"),"vote:unlike":b.bind(d.trigger,d,"uiAction:threadUnlike")}),c.render(),a("#thread-votes").append(c.el)},200),initThreadSubscribe:function(){this.threadSubscribeButton=new X({session:this.session,thread:this.thread,el:a("#thread-subscribe-button")[0]})},updateThreadVotes:function(){a("#thread-votes [data-role=like-count]").text(this.thread.get("likes"))},updateThreadUserScore:function(){var b=this.thread.get("userScore"),c=a("#thread-votes [data-role=vote-button]");c.removeClass("upvoted").removeClass("downvoted"),b>0?c.addClass("upvoted"):0>b&&c.addClass("downvoted")},updatePostCount:function(){var a=this;this.postCountContainer=this.postCountContainer||this.$("a[data-role=post-count]"),this.postCountContainer.html(r.render("postCount",{count:a.thread.get("posts")}))},swapMain:function(a){var c=this,d=this.$el.find("#main-nav [data-nav=conversation]").parent("li");"conversation"!==a?d.attr("data-dropdown","disabled"):b.defer(function(){d.attr("data-dropdown","enabled")});var e=this.currentZone;c.states.realtimeIndicatorsCreated&&"conversation"!==a&&m.sendHostMessage("indicator:hide");var f=c[a];f&&!f.isRendered&&(c.freeze(!0),c.listenToOnce(f,"render:all",b.bind(c.freeze,c,!1)),f.show()),c.$el.find("[data-role=main]").hide(),c.$el.find("[data-role=main]#"+a).show(),c.currentZone=a,c.trigger("uiAction:openZone",a,e)},setupNavigation:function(){var a=this;a.mainNav=new _({el:a.$("#main-nav")}),a.listenTo(a.mainNav,"nav",function(a){this.swapMain(a)})},renderLayout:function(){var b=this;b.addFeatureDetectionClasses(),z.init();var c=a(r.render("layout",{thread:b.thread.toJSON(),forum:b.forum.toJSON(),order:b.thread.posts.getOrder()}));c.appendTo(b.$el),b.setupNavigation(),b.postsView.renderLayout()},addFeatureDetectionClasses:function(){var b=a(document.documentElement);this.isMobile&&b.addClass("mobile"),l.useOpacityTransitions(window)&&b.addClass("use-opacity-transitions")},renderForm:function(){if(this.thread.get("isClosed"))return void this.alert(S("Comments for this thread are now closed."));if(!this.session.get("canReply"))return void this.session.once("change:id",this.renderForm,this);var b=this.form=new C.PostReplyView({thread:this.thread,userSuggestions:this.userSuggestions,session:this.session});b.render(),b.prependTo(a("#form")),b.resize()},initUserSuggestionsManager:function(){this.userSuggestions=new L,this.userSuggestions.addRemote(this.thread.users),this.listenTo(this.session,"change:id",function(){this.session.isLoggedIn()&&(this.session.user.getFollowing(),this.session.user.following.PER_PAGE=100),this.userSuggestions.addRemote(this.session.user.following,{shouldFetch:!0}),this.userSuggestions.addRemote(this.thread.moderatorList,{shouldFetch:!0})})},showOnboarding:function(a){this.showOnboardApp({threadId:this.thread.get("id"),forumId:this.forum.get("id"),forumPk:l.extract(this,"initialData.forum.pk").toString(),session:this.session,activeSection:a,isFullscreen:this.isFullscreen})},handleShowOnboarding:T(function(b){var c=a(b.target).attr("data-section");this.showOnboarding(c)}),handleShowProfile:T(function(b){var c=a(b.currentTarget).attr("data-user");this.showProfile(c)}),handleSort:T(function(b){var c=a(b.currentTarget).attr("data-sort");this.$el.find('[data-role="post-sort"]').replaceWith(r.render("postSort",{order:c})),this.thread.posts.setOrder(c),this.thread.posts.fetch({reset:!0}),l.cookies.create("disqus.order",c),this.postsView.handleSort()}),closeThread:T(function(){this.thread.close({success:b.bind(m.sendHostMessage,m,"reset"),error:b.bind(this.alert,this,"An error occurred while closing thread. Please try again.","error")})}),openThread:T(function(){this.thread.open({success:b.bind(m.sendHostMessage,m,"reset"),error:b.bind(this.alert,this,"An error occurred while opening thread. Please try again.","error")})}),findClosestThumbnailSize:function(){var a=document.body.offsetWidth;if(this.loadedThumbnailWidth)return this.loadedThumbnailWidth;var c=this.MEDIA_PERSISTED_WIDTHS,d=c.length;this.loadedThumbnailWidth=b.find(c,function(b,e){return e+1===d||Math.abs(c[e+1]-a)>Math.abs(c[e]-a)})},createDeferredViewsForImages:function(){var b=this;a("img[data-src]").each(function(c,d){var e=a(d),f=new Z({el:d,url:e.attr("data-src")});f.relatedPost=e.attr("data-post"),e.removeAttr("data-src"),b.trackDeferredView(f)})},trackDeferredView:function(a){if(null===a.getOffset())return void this.unsortedDeferredViews.push(a);var c=b.sortedIndex(this.deferredViews,a,function(a){var b=a.getOffset();return b?b.visibleTop:null});this.deferredViews[c]!==a&&this.deferredViews.splice(c,0,a)},invalidateDeferredViewOffsets:function(){b.invoke(this.deferredViews,"invalidateOffset"),this.unsortedDeferredViews=this.unsortedDeferredViews.concat(this.deferredViews),this.deferredViews=[]},trackUnsortedDeferredViews:function(){var a=this.unsortedDeferredViews;this.unsortedDeferredViews=[],b.each(a,this.trackDeferredView,this)},getPosition:function(){return this.position},processDeferredViews:function(){this.createDeferredViewsForImages(),this.trackUnsortedDeferredViews();var a=this.deferredViews.length;if(a){var c=this.getPosition(),d=c.pageOffset+c.height-c.frameOffset.top;if(!(0>d)){for(var e=0;a>e;++e){var f=this.deferredViews[e];if(!f.isAboveOffset(d))break;f.relatedPost&&this.postsView.listenTo(f,"load error",b.bind(this.postsView.onDeferredViewReady,this.postsView,f.relatedPost)),f.trigger("viewport:enter")}this.deferredViews=this.deferredViews.slice(e)}}},showProfile:function(b){e.sessionstorage&&sessionStorage.setItem("profile.session",JSON.stringify(this.session.user.toJSON())),a(document).trigger("mouseout");var c={threadId:this.thread.get("id"),forumId:this.forum.get("id"),forumPk:l.extract(this,"initialData.forum.pk").toString()};if(h.browser.mobile){var d={user:{id:b},fullscreen:!0};l.windowOpen(x.get("profile",{f:this.forum.get("id")},d))}else c.userId=b,m.sendHostMessage("profile.show",c)},initResizeHandler:function(){var a=this,b=function(){a.resize(),window.requestAnimationFrame(b)};window.requestAnimationFrame(b)},resize:function(){var a=l.getPageHeight();this._lastHeight!==a&&(this._frozen&&this._lastHeight&&this._lastHeight>a||(this._lastHeight=a,this.trigger("domReflow"),m.sendHostMessage("resize",{height:a})))},freeze:function(a){this._frozen=!!a,this._frozen===!1&&this.resize()},windowOpen:function(a,b,c){l.windowOpen(a,"_blank",{width:b,height:c})},authenticate:function(a){var c=this.authServices[a];if(!c)return void w.log("Unknown authentication service: "+a);if(b.isFunction(c))return c.call(this);this.trigger("uiAction:openLogin",a);var d={forum:this.thread.forum.get("id")};"https:"===window.location.protocol&&(d.redirect_secure=1),b.extend(d,c.params),this.windowOpen(v.serialize(c.url,d),c.width,c.height)},handleAuth:T(function(a){this.authenticate(l.extractService(a.target,"auth"))}),authServices:{disqus:{url:o.login,width:460,height:355},disqusDotcom:{url:o.dotcomLogin,width:478,height:590,params:{next:o.login}},twitter:{url:o.oauth.twitter,width:650,height:680},facebook:{url:o.oauth.facebook,width:550,height:300},google:{url:o.oauth.google,width:650,height:440},sso:function(){var a=parseInt(this.config.sso.width||"800",10),c=parseInt(this.config.sso.height||"500",10),d=window.open(this.config.sso.url,"_blank","width="+a+",height="+c);!function e(){l.isWindowClosed(d)?m.sendHostMessage("reload"):b.delay(e,500)}()}},verifyEmail:T(function(){var a=v.serialize(o.verifyEmail,{f:this.forum.id});window.open(a,"_blank","width=460,height=355")}),getAudienceSyncUrl:b.memoize(function(){var a={client_id:this.config.apiKey,response_type:"audiencesync",forum_id:this.forum.id};return"https:"===window.location.protocol&&(a.ssl=1),v.serialize(o.authorize,a)}),audienceSync:T(function(){this.windowOpen(this.getAudienceSyncUrl(),460,355)}),toggleMedia:T(function(){var a=G.settings,b=!a.get("collapsed");a.set("collapsed",b)})});b.extend(U.prototype,A.ShareMixin),b.extend(U.prototype,A.AlertMixin),l.mixin(U,q.UiActionEventProxy),l.mixin(U,q.OnboardHelper),q.appliesPublisherClasses.call(U.prototype);var V=c.View.extend({events:{"click [data-action=share\\:twitter]":"_onShare","click [data-action=share\\:facebook]":"_onShare"},_onShare:T(function(a){var b=l.extractService(a.target,"share");b&&this.sharers[b]&&(y.getLounge().trigger("uiAction:threadShare",b),this.share(b))}),_shareUrl:function(){return this.model.url()}});b.extend(V.prototype,A.ShareMixin);var W=c.View.extend({className:"thread-likes",initialize:function(a){b.extend(this,a)},events:{"click [data-action=upvote]":"upvote"},render:function(){var a=this,b=a.$el;return b.html(r.render("threadVotes",{thread:a.thread.toJSON(),user:a.session.toJSON()})),a.thread.get("userScore")>0?b.addClass("upvoted"):b.removeClass("upvoted"),b.attr("data-role","vote-button"),b},upvote:T(function(){this.vote(1)}),vote:function(a){var c,d=this.thread.get("userScore")===a;this.trigger(d?"vote:unlike":"vote:like"),this.thread.vote(d?0:a),d||(c=this.$el.find(".dropdown"),b.defer(function(){c.addClass("open")}))},remove:function(){this.off(),c.View.prototype.remove.call(this)}}),X=c.View.extend({events:{"click [data-action=subscribe]":"subscribe","keydown #thread-subscribe-email":"subscribeKeypress"},initialize:function(a){this.thread=a.thread,this.session=a.session,this.listenTo(this.thread,"change:userSubscription",this.updateStatus),this.updateStatus(),this._boundDocumentClickHandler=b.bind(this._documentClickHandler,this)},updateStatus:function(){this.thread.get("userSubscription")?this.$el.addClass("subscribed"):this.$el.removeClass("subscribed")},subscribe:T(function(){var a=this.thread.get("userSubscription");this.session.isLoggedOut()&&!a?this.showForm():this.thread.subscribe(!a)}),showForm:function(){var c=this;this._unbindDocumentClickHandler(),b.defer(function(){a(document.body).on("click",c._boundDocumentClickHandler)}),c.$el.addClass("show-form").find("input")[0].focus()},_documentClickHandler:function(a){"thread-subscribe-email"!==a.target.id&&this.hideForm()},_unbindDocumentClickHandler:function(){a(document.body).off("click",this._boundDocumentClickHandler)},hideForm:function(){this._unbindDocumentClickHandler(),this.$el.removeClass("show-form").find("input")[0].blur()},subscribeKeypress:function(a){var b=this.$el.find("input");if(b.removeClass("alert error"),"Esc"===a.key||27===a.keyCode)return void this.hideForm();if("Enter"===a.key||13===a.keyCode){var c=a.target.value;if(!l.validateEmail(c))return void b.addClass("alert error");this.hideForm(),this.thread.subscribe(!0,c)}}}),Y=c.View.extend({initialize:function(a){b.extend(this,a),this.listenTo(this.session,"change:id",this.render),this.listenTo(G.settings,"change:collapsed",this.onMediaCollapseChange)},render:function(){var a=r.render("userMenu",{user:this.session.toJSON(),thread:this.thread.toJSON(),feedbackUrl:this.getSurveyMonkeyUrl(),sso:this.session.get("sso")});this.$el.html(a),this.onMediaCollapseChange()},onMediaCollapseChange:function(){G.settings.get("collapsed")?this.$el.addClass("media-collapsed"):this.$el.removeClass("media-collapsed")},getSurveyMonkeyUrl:function(){var a,b="https://www.surveymonkey.com/s/5RBPTTZ",c=this.referrerUrl,d=this.session.user.id;a=d?[d,c]:[c];var e="?c="+encodeURIComponent(a.join(";"));return b+e}}),Z=c.View.extend(b.extend({},q.IsVisibleViewMixin,{topEdgeOffset:function(){return-y.getLounge().getPosition().height},initialize:function(a){this.options=a,this.hasLoaded=null,this.once("viewport:enter",this.loadImage,this)},loadImage:function(){var a=this;if(!a.hasLoaded){var b=function(b){return function(){a.trigger(b),a.$el.off(".deferredMediaView")}};a.$el.on("load.deferredMediaView",b("load")),a.$el.on("error.deferredMediaView",b("error")),a.$el.attr("src",a.options.url),a.hasLoaded=!0}}})),$=c.View.extend({tagName:"ul",className:"debug",initialize:function(a){this.values=a},render:function(){return this.$el.empty(),b.each(this.values,function(a,b){var c=document.createElement("li");c.innerHTML="<strong>"+b+"</strong>: "+a,this.$el.append(c)},this),this}}),_=c.View.extend({events:{"click [data-nav]":"_navTo"},initialize:function(){this.prevDestination=this.activeNav()},_navTo:function(b){b.preventDefault();var c=a(b.target);c=c.is("[data-nav]")?c:c.closest("[data-nav]");var d=c.attr("data-nav");this.navTo(d)},navTo:function(a){if(this.prevDestination!==a){this.prevDestination=a;var b=this.$el.find("[data-nav="+a+"]").parent();b.siblings("li").removeClass("active"),b.addClass("active"),this.trigger("nav",a)}},activeNav:function(){return null!=this.prevDestination?this.prevDestination:this.$el.find(".active [data-nav]").attr("data-nav")},clear:function(){this.$el.find("li").removeClass("active"),this.prevDestination=null}});return l.mixin(U,q.ProfileHtmlHelpers),{Lounge:U,UserMenuView:Y,ThreadVotesView:W,ThreadSubscribeButton:X,DeferredMediaView:Z,DebugInfoView:$}}),define("lounge/load",["jquery","lounge/views","lounge/tracking","initializer"],function(a,b,c,d){"use strict";return{init:function(){var e=d.getEmbeddedData,f=e("threadData");if(!f)return{code:15};if(f.code)return f;a.extend(f.response,e("forumData")),a("#postCompatContainer").remove();var g=new b.Lounge({jsonData:f,el:document.body});c.init(g)}}}),define("lounge",function(){});